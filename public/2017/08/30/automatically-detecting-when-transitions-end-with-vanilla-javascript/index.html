<!DOCTYPE html>
<html lang="en-us">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<title>Automatically detecting when transitions end with vanilla JavaScript | Go Make Things</title>
		

		
		<meta name="viewport" content="width=device-width, initial-scale=1">

		
		
		<link rel="shortcut icon" href="https://gomakethings.com/img/favicon.ico">
		<link rel="icon" sizes="16x16 32x32" href="https://gomakethings.com/img/favicon.ico">

		
		
		<link rel="alternate" type="application/rss+xml" title="Go Make Things RSS Feed" href="http://feeds.feedburner.com/GoMakeThings">
		<link rel="feed" type="application/rss+xml" title="Go Make Things RSS Feed" href="http://feeds.feedburner.com/GoMakeThings">

		
		<link rel="stylesheet" href="https://gomakethings.com/css/main.min.1.1.0.css">

		
		<script src="https://gomakethings.com/js/detects.min.1.1.0.js"></script>
		<script>
			;(function () {
				var css = 'https://fonts.googleapis.com/css?family=PT+Serif:400,400i,700,700i';
				if (getCookie('fontsLoaded')) {
					loadCSS(css);
					document.documentElement.className += 'fonts-loaded';
				} else {
					loadCSS(css);
					var font = new FontFaceObserver('PT Serif');
					font.load().then(function () {
						var expires = new Date(+new Date() + (7 * 24 * 60 * 60 * 1000)).toUTCString();
						document.cookie = 'fontsLoaded=true; expires=' + expires;
						document.documentElement.className += ' fonts-loaded';
					});
				}
			})();
		</script>
	</head>

	<body>

		<div class="container container-large">

	
	<a class="screen-reader screen-reader-focusable" href="#main">Skip to main content</a>

	
	<a class="screen-reader screen-reader-focusable" href="mailto:&#099;&#104;&#114;&#105;&#115;&#064;&#103;&#111;&#109;&#097;&#107;&#101;&#116;&#104;&#105;&#110;&#103;&#115;&#046;&#099;&#111;&#109;?subject=Go%20Make%20Things:%20Accessibility%20Feedback">Accessibility Feedback</a>

</div>

		<header class="container container-large margin-bottom-large">
	<nav class="nav-wrap">
		<a class="logo" href="https://gomakethings.com">
			<svg xmlns="http://www.w3.org/2000/svg" style="height:.8em;width:.8em" viewBox="0 0 16 16"><title></title><path fill="currentColor" d="M14 9v2.066c-1.258 1.285-3.016 2.526-5 2.852V8.001h3v-1L9 5.83A3.001 3.001 0 0 0 8 .001 3 3 0 0 0 7 5.83L4 7.001v1h3v5.917c-1.984-.326-3.742-1.567-5-2.852V9H0v1c0 2 4 6 8 6s8-4 8-6V9h-2zM9 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/></svg>
			Go Make Things
		</a>
		<div class="nav-menu" id="nav-menu">
			<ul class="nav">
				<li><a href="https://gomakethings.com/about">About</a></li><li><a href="https://gomakethings.com/guides">Guides</a></li><li><a href="https://gomakethings.com/courses">Courses</a></li><li><a href="https://gomakethings.com/resources">Resources</a></li><li><a href="https://gomakethings.com/articles">Daily Tips</a></li>
			</ul>
		</div>
	</nav>
</header>

		<main id="main" tabindex="-1">

			<div class="container">

	<article>

	
	<h1><span class="title">Automatically detecting when transitions end with vanilla JavaScript</span></h1>
	

	

<p>Yesterday, we looked at <a href="/controlling-the-transition-timing-of-show-and-hide-methods-with-vanilla-javascript/">two techniques for adjusting the timing of transitions</a> for our vanilla JS <code>show()</code> and <code>hide()</code> methods. Both of approaches involved hard-coding timing values into our script.</p>

<p>Imagine if you had multiple transition types: some with a fade-in, some without; some with an animation, some without; some fast, some slow, others somewhere in-between. Controlling all of that logic with manual JS arguments or <code>if...else</code> logic would quickly become unmanageable.</p>

<p>Reader <a href="https://diegoversiani.me/about/">Diego Versiani</a> sent me an email with a really cool technique for automatically detecting when transitions end. His approach makes scaling larger projects much more maintainable.</p>

<p><strong><em>Side Note:</em></strong> <em>I love getting emails like this. If you have a tip or technique you want to share with the rest of my readers, please <a href="/about/">reach out</a> and let me know about it!</em></p>

<h2 id="a-quick-recap">A Quick Recap</h2>

<p>Just to quickly recap, here&rsquo;s our current working script.</p>

<pre><code class="language-lang-javascript">// Get the transition timing
var getTiming = function (elem) {
	var timing = 350;
	if (elem.classList.contains('show-fast')) {
		timing = 100;
	}
	if (elem.classList.contains('show-slow')) {
		timing = 2000;
	}
	return timing;
};

// Show an element
var show = function (elem) {

	// Get the transition timing
	var timing = getTiming(elem);

	// Get the natural height of the element
	var getHeight = function () {
		elem.style.display = 'block'; // Make it visible
		var height = elem.scrollHeight + 'px'; // Get it's height
		elem.style.display = ''; //  Hide it again
		return height;
	};

	var height = getHeight(); // Get the natural height
	elem.classList.add('is-visible'); // Make the element visible
	elem.style.height = height; // Update the height

	// Once the transition is complete, remove the inline height so the content can scale responsively
	window.setTimeout(function () {
		elem.style.height = '';
	}, timing);

};

// Hide an element
var hide = function (elem) {

	// Get the transition timing
	var timing = getTiming(elem);

	// Give the element a height to change from
	elem.style.height = elem.scrollHeight + 'px';

	// Set the height back to 0
	window.setTimeout(function () {
		elem.style.height = '0';
	}, 1);

	// When the transition is complete, hide it
	window.setTimeout(function () {
		elem.classList.remove('is-visible');
	}, timing);

};

// Toggle element visibility
var toggle = function (elem, timing) {

	// If the element is visible, hide it
	if (elem.classList.contains('is-visible')) {
		hide(elem);
		return;
	}

	// Otherwise, show it
	show(elem);

};
</code></pre>

<p>Here&rsquo;s our CSS.</p>

<pre><code class="language-lang-css">.toggle-content {
	display: none;
	height: 0;
	opacity: 0;
	overflow: hidden;
	transition: height 350ms ease-in-out, opacity 750ms ease-in-out;
}

.show-fast {
	transition: height: 100ms ease-in-out, opacity 300ms ease-in-out;
}

.show-slow {
	transition: height: 2000ms ease-in-out, opacity 2500ms ease-in-out;
}

.toggle-content.is-visible {
	display: block;
	height: auto;
	opacity: 1;
}
</code></pre>

<p>And here&rsquo;s the markup to go with it.</p>

<pre><code class="language-lang-markup">&lt;p&gt;
	&lt;a class=&quot;toggle&quot; href=&quot;#example&quot;&gt;Toggle Div (normal speed)&lt;/a&gt;
&lt;/p&gt;

&lt;div class=&quot;toggle-content&quot; id=&quot;example&quot;&gt;
	This content reveals at normal speed.
&lt;/div&gt;

&lt;p&gt;
	&lt;a class=&quot;toggle&quot; href=&quot;#example-fast&quot;&gt;Toggle Div (fast)&lt;/a&gt;
&lt;/p&gt;

&lt;div class=&quot;toggle-content show-fast&quot; id=&quot;example-fast&quot;&gt;
	This content reveals quickly.
&lt;/div&gt;

&lt;p&gt;
	&lt;a class=&quot;toggle&quot; href=&quot;#example-slow&quot;&gt;Toggle Div (slow)&lt;/a&gt;
&lt;/p&gt;

&lt;div class=&quot;toggle-content show-slow&quot; id=&quot;example-slow&quot;&gt;
	This content reveals at slowly.
&lt;/div&gt;
</code></pre>

<h2 id="replacing-settimeout-with-addeventlistener">Replacing <code>setTimeout()</code> with <code>addEventListener()</code></h2>

<p>For this technique, we&rsquo;ll remove <code>setTimeout()</code> from our scripts, and replace it with <code>addEventListener()</code>. Specifically, we&rsquo;re listening for the <code>transitionend</code> event on our element.</p>

<p>So in our <code>show()</code> method, this&hellip;</p>

<pre><code class="language-lang-javascript">// Once the transition is complete, remove the inline height so the content can scale responsively
window.setTimeout(function () {
	elem.style.height = '';
}, timing);
</code></pre>

<p>Becomes this&hellip;</p>

<pre><code class="language-lang-javascript">// Once the transition is complete, remove the inline height so the content can scale responsively
window.addEventListener('transitionend', function () {
	elem.style.height = '';
}, false);
</code></pre>

<p>And in our <code>hide()</code> method, this&hellip;</p>

<pre><code class="language-lang-javascript">// When the transition is complete, hide it
window.setTimeout(function () {
	elem.classList.remove('is-visible');
}, timing);
</code></pre>

<p>Becomes this&hellip;</p>

<pre><code class="language-lang-javascript">// When the transition is complete, hide it
window.addEventListener('transitionend', function () {
	elem.classList.remove('is-visible');
}, false);
</code></pre>

<p>We can also remove our <code>getTiming()</code> method, since we&rsquo;re automatically detecting the transition end now.</p>

<p><a href="https://jsfiddle.net/cferdinandi/qgpxvhhb/63/">Here&rsquo;s a demo of what we&rsquo;ve got so far.</a></p>

<h2 id="removing-our-event-listeners-after-they-run">Removing our event listeners after they run</h2>

<p>One thing you might notice about the demo above is that if you open some content, close it, and then try to open it again, it automatically closes itself.</p>

<p>Each click is adding an event listener, so we have multiple listeners running and competing with each other. We need to remove our listener after it runs.</p>

<p>To do that, we&rsquo;ll give our listener a named function instead of an anonymous one.</p>

<pre><code class="language-lang-javascript">// Once the transition is complete, remove the inline height so the content can scale responsively
window.addEventListener('transitionend', function removeHeight () {
	elem.style.height = '';
}, false);
</code></pre>

<p>Then we&rsquo;ll remove it with <code>removeEventListener()</code> after it runs. <code>removeEventListener()</code> requires a named function and all of the same exact parameters to work properly.</p>

<pre><code class="language-lang-javascript">// Once the transition is complete, remove the inline height so the content can scale responsively
window.addEventListener('transitionend', function removeHeight () {
	elem.style.height = '';
	window.removeEventListener('transitionend', removeHeight, false);
}, false);
</code></pre>

<p>We&rsquo;ll do the same thing under our <code>hide()</code> method.</p>

<pre><code class="language-lang-javascript">// When the transition is complete, hide it
window.addEventListener('transitionend', function removeVisibility () {
	elem.classList.remove('is-visible');
	window.removeEventListener('transitionend', removeVisibility, false);
}, false);
</code></pre>

<p><a href="https://jsfiddle.net/cferdinandi/qgpxvhhb/64/">Here&rsquo;s a demo with our updated script.</a></p>

<h2 id="checking-for-the-transition-type">Checking for the transition type</h2>

<p>In our simple demo, we know exactly what transitions are happening on the element and can be certain the first one is what we want to trigger our behavior.</p>

<p>In a real website or app, that might not be the case. To make our code more resilient, we should check to see which transition type is happening and only run it if it&rsquo;s for <code>height</code>.</p>

<p>To accomplish this, we&rsquo;ll pass in <code>event</code> as an argument into our function and check the <code>propertyName</code> property.</p>

<pre><code class="language-lang-javascript">// Once the transition is complete, remove the inline max-height so the content can scale responsively
window.addEventListener('transitionend', function removeHeight (event) {
	if (!event.propertyName === 'height') return;
	elem.style.height = '';
	window.removeEventListener('transitionend', removeHeight, false);
}, false);
</code></pre>

<p>Here, we&rsquo;re checking to see if the <code>propertyName</code> is <code>height</code>. If not, we bail on our function. We&rsquo;ll do the same thing with our <code>hide()</code> method.</p>

<pre><code class="language-lang-javascript">// When the transition is complete, hide it
window.addEventListener('transitionend', function removeVisibility (event) {
	if (!event.propertyName === 'height') return;
	elem.classList.remove('is-visible');
	window.removeEventListener('transitionend', removeVisibility, false);
}, false);
</code></pre>

<p><a href="https://jsfiddle.net/cferdinandi/qgpxvhhb/66/">Here&rsquo;s a demo with the transition type check in place.</a></p>

<h2 id="event-prefixes">Event Prefixes</h2>

<p>Older versions of Chrome, Android, Webkit, Safari, and Opera used vendor-prefixed versions of <code>transitionend</code> (ex. <code>webkitTransitionEnd</code>).</p>

<p>The affected browsers are many versions old at this point, but if you want to ensure that even someone using a version of Chrome or Opera that&rsquo;s dozens of versions behind can use your code, there&rsquo;s a method we can add to determine which event to listen for (shoutout to Diego for sharing this part, as well).</p>

<pre><code class="language-lang-javascript">// Get the event name
// Adapted from Modernizr: https://modernizr.com
var whichTransitionEvent = function () {
	var el = document.createElement('fakeelement');
	var transitions = {
		'transition': 'transitionend',
		'OTransition': 'oTransitionEnd',
		'MozTransition': 'transitionend',
		'WebkitTransition': 'webkitTransitionEnd'
	}

	for (var t in transitions) {
		if (el.style[t] !== undefined) {
			return transitions[t];
		}
	}
};
</code></pre>

<p>Then in our <code>show()</code> and <code>hide()</code> methods, we&rsquo;ll do this.</p>

<pre><code class="language-lang-javascript">// Get transition type
var transition = whichTransitionEvent();

// Once the transition is complete, remove the inline max-height so the content can scale responsively
window.addEventListener(transition, function removeHeight (event) {
	if (!event.propertyName === 'height') return;
	elem.style.height = '';
	window.removeEventListener(transition, removeHeight, false);
}, false);
</code></pre>

<p>Given how old the affect browsers are, I&rsquo;ll personally stick to the standard event names only, but your use case may vary.</p>

<h2 id="putting-it-all-together">Putting it all together</h2>

<p>Here&rsquo;s our completed script (without vendor prefixes).</p>

<pre><code class="language-lang-javascript">// Show an element
var show = function (elem) {

	// Get the natural height of the element
	var getHeight = function () {
		elem.style.display = 'block'; // Make it visible
		var height = elem.scrollHeight + 'px'; // Get it's height
		elem.style.display = ''; //  Hide it again
		return height;
	};

	var height = getHeight(); // Get the natural height
	elem.classList.add('is-visible'); // Make the element visible
	elem.style.height = height; // Update the max-height

	// Once the transition is complete, remove the inline max-height so the content can scale responsively
	window.addEventListener('transitionend', function removeHeight (event) {
		if (!event.propertyName === 'height') return;
		elem.style.height = '';
		window.removeEventListener('transitionend', removeHeight, false);
	}, false);

};

// Hide an element
var hide = function (elem) {

	// Give the element a height to change from
	elem.style.height = elem.scrollHeight + 'px';

	// Set the height back to 0
	window.setTimeout(function () {
		elem.style.height = '0';
	}, 1);

	// When the transition is complete, hide it
	window.addEventListener('transitionend', function removeVisibility (event) {
		if (!event.propertyName === 'height') return;
		elem.classList.remove('is-visible');
		window.removeEventListener('transitionend', removeVisibility, false);
	}, false);

};

// Toggle element visibility
var toggle = function (elem, timing) {

	// If the element is visible, hide it
	if (elem.classList.contains('is-visible')) {
		hide(elem);
		return;
	}

	// Otherwise, show it
	show(elem);

};
</code></pre>


</article>

	<br>
<aside>
	<p><mark>🚀 <em><strong>Make 2018 the year you master JavaScript!</strong> My <a href="https://gomakethings.com/guides/">pocket guides</a> and <a href="https://gomakethings.com/courses/">mini courses</a> are short, focused, and made for beginners. You can do this!</em></mark></p>

	<p><em>Have any questions or comments about this post? Email me at <a href="mailto:&#099;&#104;&#114;&#105;&#115;&#064;&#103;&#111;&#109;&#097;&#107;&#101;&#116;&#104;&#105;&#110;&#103;&#115;&#046;&#099;&#111;&#109;">&#099;&#104;&#114;&#105;&#115;&#064;&#103;&#111;&#109;&#097;&#107;&#101;&#116;&#104;&#105;&#110;&#103;&#115;&#046;&#099;&#111;&#109;</a> or contact me on Twitter at <a href="http://twitter.com/ChrisFerdinandi">@ChrisFerdinandi</a>.</em></p>

	<form action="https://gomakethings.us1.list-manage.com/subscribe/post?u=f2d244c0df42a0431bd08ddea&amp;id=aeaa9dd034" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" target="_blank">
	<div class="row">
		<div class="grid-two-thirds">
			<div class="tarpit">
				<label for="name">Don't fill this field in</label>
				<input type="text" name="b_f2d244c0df42a0431bd08ddea_aeaa9dd034" id="name" value="">
			</div>
			<div>
				<label class="screen-reader" for="mce-EMAIL">Email Address</label>
				<input type="email" name="EMAIL" id="mce-EMAIL" title="The domain portion of the email address is invalid (the part after the @)." pattern="^([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22))*\x40([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d))*(\.\w{2,})+$" placeholder="Your email address..." required>
			</div>
			<input type="hidden" value="16" name="group[6981][16]" id="mce-group[6981]-6981-0">
		</div>
		<div class="grid-third">
			<button class="btn btn-block" type="submit">Get Daily Developer Tips</button>
		</div>
	</div>
	<div class="mc-status"></div>
</form>
</aside>

			</div>
		</main>

		<footer class="container container-large">
			<hr class="margin-bottom">
			<nav class="tabindex nav-secondary" id="nav-secondary" tabindex="-1">
	<ul class="list-inline list-inline-responsive">
		<li><a href="https://gomakethings.com/about">About</a></li><li><a href="https://gomakethings.com/guides">Guides</a></li><li><a href="https://gomakethings.com/courses">Courses</a></li><li><a href="https://gomakethings.com/resources">Resources</a></li><li><a href="https://gomakethings.com/articles">Daily Tips</a></li>
	</ul>
</nav>
			<p class="text-small">Made with ❤️ in Massachussets. Unless otherwise noted, all code is free to use under the <a href="/mit">MIT License</a>.</p>
		</footer>

		<script src="https://gomakethings.com/js/loadJS.min.1.1.0.js"></script>
		<script>
			if ('querySelector' in document && 'addEventListener' in window) {
				loadJS('https:\/\/gomakethings.com\/js\/main.min.1.1.0.js');
			}
		</script>
	</body>
</html>