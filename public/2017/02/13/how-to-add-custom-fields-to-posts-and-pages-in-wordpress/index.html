<!DOCTYPE html>
<html lang="en-us">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<title>How to add custom fields to posts and pages in WordPress | Go Make Things</title>
		

		
		<meta name="viewport" content="width=device-width, initial-scale=1">

		
		
		<link rel="shortcut icon" href="https://gomakethings.com/img/favicon.ico">
		<link rel="icon" sizes="16x16 32x32" href="https://gomakethings.com/img/favicon.ico">

		
		
		<link rel="alternate" type="application/rss+xml" title="Go Make Things RSS Feed" href="http://feeds.feedburner.com/GoMakeThings">
		<link rel="feed" type="application/rss+xml" title="Go Make Things RSS Feed" href="http://feeds.feedburner.com/GoMakeThings">

		
		<link rel="stylesheet" href="https://gomakethings.com/css/main.min.1.1.0.css">

		
		<script src="https://gomakethings.com/js/detects.min.1.1.0.js"></script>
		<script>
			;(function () {
				var css = 'https://fonts.googleapis.com/css?family=PT+Serif:400,400i,700,700i';
				if (getCookie('fontsLoaded')) {
					loadCSS(css);
					document.documentElement.className += 'fonts-loaded';
				} else {
					loadCSS(css);
					var font = new FontFaceObserver('PT Serif');
					font.load().then(function () {
						var expires = new Date(+new Date() + (7 * 24 * 60 * 60 * 1000)).toUTCString();
						document.cookie = 'fontsLoaded=true; expires=' + expires;
						document.documentElement.className += ' fonts-loaded';
					});
				}
			})();
		</script>
	</head>

	<body>

		<div class="container container-large">

	
	<a class="screen-reader screen-reader-focusable" href="#main">Skip to main content</a>

	
	<a class="screen-reader screen-reader-focusable" href="mailto:&#099;&#104;&#114;&#105;&#115;&#064;&#103;&#111;&#109;&#097;&#107;&#101;&#116;&#104;&#105;&#110;&#103;&#115;&#046;&#099;&#111;&#109;?subject=Go%20Make%20Things:%20Accessibility%20Feedback">Accessibility Feedback</a>

</div>

		<header class="container container-large margin-bottom-large">
	<nav class="nav-wrap">
		<a class="logo" href="https://gomakethings.com">
			<svg xmlns="http://www.w3.org/2000/svg" style="height:.8em;width:.8em" viewBox="0 0 16 16"><title></title><path fill="currentColor" d="M14 9v2.066c-1.258 1.285-3.016 2.526-5 2.852V8.001h3v-1L9 5.83A3.001 3.001 0 0 0 8 .001 3 3 0 0 0 7 5.83L4 7.001v1h3v5.917c-1.984-.326-3.742-1.567-5-2.852V9H0v1c0 2 4 6 8 6s8-4 8-6V9h-2zM9 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/></svg>
			Go Make Things
		</a>
		<div class="nav-menu" id="nav-menu">
			<ul class="nav">
				<li><a href="https://gomakethings.com/about">About</a></li><li><a href="https://gomakethings.com/guides">Guides</a></li><li><a href="https://gomakethings.com/courses">Courses</a></li><li><a href="https://gomakethings.com/resources">Resources</a></li><li><a href="https://gomakethings.com/articles">Daily Tips</a></li>
			</ul>
		</div>
	</nav>
</header>

		<main id="main" tabindex="-1">

			<div class="container">

	<article>

	
	<h1><span class="title">How to add custom fields to posts and pages in WordPress</span></h1>
	

	

<p>Ever want to capture more data when creating a post or a page? Want to add some custom fields to your custom post type?</p>

<p>With WordPress&rsquo;s metabox functionality, you can! There are a few moving parts here, so let&rsquo;s walk through them one-by-one.</p>

<p><strong><em>Quick aside:</em></strong> <em>I&rsquo;m going to share some PHP snippets. Place them in a plugin, or (less ideally) your <code>functions.php</code> file.</em></p>

<h2 id="create-your-metabox">Create your metabox</h2>

<p>This has two parts:</p>

<ol>
<li>A function that sets up the metabox, giving it a name and telling WordPress which content types to load it on (posts, pages, some custom post type, etc.).</li>
<li>A function that generates the actual markup for the metabox.</li>
</ol>

<h3 id="setting-up-the-metabox">Setting up the metabox</h3>

<p>We can use the <code>add_meta_box()</code> function to create new metaboxes. We need to hook into WordPress&rsquo;s <code>add_meta_boxes</code> action hook.</p>

<p>In <code>add_meta_box()</code>, you&rsquo;ll give your metabox an ID, a name, a function to use to generate the markup, a post type to display it on (posts, pages, etc.), and a location and priority on the page.</p>

<p>The post type can only be a single value (not an array), so if you want to use your metabox on multiple post types, you&rsquo;ll need to repeat the <code>add_meta_box()</code> function a couple of times.</p>

<pre><code class="language-lang-php">/**
 * Create the metabox
 * @link https://developer.wordpress.org/reference/functions/add_meta_box/
 */
function _namespace_create_metabox() {

	// Can only be used on a single post type (ie. page or post or a custom post type).
	// Must be repeated for each post type you want the metabox to appear on.
	add_meta_box(
		'_namespace_metabox', // Metabox ID
		'Some Metabox', // Title to display
		'_namespace_render_metabox', // Function to call that contains the metabox content
		'post', // Post type to display metabox on
		'normal', // Where to put it (normal = main colum, side = sidebar, etc.)
		'default' // Priority relative to other metaboxes
	);

	// To add the metabox to a page, too, you'd repeat it, changing the location
	add_meta_box( '_namespace_metabox', 'Some Metabox', '_namespace_render_metabox', 'page', 'normal', 'default' // Priority relative to other metaboxes );

}
add_action( 'add_meta_boxes', '_namespace_create_metabox' );
</code></pre>

<h3 id="rendering-the-metabox-markup">Rendering the metabox markup</h3>

<p>Now we need to create content for the function specified in <code>add_meta_box()</code>.</p>

<p>We&rsquo;ll want to grab the <code>$post</code>, and get our saved field value (if one exists). We also need to include a security field that we&rsquo;ll check against to make sure this is a valid submission from the WordPress Dashboard.</p>

<p>You&rsquo;ll note that our field data is wrapped in an <code>esc_attr()</code> function. This escapes and encodes any data for proper use in an input field <code>value</code>.</p>

<pre><code class="language-lang-php">/**
 * Render the metabox markup
 * This is the function called in `_namespace_create_metabox()`
 */
function _namespace_render_metabox() {
	// Variables
	global $post; // Get the current post data
	$details = get_post_meta( $post-&gt;ID, '_namespace', true ); // Get the saved values
	?&gt;

		&lt;fieldset&gt;
			&lt;div&gt;
				&lt;label for=&quot;_namespace_custom_metabox&quot;&gt;
					&lt;?php
						// This runs the text through a translation and echoes it (for internationalization)
						_e( 'Item Name', '_namespace' );
					?&gt;
				&lt;/label&gt;
				&lt;?php
					// The `esc_attr()` function here escapes the data for
					// HTML attribute use to avoid unexpected issues
				?&gt;
				&lt;input
					type=&quot;text&quot;
					name=&quot;_namespace_custom_metabox&quot;
					id=&quot;_namespace_custom_metabox&quot;
					value=&quot;&lt;?php echo esc_attr( $details ); ?&gt;&quot;
				&gt;
			&lt;/div&gt;
		&lt;/fieldset&gt;

	&lt;?php
	// Security field
	// This validates that submission came from the
	// actual dashboard and not the front end or
	// a remote server.
	wp_nonce_field( '_namespace_form_metabox_nonce', '_namespace_form_metabox_process' );
}
</code></pre>

<h2 id="saving-your-metabox">Saving your metabox</h2>

<p>When the post or page is submitted, we want to save any data in our custom fields.</p>

<p>To do that, we first look to see if the submitted data contains our security field. If it does, we validate that field using the <code>wp_verify_nonce()</code> function. We also check that the submitting user has permission to edit the post.</p>

<p>Finally, we make sure that our field was submitted with data. If all criteria are met, we can save our field.</p>

<p>It&rsquo;s important to sanitize any data before saving it to the database. This prevents malicious code and scripts from being run on your server. We&rsquo;ll use the <code>wp_filter_post_kses()</code> function, which strips our dangerous code and allows through anything you can include a post.</p>

<pre><code class="language-lang-php">/**
 * Save the metabox
 * @param  Number $post_id The post ID
 * @param  Array  $post    The post data
 */
function _namespace_save_metabox( $post_id, $post ) {

	// Verify that our security field exists. If not, bail.
	if ( !isset( $_POST['_namespace_form_metabox_process'] ) ) return;

	// Verify data came from edit/dashboard screen
	if ( !wp_verify_nonce( $_POST['_namespace_form_metabox_process'], '_namespace_form_metabox_nonce' ) ) {
		return $post-&gt;ID;
	}

	// Verify user has permission to edit post
	if ( !current_user_can( 'edit_post', $post-&gt;ID )) {
		return $post-&gt;ID;
	}

	// Check that our custom fields are being passed along
	// This is the `name` value array. We can grab all
	// of the fields and their values at once.
	if ( !isset( $_POST['_namespace_custom_metabox'] ) ) {
		return $post-&gt;ID;
	}
	/**
	 * Sanitize the submitted data
	 * This keeps malicious code out of our database.
	 * `wp_filter_post_kses` strips our dangerous server values
	 * and allows through anything you can include a post.
	 */
	$sanitized = wp_filter_post_kses( $_POST['_namespace_custom_metabox'] );
	// Save our submissions to the database
	update_post_meta( $post-&gt;ID, '_namespace', $sanitized );

}
add_action( 'save_post', '_namespace_save_metabox', 1, 2 );
</code></pre>

<h2 id="saving-revision-history">Saving revision history</h2>

<p>This is optional, and potentially undesireable for certain data types, but you can save your field data to revision history. Restoring a a post to an old version will also update the metabox.</p>

<p>We&rsquo;ll hook into the <code>save_post</code> action hook to do this.</p>

<pre><code class="language-lang-php">/**
 * Save events data to revisions
 * @param  Number $post_id The post ID
 */
function _namespace_save_revisions( $post_id ) {

	// Check if it's a revision
	$parent_id = wp_is_post_revision( $post_id );

	// If is revision
	if ( $parent_id ) {

		// Get the saved data
		$parent = get_post( $parent_id );
		$details = get_post_meta( $parent-&gt;ID, '_namespace', true );

		// If data exists and is an array, add to revision
		if ( !empty( $details ) ) {
			add_metadata( 'post', $post_id, '_namespace', $details );
		}

	}

}
add_action( 'save_post', '_namespace_save_revisions' );
</code></pre>

<h3 id="restoring-from-revision-history">Restoring from revision history</h3>

<p>Naturally, when restoring a post, we&rsquo;ll want to update the metabox field value as well.</p>

<p>We&rsquo;ll hook into the <code>wp_restore_post_revision</code> action hook for this, updating the post meta value with the historic version.</p>

<pre><code class="language-lang-php">/**
 * Restore events data with post revisions
 * @param  Number $post_id     The post ID
 * @param  Number $revision_id The revision ID
 */
function _namespace_restore_revisions( $post_id, $revision_id ) {

	// Variables
	$post = get_post( $post_id ); // The post
	$revision = get_post( $revision_id ); // The revision
	$details = get_metadata( 'post', $revision-&gt;ID, '_namespace', true ); // The historic version

	// Replace our saved data with the old version
	update_post_meta( $post_id, '_namespace', $details );

}
add_action( 'wp_restore_post_revision', '_namespace_restore_revisions', 10, 2 );
</code></pre>

<h3 id="displaying-your-metabox-field-in-the-revisions-view">Displaying your metabox field in the revisions view</h3>

<p>If you want to be able to see the historic version in the revisions view, you&rsquo;ll need two additional functions.</p>

<p>First, we&rsquo;ll add a field to the revision fields with the <code>_wp_post_revision_fields</code> filter.</p>

<pre><code class="language-lang-php">/**
 * Get the data to display on the revisions page
 * @param  Array $fields The fields
 * @return Array The fields
 */
function _namespace_get_revisions_fields( $fields ) {
	// Set a title
	$fields['_namespace'] = 'Some Item';
	return $fields;
}
add_filter( '_wp_post_revision_fields', '_namespace_get_revisions_fields' );

Next, we'll tell WordPress to show that field on the revisions page with the `_wp_post_revision_field_my_meta` filter.

```lang-php
/**
 * Display the data on the revisions page
 * @param  String|Array $value The field value
 * @param  Array        $field The field
 */
function _namespace_display_revisions_fields( $value, $field ) {
	global $revision;
	return get_metadata( 'post', $revision-&gt;ID, $field, true );
}
add_filter( '_wp_post_revision_field_my_meta', '_namespace_display_revisions_fields', 10, 2 );
</code></pre>

<p>And now, you&rsquo;ve got a fully functioning custom field. You can <a href="https://gist.github.com/cferdinandi/b851efcd82534311310d545b0c1b870c">grab the full code from this tutorial on GitHub</a>.</p>

<p>In a future article, I&rsquo;ll show you how to work with multiple fields, set defaults, and avoid over-taxing your database.</p>


</article>

	<br>
<aside>
	<p><mark>🚀 <em><strong>Make 2018 the year you master JavaScript!</strong> My <a href="https://gomakethings.com/guides/">pocket guides</a> and <a href="https://gomakethings.com/courses/">mini courses</a> are short, focused, and made for beginners. You can do this!</em></mark></p>

	<p><em>Have any questions or comments about this post? Email me at <a href="mailto:&#099;&#104;&#114;&#105;&#115;&#064;&#103;&#111;&#109;&#097;&#107;&#101;&#116;&#104;&#105;&#110;&#103;&#115;&#046;&#099;&#111;&#109;">&#099;&#104;&#114;&#105;&#115;&#064;&#103;&#111;&#109;&#097;&#107;&#101;&#116;&#104;&#105;&#110;&#103;&#115;&#046;&#099;&#111;&#109;</a> or contact me on Twitter at <a href="http://twitter.com/ChrisFerdinandi">@ChrisFerdinandi</a>.</em></p>

	<form action="https://gomakethings.us1.list-manage.com/subscribe/post?u=f2d244c0df42a0431bd08ddea&amp;id=aeaa9dd034" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" target="_blank">
	<div class="row">
		<div class="grid-two-thirds">
			<div class="tarpit">
				<label for="name">Don't fill this field in</label>
				<input type="text" name="b_f2d244c0df42a0431bd08ddea_aeaa9dd034" id="name" value="">
			</div>
			<div>
				<label class="screen-reader" for="mce-EMAIL">Email Address</label>
				<input type="email" name="EMAIL" id="mce-EMAIL" title="The domain portion of the email address is invalid (the part after the @)." pattern="^([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22))*\x40([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d))*(\.\w{2,})+$" placeholder="Your email address..." required>
			</div>
			<input type="hidden" value="16" name="group[6981][16]" id="mce-group[6981]-6981-0">
		</div>
		<div class="grid-third">
			<button class="btn btn-block" type="submit">Get Daily Developer Tips</button>
		</div>
	</div>
	<div class="mc-status"></div>
</form>
</aside>

			</div>
		</main>

		<footer class="container container-large">
			<hr class="margin-bottom">
			<nav class="tabindex nav-secondary" id="nav-secondary" tabindex="-1">
	<ul class="list-inline list-inline-responsive">
		<li><a href="https://gomakethings.com/about">About</a></li><li><a href="https://gomakethings.com/guides">Guides</a></li><li><a href="https://gomakethings.com/courses">Courses</a></li><li><a href="https://gomakethings.com/resources">Resources</a></li><li><a href="https://gomakethings.com/articles">Daily Tips</a></li>
	</ul>
</nav>
			<p class="text-small">Made with ❤️ in Massachussets. Unless otherwise noted, all code is free to use under the <a href="/mit">MIT License</a>.</p>
		</footer>

		<script src="https://gomakethings.com/js/loadJS.min.1.1.0.js"></script>
		<script>
			if ('querySelector' in document && 'addEventListener' in window) {
				loadJS('https:\/\/gomakethings.com\/js\/main.min.1.1.0.js');
			}
		</script>
	</body>
</html>