<!DOCTYPE html>
<html lang="en-us">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<title>How I improved the speed of my WordPress site by 500% | Go Make Things</title>
		

		
		<meta name="viewport" content="width=device-width, initial-scale=1">

		
		
		<link rel="shortcut icon" href="https://gomakethings.com/img/favicon.ico">
		<link rel="icon" sizes="16x16 32x32" href="https://gomakethings.com/img/favicon.ico">

		
		
		<link rel="alternate" type="application/rss+xml" title="Go Make Things RSS Feed" href="http://feeds.feedburner.com/GoMakeThings">
		<link rel="feed" type="application/rss+xml" title="Go Make Things RSS Feed" href="http://feeds.feedburner.com/GoMakeThings">

		
		<link rel="stylesheet" href="https://gomakethings.com/css/main.min.1.1.0.css">

		
		<script src="https://gomakethings.com/js/detects.min.1.1.0.js"></script>
		<script>
			;(function () {
				var css = 'https://fonts.googleapis.com/css?family=PT+Serif:400,400i,700,700i';
				if (getCookie('fontsLoaded')) {
					loadCSS(css);
					document.documentElement.className += 'fonts-loaded';
				} else {
					loadCSS(css);
					var font = new FontFaceObserver('PT Serif');
					font.load().then(function () {
						var expires = new Date(+new Date() + (7 * 24 * 60 * 60 * 1000)).toUTCString();
						document.cookie = 'fontsLoaded=true; expires=' + expires;
						document.documentElement.className += ' fonts-loaded';
					});
				}
			})();
		</script>
	</head>

	<body>

		<div class="container container-large">

	
	<a class="screen-reader screen-reader-focusable" href="#main">Skip to main content</a>

	
	<a class="screen-reader screen-reader-focusable" href="mailto:&#099;&#104;&#114;&#105;&#115;&#064;&#103;&#111;&#109;&#097;&#107;&#101;&#116;&#104;&#105;&#110;&#103;&#115;&#046;&#099;&#111;&#109;?subject=Go%20Make%20Things:%20Accessibility%20Feedback">Accessibility Feedback</a>

</div>

		<header class="container container-large margin-bottom-large">
	<nav class="nav-wrap">
		<a class="logo" href="https://gomakethings.com">
			<svg xmlns="http://www.w3.org/2000/svg" style="height:.8em;width:.8em" viewBox="0 0 16 16"><title></title><path fill="currentColor" d="M14 9v2.066c-1.258 1.285-3.016 2.526-5 2.852V8.001h3v-1L9 5.83A3.001 3.001 0 0 0 8 .001 3 3 0 0 0 7 5.83L4 7.001v1h3v5.917c-1.984-.326-3.742-1.567-5-2.852V9H0v1c0 2 4 6 8 6s8-4 8-6V9h-2zM9 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/></svg>
			Go Make Things
		</a>
		<div class="nav-menu" id="nav-menu">
			<ul class="nav">
				<li><a href="https://gomakethings.com/about">About</a></li><li><a href="https://gomakethings.com/guides">Guides</a></li><li><a href="https://gomakethings.com/courses">Courses</a></li><li><a href="https://gomakethings.com/resources">Resources</a></li><li><a href="https://gomakethings.com/articles">Daily Tips</a></li>
			</ul>
		</div>
	</nav>
</header>

		<main id="main" tabindex="-1">

			<div class="container">

	<article>

	
	<h1><span class="title">How I improved the speed of my WordPress site by 500%</span></h1>
	

	

<p>Over the last few months, my <a href="https://gomakethings.com">WordPress site</a> had gone from a rather snappy 700ms start render time to upwards of 3 or 4 seconds.</p>

<p>With a few small changes, I was able to get my start render time back down to 700ms. Today, I want to show you how I did it.</p>

<h2 id="the-background">The background</h2>

<p>I&rsquo;ve added a lot of plugins as I&rsquo;ve focused on growing my business&mdash;<a href="easydigitaldownloads.com">Easy Digital Downloads</a> and a handful of extensions, as well as some custom MailChimp API integration stuff I wrote to help grow my email list.</p>

<p>To find the culprit, I went through the long and annoying process of:</p>

<ol>
<li>Deactivating every single plugin on my site,</li>
<li>Reactivating them one-at-a-time, and</li>
<li>Running a test on <a href="http://www.webpagetest.org/">WebPagetest</a> each time until the time to first byte increased.</li>
</ol>

<p>Here&rsquo;s what I found.</p>

<h2 id="why-time-to-first-byte">Why time to first byte?</h2>

<p>I use <a href="https://m.do.co/c/08a079d9bd9a">DigitalOcean</a> for my hosting. They&rsquo;re amazing. Their servers are super affordable and super fast.</p>

<p>(<em><strong>PS:</strong> that link above is an affiliate link that gets you a $10 credit to try them out.</em>)</p>

<p>That said, a few of my plugins involve some heavier server processes that slow things down. With template-based CMS&rsquo;s like WordPress, running on inexpensive hosting, this can be a large source of latency.</p>

<p>I run a caching plugin to pre-render my template files into static HTML, but some plugins can turn this behavior off if they need to always render content dynamically.</p>

<h2 id="what-i-found">What I found</h2>

<p>There were three plugins (written by me) that were causing almost all of my performance issues, and all three of them are form plugins that users can use to sign up for my newsletter or get details about my products.</p>

<p>To detect when they&rsquo;re submitted and make sure a robot isn&rsquo;t auto-submitting requests to a URL over and over again, I use the <a href="https://codex.wordpress.org/Function_Reference/wp_nonce_field"><code>wp_nonce_field</code> API</a>.</p>

<p>These fields are not compatible with caching, because they change in value every day or two. After that point, they&rsquo;ll stop working if users are served an older cached version of the file since the value won&rsquo;t match.</p>

<p>I include an email signup form on almost every page on my site, so for all intents and purposes, caching was turned off on my whole site.</p>

<h2 id="what-i-did">What I did</h2>

<p>I ripped out <code>wp_nonce_field</code> from all of the plugin forms, and replaced them with a <code>[NAMESPACE]_submit_id</code> hidden field. Here&rsquo;s how that works.</p>

<p>First, I added this to each plugin. It creates a custom hash for our <code>*_submit_id</code> field to use.</p>

<pre><code class="language-lang-php">/**
 * Create a random submit string hash
 */
function PLUGIN_NAMESPACE_set_submit_string() {

	if ( empty( get_site_option( 'PLUGIN_NAMESPACE_submit_hash' ) ) ) {
		update_site_option( 'PLUGIN_NAMESPACE_submit_hash', wp_generate_password( 24, false ) );
	}

}
add_action( 'plugins_loaded', 'PLUGIN_NAMESPACE_set_submit_string' );
</code></pre>

<p>Then, in our form itself, we&rsquo;ll add a field with that hash as it&rsquo;s value.</p>

<pre><code class="language-lang-php">$form =
	'&lt;form ...&gt;' .
		'&lt;input type=&quot;hidden&quot; id=&quot;PLUGIN_NAMESPACE_submit&quot; name=&quot;PLUGIN_NAMESPACE_submit&quot; value=&quot;' . get_site_option( 'PLUGIN_NAMESPACE_submit_hash' ) . '&quot;&gt;' .
		// Additional form stuff...
	'&lt;/form&gt;';
</code></pre>

<p>Finally, on submit, we check that:</p>

<ol>
<li>The field exists, and</li>
<li>The value matches our stored value.</li>
</ol>

<pre><code class="language-lang-php">/**
 * Process the form
 */
function PLUGIN_NAMESPACE_process_form() {

	// Check that form was submitted
	if ( !isset( $_POST['PLUGIN_NAMESPACE_submit'] ) ) return;

	// Verify data came from proper screen
	if ( strcmp( $_POST['PLUGIN_NAMESPACE_submit'], get_site_option( 'PLUGIN_NAMESPACE_submit_hash' ) ) !== 0 ) return;

	// Do the rest of your form tasks...

}
add_action( 'init', 'PLUGIN_NAMESPACE_process_form' );
</code></pre>

<p>Now, the form can be cached.</p>

<h2 id="what-about-success-and-error-messages">What about success and error messages?</h2>

<p>The problem with caching the form, of course, is that users won&rsquo;t get success and error messages after their submission. There&rsquo;s a way to get around this.</p>

<p>Most WordPress caching plugins will ignore URLs with query strings in them, since they often impact the content that&rsquo;s generated. We can use that to our advantage to force an uncached version of the form after a submit.</p>

<pre><code class="language-lang-php">/**
 * Process the form
 */
function PLUGIN_NAMESPACE_process_form() {

	// Check that form was submitted
	if ( !isset( $_POST['PLUGIN_NAMESPACE_submit'] ) ) return;

	// Verify data came from proper screen
	if ( strcmp( $_POST['PLUGIN_NAMESPACE_submit'], get_site_option( 'PLUGIN_NAMESPACE_submit_hash' ) ) !== 0 ) return;

	// Create a cache-breaking URL
	$referrer = 'the-url-to-your-form.com'; // How you get this depends on how you've setup your plugin
	$status_redirect = add_query_arg( 'PLUGIN-NAMESPACE-form', 'submitted', $referrer );

	// Do the rest of your form tasks...

	// Redirect and break cache
	wp_safe_redirect( $status, 302 );
	exit;

}
add_action( 'init', 'PLUGIN_NAMESPACE_process_form' );
</code></pre>

<h2 id="any-downsides-to-this-approach">Any downsides to this approach?</h2>

<p>Because our hidden form field value never changes, someone who wants to spam your form could do so by repeatedly submitting to a static URL with form data.</p>

<p>However, because that field&rsquo;s value is being generated uniquely for your site and not shared across anyone who uses the plugin, someone needs to specifically target your site.</p>

<p>I also employ additional spam prevention measures like time-based and field-value based honeypots.</p>

<p>Now, my entire site is cached, and I&rsquo;m seeing 700ms start render times again.</p>


</article>

	<br>
<aside>
	<p><mark>🚀 <em><strong>Make 2018 the year you master JavaScript!</strong> My <a href="https://gomakethings.com/guides/">pocket guides</a> and <a href="https://gomakethings.com/courses/">mini courses</a> are short, focused, and made for beginners. You can do this!</em></mark></p>

	<p><em>Have any questions or comments about this post? Email me at <a href="mailto:&#099;&#104;&#114;&#105;&#115;&#064;&#103;&#111;&#109;&#097;&#107;&#101;&#116;&#104;&#105;&#110;&#103;&#115;&#046;&#099;&#111;&#109;">&#099;&#104;&#114;&#105;&#115;&#064;&#103;&#111;&#109;&#097;&#107;&#101;&#116;&#104;&#105;&#110;&#103;&#115;&#046;&#099;&#111;&#109;</a> or contact me on Twitter at <a href="http://twitter.com/ChrisFerdinandi">@ChrisFerdinandi</a>.</em></p>

	<form action="https://gomakethings.us1.list-manage.com/subscribe/post?u=f2d244c0df42a0431bd08ddea&amp;id=aeaa9dd034" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" target="_blank">
	<div class="row">
		<div class="grid-two-thirds">
			<div class="tarpit">
				<label for="name">Don't fill this field in</label>
				<input type="text" name="b_f2d244c0df42a0431bd08ddea_aeaa9dd034" id="name" value="">
			</div>
			<div>
				<label class="screen-reader" for="mce-EMAIL">Email Address</label>
				<input type="email" name="EMAIL" id="mce-EMAIL" title="The domain portion of the email address is invalid (the part after the @)." pattern="^([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22))*\x40([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d))*(\.\w{2,})+$" placeholder="Your email address..." required>
			</div>
			<input type="hidden" value="16" name="group[6981][16]" id="mce-group[6981]-6981-0">
		</div>
		<div class="grid-third">
			<button class="btn btn-block" type="submit">Get Daily Developer Tips</button>
		</div>
	</div>
	<div class="mc-status"></div>
</form>
</aside>

			</div>
		</main>

		<footer class="container container-large">
			<hr class="margin-bottom">
			<nav class="tabindex nav-secondary" id="nav-secondary" tabindex="-1">
	<ul class="list-inline list-inline-responsive">
		<li><a href="https://gomakethings.com/about">About</a></li><li><a href="https://gomakethings.com/guides">Guides</a></li><li><a href="https://gomakethings.com/courses">Courses</a></li><li><a href="https://gomakethings.com/resources">Resources</a></li><li><a href="https://gomakethings.com/articles">Daily Tips</a></li>
	</ul>
</nav>
			<p class="text-small">Made with ❤️ in Massachussets. Unless otherwise noted, all code is free to use under the <a href="/mit">MIT License</a>.</p>
		</footer>

		<script src="https://gomakethings.com/js/loadJS.min.1.1.0.js"></script>
		<script>
			if ('querySelector' in document && 'addEventListener' in window) {
				loadJS('https:\/\/gomakethings.com\/js\/main.min.1.1.0.js');
			}
		</script>
	</body>
</html>