<!DOCTYPE html>
<html lang="en-us">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<title>Smarter polyfill loading with polyfill.io | Go Make Things</title>
		

		
		<meta name="viewport" content="width=device-width, initial-scale=1">

		
		
		<link rel="shortcut icon" href="https://gomakethings.com/img/favicon.ico">
		<link rel="icon" sizes="16x16 32x32" href="https://gomakethings.com/img/favicon.ico">

		
		
		<link rel="alternate" type="application/rss+xml" title="Go Make Things RSS Feed" href="http://feeds.feedburner.com/GoMakeThings">
		<link rel="feed" type="application/rss+xml" title="Go Make Things RSS Feed" href="http://feeds.feedburner.com/GoMakeThings">

		
		<link rel="stylesheet" href="https://gomakethings.com/css/main.min.1.1.0.css">

		
		<script src="https://gomakethings.com/js/detects.min.1.1.0.js"></script>
		<script>
			;(function () {
				var css = 'https://fonts.googleapis.com/css?family=PT+Serif:400,400i,700,700i';
				if (getCookie('fontsLoaded')) {
					loadCSS(css);
					document.documentElement.className += 'fonts-loaded';
				} else {
					loadCSS(css);
					var font = new FontFaceObserver('PT Serif');
					font.load().then(function () {
						var expires = new Date(+new Date() + (7 * 24 * 60 * 60 * 1000)).toUTCString();
						document.cookie = 'fontsLoaded=true; expires=' + expires;
						document.documentElement.className += ' fonts-loaded';
					});
				}
			})();
		</script>
	</head>

	<body>

		<div class="container container-large">

	
	<a class="screen-reader screen-reader-focusable" href="#main">Skip to main content</a>

	
	<a class="screen-reader screen-reader-focusable" href="mailto:&#099;&#104;&#114;&#105;&#115;&#064;&#103;&#111;&#109;&#097;&#107;&#101;&#116;&#104;&#105;&#110;&#103;&#115;&#046;&#099;&#111;&#109;?subject=Go%20Make%20Things:%20Accessibility%20Feedback">Accessibility Feedback</a>

</div>

		<header class="container container-large margin-bottom-large">
	<nav class="nav-wrap">
		<a class="logo" href="https://gomakethings.com">
			<svg xmlns="http://www.w3.org/2000/svg" style="height:.8em;width:.8em" viewBox="0 0 16 16"><title></title><path fill="currentColor" d="M14 9v2.066c-1.258 1.285-3.016 2.526-5 2.852V8.001h3v-1L9 5.83A3.001 3.001 0 0 0 8 .001 3 3 0 0 0 7 5.83L4 7.001v1h3v5.917c-1.984-.326-3.742-1.567-5-2.852V9H0v1c0 2 4 6 8 6s8-4 8-6V9h-2zM9 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/></svg>
			Go Make Things
		</a>
		<div class="nav-menu" id="nav-menu">
			<ul class="nav">
				<li><a href="https://gomakethings.com/about">About</a></li><li><a href="https://gomakethings.com/guides">Guides</a></li><li><a href="https://gomakethings.com/courses">Courses</a></li><li><a href="https://gomakethings.com/resources">Resources</a></li><li><a href="https://gomakethings.com/articles">Daily Tips</a></li>
			</ul>
		</div>
	</nav>
</header>

		<main id="main" tabindex="-1">

			<div class="container">

	<article>

	
	<h1><span class="title">Smarter polyfill loading with polyfill.io</span></h1>
	

	

<p>Yesterday, I showed you <a href="/should-you-conditionally-load-polyfills/">how to use polyfill.io to conditionally load polyfills</a> only for the browsers that need them.</p>

<p>What JavaScript methods and browser APIs does <a href="https://polyfill.io">polyfill.io</a> support? <a href="https://polyfill.io/v2/docs/features/">Quite a few!</a></p>

<h2 id="two-small-issues-with-how-polyfill-io-works">Two small issues with how polyfill.io works</h2>

<p>If you browse through the list on their website, you&rsquo;ll notice many of the features have a star (★) next to them. These are the methods and APIs that are supported by default, and automatically sent to browsers that don&rsquo;t support them natively.</p>

<p>It&rsquo;s a great list of commonly used and lightweight features, but probably includes a bunch of stuff you don&rsquo;t need on a project.</p>

<p>Polyfill.io also needs two round trips to the server to get your polyfills. On the first pass, it detects the visitor&rsquo;s browser, then sends that info back to the server, which generates and sends along the correct set of polyfills (the second trip).</p>

<h2 id="detecting-features-and-skipping-a-trip">Detecting features and skipping a trip</h2>

<p><a href="https://polyfill.io/v2/docs/api">Polyfill.io has an API</a> that let&rsquo;s you control how it works with a few query string values.</p>

<p>You can use the API to skip the first round trip and serve up a smaller file.</p>

<p>To do this, we&rsquo;ll use feature tests to check for support for just the polyfills you need, and tell polyfill.io to send along just those. Here&rsquo;s how it works&hellip;</p>

<h3 id="1-create-a-list-of-the-features-this-browser-needs">1. Create a list of the features this browser needs</h3>

<p>First, we&rsquo;ll set up an array, <code>features</code>, to hold the list of features we need polyfills for. Then, we&rsquo;ll create a few quick browser tests to check if those features are supported.</p>

<p>For example, let&rsquo;s check for the CustomEvent API, <code>Array.forEach()</code>, <code>matches()</code>, and <code>classList()</code>.</p>

<pre><code class="language-lang-js">/**
 * Create a list of the features this browser needs
 */

// Setup our features array
var features = [];

// CustomEvent API
if (typeof window.CustomEvent !== 'function') { features.push('CustomEvent'); }

// Array.forEach()
if (window.Array &amp;&amp; !Array.prototype.forEach) { features.push('Array.prototype.forEach'); }

// Element.matches()
if (!Element.prototype.matches) { features.push('Element.prototype.matches'); }

// Element.classList()
if (!('classList' in document.createElement('_'))) { features.push('Element.prototype.classList'); }
</code></pre>

<p>With each check, if the feature is <em>not</em> supported natively, we use <code>push()</code> to add that feature to our <code>features</code> array.</p>

<p>How do you know what the feature name is? <a href="https://polyfill.io/v2/docs/features/#feature-list">Polyfill.io has a long feature list.</a></p>

<h3 id="2-add-the-loadjs-helper-method">2. Add the <code>loadJS()</code> helper method.</h3>

<p>Yesterday, I mentioned <a href="https://github.com/filamentgroup/loadJS/">loadJS</a>, a super useful helper method from the <a href="https://www.filamentgroup.com/">Filament Group</a> to lets you asynchronously load a JS file and run a callback once it&rsquo;s ready.</p>

<p>We&rsquo;ll use that to load polyfill.io and our scripts.</p>

<pre><code class="language-lang-js">/**
 * loadJS by Filament Group
 * Async load JS files
 * https://github.com/filamentgroup/loadJS/
 */
var loadJS = function (src, cb) {
	// ...
};
</code></pre>

<h3 id="3-load-polyfill-io-and-our-scripts">3. Load polyfill.io and our scripts</h3>

<p>Finally, we&rsquo;ll load polyfill.io and our scripts.</p>

<p>We&rsquo;ll check the length of the <code>features</code> array to see if any features need to be polyfilled. If it has at least one item, we&rsquo;ll call polyfill.io. Otherwise, we&rsquo;ll immediately load our main scripts file.</p>

<pre><code class="language-lang-js">// If any features need a polyfill, load Polyfill.io, then our scripts
// Otherwise, just load our scripts
if (features.length &gt; 0) {
	// load polyfill.io
} else {
	// No polyfills needed, so just load the main.js file
}
</code></pre>

<p>We&rsquo;ll use a few query string values with polyfill.io.</p>

<p>First, we&rsquo;ll set <code>features</code> to our features list, separated with a comma. We&rsquo;ll use the <code>join()</code> method to turn our array into a string.</p>

<pre><code class="language-lang-js">'https://cdn.polyfill.io/v2/polyfill.min.js?features=' + features.join(',');
</code></pre>

<p>Next, we&rsquo;ll add what polyfill.io calls flags: <code>always</code> and <code>gated</code>.</p>

<p>The <code>always</code> flag tells polyfill.io to include the requested features whether polyfill.io thinks your browser needs them or not (more on why we need that in a second). The <code>gated</code> flag tells the polyfills to include their own feature test before executing, in case our simple feature tests got it wrong.</p>

<pre><code class="language-lang-js">'https://cdn.polyfill.io/v2/polyfill.min.js?features=' + features.join(',') + '&amp;flags=gated,always';
</code></pre>

<p>Finally, we&rsquo;ll include a valid user agent value. This tells polyfill.io not to run its own UA check, and is why we need to use the <code>always</code> feature. Otherwise, polyfill.io would just send along polyfills for whatever browser UA you specified.</p>

<pre><code class="language-lang-js">'https://cdn.polyfill.io/v2/polyfill.min.js?features=' + features.join(',') + '&amp;flags=gated,always&amp;ua=chrome/50'
</code></pre>

<p>Now we can call polyfill.io, and once it&rsquo;s loaded, run <code>loadJS()</code> again with our main scripts file.</p>

<pre><code class="language-lang-js">/**
 * Load polyfill.io and scripts
 */

// If any features need a polyfill, load Polyfill.io, then our scripts
// Otherwise, just load our scripts
if (features.length &gt; 0) {
	// Include a `ua` argument set to a supported browser to skip UA identification
	// (improves response time) and avoid being treated as unknown UA (which would
	// otherwise result in no polyfills, even with `always`, if UA is unknown)
	loadJS('https://cdn.polyfill.io/v2/polyfill.min.js?features=' + features.join(',') + '&amp;flags=gated,always&amp;ua=chrome/50', function () {
		// Once polyfill.io is loaded, load our main scripts
		loadJS('/path/to/main.js');
	});
} else {
	// No polyfills needed, so just load the main.js file
}
</code></pre>

<p>Finally, if polyfill.io isn&rsquo;t needed, we can immediately load our main scripts with <code>loadJS()</code>.</p>

<pre><code class="language-lang-js">/**
 * Load polyfill.io and scripts
 */

// If any features need a polyfill, load Polyfill.io, then our scripts
// Otherwise, just load our scripts
if (features.length &gt; 0) {
	// Include a `ua` argument set to a supported browser to skip UA identification
	// (improves response time) and avoid being treated as unknown UA (which would
	// otherwise result in no polyfills, even with `always`, if UA is unknown)
	loadJS('https://cdn.polyfill.io/v2/polyfill.min.js?features=' + features.join(',') + '&amp;flags=gated,always&amp;ua=chrome/50', function () {
		// Once polyfill.io is loaded, load our main scripts
		loadJS('/path/to/main.js');
	});
} else {
	// No polyfills needed, so just load the main.js file
	loadJS('/path/to/main.js');
}
</code></pre>

<h2 id="putting-it-all-together">Putting it all together</h2>

<p>Here&rsquo;s the full JavaScript to make this work.</p>

<pre><code class="language-lang-js">/**
 * Create a list of the features this browser needs
 */

// Setup our features array
var features = [];

// CustomEvent API
if (typeof window.CustomEvent !== 'function') { features.push('CustomEvent'); }

// Array.forEach()
if (window.Array &amp;&amp; !Array.prototype.forEach) { features.push('Array.prototype.forEach'); }

// Element.matches()
if (!Element.prototype.matches) { features.push('Element.prototype.matches'); }

// Element.classList()
if (!('classList' in document.createElement('_'))) { features.push('Element.prototype.classList'); }


/**
 * loadJS by Filament Group
 * Async load JS files
 * https://github.com/filamentgroup/loadJS/
 */
var loadJS = function (src, cb) {
	// ...
};


/**
 * Load polyfill.io and scripts
 */

// If any features need a polyfill, load Polyfill.io, then our scripts
// Otherwise, just load our scripts
if (features.length &gt; 0) {
	// Include a `ua` argument set to a supported browser to skip UA identification
	// (improves response time) and avoid being treated as unknown UA (which would
	// otherwise result in no polyfills, even with `always`, if UA is unknown)
	loadJS('https://cdn.polyfill.io/v2/polyfill.min.js?features=' + features.join(',') + '&amp;flags=gated,always&amp;ua=chrome/50', function () {
		// Once polyfill.io is loaded, load our main scripts
		loadJS('/path/to/main.js');
	});
} else {
	// No polyfills needed, so just load the main.js file
	loadJS('/path/to/main.js');
}
</code></pre>

<h2 id="downsides-to-this-approach">Downsides to this approach</h2>

<p>This approach has some nice advantages, but it has some disadvantages, too.</p>

<p>Once of my favorite things about polyfill.io is the set-it-and-forget aspect of it. I don&rsquo;t have to <em>think</em> about what polyfills I need. Polyfill.io just takes care of it.</p>

<p>With this approach, you need to very consciously choose what polyfills to check for and load. You also need to know how to write your own polyfill tests, where as the by default polyfill.io just kind of handles that piece for you.</p>

<p>I personally think the slight performance hit from the second round trip, and slightly bigger file (for all but the oldest browsers it&rsquo;s generally 5kb or less minified and gzipped) is a worthwhile tradeoff for effortless polyfilling. From a performance standpoint, that&rsquo;s an inconsequential file size, and its <em>way</em> smaller than most popular libraries and frameworks.</p>

<p>In other words, I use the default implementation, but you may prefer not to.</p>


</article>

	<br>
<aside>
	<p><mark>🚀 <em><strong>Make 2018 the year you master JavaScript!</strong> My <a href="https://gomakethings.com/guides/">pocket guides</a> and <a href="https://gomakethings.com/courses/">mini courses</a> are short, focused, and made for beginners. You can do this!</em></mark></p>

	<p><em>Have any questions or comments about this post? Email me at <a href="mailto:&#099;&#104;&#114;&#105;&#115;&#064;&#103;&#111;&#109;&#097;&#107;&#101;&#116;&#104;&#105;&#110;&#103;&#115;&#046;&#099;&#111;&#109;">&#099;&#104;&#114;&#105;&#115;&#064;&#103;&#111;&#109;&#097;&#107;&#101;&#116;&#104;&#105;&#110;&#103;&#115;&#046;&#099;&#111;&#109;</a> or contact me on Twitter at <a href="http://twitter.com/ChrisFerdinandi">@ChrisFerdinandi</a>.</em></p>

	<form action="https://gomakethings.us1.list-manage.com/subscribe/post?u=f2d244c0df42a0431bd08ddea&amp;id=aeaa9dd034" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" target="_blank">
	<div class="row">
		<div class="grid-two-thirds">
			<div class="tarpit">
				<label for="name">Don't fill this field in</label>
				<input type="text" name="b_f2d244c0df42a0431bd08ddea_aeaa9dd034" id="name" value="">
			</div>
			<div>
				<label class="screen-reader" for="mce-EMAIL">Email Address</label>
				<input type="email" name="EMAIL" id="mce-EMAIL" title="The domain portion of the email address is invalid (the part after the @)." pattern="^([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22))*\x40([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d))*(\.\w{2,})+$" placeholder="Your email address..." required>
			</div>
			<input type="hidden" value="16" name="group[6981][16]" id="mce-group[6981]-6981-0">
		</div>
		<div class="grid-third">
			<button class="btn btn-block" type="submit">Get Daily Developer Tips</button>
		</div>
	</div>
	<div class="mc-status"></div>
</form>
</aside>

			</div>
		</main>

		<footer class="container container-large">
			<hr class="margin-bottom">
			<nav class="tabindex nav-secondary" id="nav-secondary" tabindex="-1">
	<ul class="list-inline list-inline-responsive">
		<li><a href="https://gomakethings.com/about">About</a></li><li><a href="https://gomakethings.com/guides">Guides</a></li><li><a href="https://gomakethings.com/courses">Courses</a></li><li><a href="https://gomakethings.com/resources">Resources</a></li><li><a href="https://gomakethings.com/articles">Daily Tips</a></li>
	</ul>
</nav>
			<p class="text-small">Made with ❤️ in Massachussets. Unless otherwise noted, all code is free to use under the <a href="/mit">MIT License</a>.</p>
		</footer>

		<script src="https://gomakethings.com/js/loadJS.min.1.1.0.js"></script>
		<script>
			if ('querySelector' in document && 'addEventListener' in window) {
				loadJS('https:\/\/gomakethings.com\/js\/main.min.1.1.0.js');
			}
		</script>
	</body>
</html>