<!DOCTYPE html>
<html lang="en-us">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<title>Fixing Fonts | Go Make Things</title>
		

		
		<meta name="viewport" content="width=device-width, initial-scale=1">

		
		
		<link rel="shortcut icon" href="https://gomakethings.com/img/favicon.ico">
		<link rel="icon" sizes="16x16 32x32" href="https://gomakethings.com/img/favicon.ico">

		
		
		<link rel="alternate" type="application/rss+xml" title="Go Make Things RSS Feed" href="http://feeds.feedburner.com/GoMakeThings">
		<link rel="feed" type="application/rss+xml" title="Go Make Things RSS Feed" href="http://feeds.feedburner.com/GoMakeThings">

		
		<link rel="stylesheet" href="https://gomakethings.com/css/main.min.1.1.0.css">

		
		<script src="https://gomakethings.com/js/detects.min.1.1.0.js"></script>
		<script>
			;(function () {
				var css = 'https://fonts.googleapis.com/css?family=PT+Serif:400,400i,700,700i';
				if (getCookie('fontsLoaded')) {
					loadCSS(css);
					document.documentElement.className += 'fonts-loaded';
				} else {
					loadCSS(css);
					var font = new FontFaceObserver('PT Serif');
					font.load().then(function () {
						var expires = new Date(+new Date() + (7 * 24 * 60 * 60 * 1000)).toUTCString();
						document.cookie = 'fontsLoaded=true; expires=' + expires;
						document.documentElement.className += ' fonts-loaded';
					});
				}
			})();
		</script>
	</head>

	<body>

		<div class="container container-large">

	
	<a class="screen-reader screen-reader-focusable" href="#main">Skip to main content</a>

	
	<a class="screen-reader screen-reader-focusable" href="mailto:&#099;&#104;&#114;&#105;&#115;&#064;&#103;&#111;&#109;&#097;&#107;&#101;&#116;&#104;&#105;&#110;&#103;&#115;&#046;&#099;&#111;&#109;?subject=Go%20Make%20Things:%20Accessibility%20Feedback">Accessibility Feedback</a>

</div>

		<header class="container container-large margin-bottom-large">
	<nav class="nav-wrap">
		<a class="logo" href="https://gomakethings.com">
			<svg xmlns="http://www.w3.org/2000/svg" style="height:.8em;width:.8em" viewBox="0 0 16 16"><title></title><path fill="currentColor" d="M14 9v2.066c-1.258 1.285-3.016 2.526-5 2.852V8.001h3v-1L9 5.83A3.001 3.001 0 0 0 8 .001 3 3 0 0 0 7 5.83L4 7.001v1h3v5.917c-1.984-.326-3.742-1.567-5-2.852V9H0v1c0 2 4 6 8 6s8-4 8-6V9h-2zM9 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/></svg>
			Go Make Things
		</a>
		<div class="nav-menu" id="nav-menu">
			<ul class="nav">
				<li><a href="https://gomakethings.com/about">About</a></li><li><a href="https://gomakethings.com/guides">Guides</a></li><li><a href="https://gomakethings.com/courses">Courses</a></li><li><a href="https://gomakethings.com/resources">Resources</a></li><li><a href="https://gomakethings.com/articles">Daily Tips</a></li>
			</ul>
		</div>
	</nav>
</header>

		<main id="main" tabindex="-1">

			<div class="container">

	<article>

	
	<h1><span class="title">Fixing Fonts</span></h1>
	

	

<p><em>This is an excerpt from my latest book, <a href="/wicked-fast-websites/">&ldquo;Wicked Fast Websites.&rdquo;</a></em></p>

<p>Loading web fonts often results in a Flash of Invisible Text (FOIT) that leaves the page unusable until it loads.</p>

<p><a href="https://www.igvita.com/2015/04/10/fixing-the-blank-text-problem/">Ilya Grigorik, a web performance engineer at Google, reports:</a></p>

<blockquote>
<p>29% of page loads on Chrome for Android displayed blank text: the user agent knew the text it needed to paint, but was blocked from doing so due to the unavailable font resource. In the median case the blank text time was ~350 ms, ~750 ms for the 75th percentile, and a scary ~2300 ms for the 95th.</p>
</blockquote>

<p>Even the median value of 350ms is an unacceptable performance hit. Fortunately, there&rsquo;s a simple fix.</p>

<h2 id="a-better-way">A better way</h2>

<p>A better approach is to have a system font load immediately, and then when your web font is available, switch over to that. It results in a repaint, but your content is immediately available to visitors.</p>

<p>To achieve this, we&rsquo;re going to load the font asynchronously with <a href="https://github.com/filamentgroup/loadCSS">loadCSS.js</a>.</p>

<p>However, just loading asynchronously isn&rsquo;t enough. You&rsquo;ll still get a FOIT doing that&mdash;it will just happen a second or three later.</p>

<p>We also need a way to detect when the font is fully loaded. Fortunately, <a href="https://github.com/bramstein/fontfaceobserver">Font Face Observer from Bram Stein</a> does just that!</p>

<p>We&rsquo;ll load the font asynchronously, and use Font Face Observer to detect when it&rsquo;s loaded. When it loads, we&rsquo;ll add a class to the <code>&lt;html&gt;</code> element that we can hook into for styling.</p>

<pre><code class="language-lang-css">body {
	font-family: Georgia, serif;
}

.fonts-loaded body {
	font-family: 'PT Serif', serif;
}
</code></pre>

<h2 id="how-to-do-this-in-wordpress">How to do this in WordPress</h2>

<p>Traditionally, you would load your web font using the <code>wp_enqueue_style</code> function:</p>

<pre><code class="language-lang-php">// Load theme fonts
function load_theme_fonts() {
    wp_enqueue_style( 'theme-fonts', 'https://fonts.googleapis.com/css?family=Open+Sans', null, null, 'all' );
}
add_action('wp_enqueue_scripts', 'load_theme_fonts');
</code></pre>

<p>Instead, we want to hook into the <code>wp_head</code> action to inline loadCSS:</p>

<pre><code class="language-lang-php">// Load fonts inline in the header
function load_fonts_inline_header() {
	?&gt;
		&lt;script&gt;
			// Inline our JS files
			function loadCSS(){ ... };
			// Also inline all of the contents from fontfaceobserver.js

			// Async load the CSS file
			loadCSS('//fonts.googleapis.com/css?family=PT+Serif:400,400italic,700,700italic');

			// When the font loads, as the .fonts-loaded class to the &lt;html&gt; element
			var font = new FontFaceObserver('PT Serif');
			font.load().then(function () {
				document.documentElement.className += ' fonts-loaded';
			});
		&lt;/script&gt;
	&lt;?php
}
add_action('wp_head', 'load_fonts_inline_header', 30);
</code></pre>

<p>This is technically not the &ldquo;WordPress Way&rdquo; of doing things. The Codex stress using <code>wp_enqueue_style</code> so that stylesheets are registered and accessible to plugins and other functions. But I think the performance benefits far outweigh the cost of deviating from the best practice here.</p>

<h2 id="what-about-browser-caching">What about browser caching?</h2>

<p>CSS files loaded from places like Typekit and Google Web Fonts get cached for about a week.</p>

<p>Once they&rsquo;re stored in the browser cache, we don&rsquo;t need to use the technique described above. We can load them the traditional way to avoid the font switch that happens once the font CSS loads asynchronously.</p>

<p>To make this happen, we&rsquo;ll set a cookie with Font Face Observer when the font loads. In our <code>functions.php</code> file, we&rsquo;ll use a different approach depending on whether or not that cookie exists.</p>

<pre><code class="language-lang-php">// If cookie set, load font traditional way
function load_theme_fonts() {
	if ( isset($_COOKIE['fontsLoaded']) &amp;&amp; $_COOKIE['fontsLoaded'] === 'true' ) {
    	wp_enqueue_style( 'theme-fonts', 'https://fonts.googleapis.com/css?family=Open+Sans', null, null, 'all' );
    }
}
add_action('wp_enqueue_scripts', 'load_theme_fonts');


// Otherwise, load the font async
function load_theme_font_async() {
	?&gt;
		&lt;script&gt;
			&lt;?php if ( !isset($_COOKIE['fontsLoaded']) || $_COOKIE['fontsLoaded'] !== 'true' ) : ?&gt;
				// Inline our JS files
				function loadCSS(){ ... };
				// Also inline all of the contents from fontfaceobserver.js

				// Async load the CSS file
				loadCSS('//fonts.googleapis.com/css?family=PT+Serif:400,400italic,700,700italic');

				// When the font loads, as the .fonts-loaded class to the &lt;html&gt; element
				var font = new FontFaceObserver('PT Serif');
				font.load().then(function () {
					var expires = new Date(+new Date() + (7 * 24 * 60 * 60 * 1000)).toUTCString();
					document.cookie = 'fontsLoaded=true; expires=' + expires;
					document.documentElement.className += ' fonts-loaded';
				});
			&lt;?php endif; ?&gt;
		&lt;/script&gt;
	&lt;?php
}
add_action('wp_head', 'load_theme_font_async', 30);
</code></pre>

<p><em>If you like this tutorial, check out my latest book, <a href="/wicked-fast-websites/">&ldquo;Wicked Fast Websites.&rdquo;</a></em></p>


</article>

	<br>
<aside>
	<p><mark>🚀 <em><strong>Make 2018 the year you master JavaScript!</strong> My <a href="https://gomakethings.com/guides/">pocket guides</a> and <a href="https://gomakethings.com/courses/">mini courses</a> are short, focused, and made for beginners. You can do this!</em></mark></p>

	<p><em>Have any questions or comments about this post? Email me at <a href="mailto:&#099;&#104;&#114;&#105;&#115;&#064;&#103;&#111;&#109;&#097;&#107;&#101;&#116;&#104;&#105;&#110;&#103;&#115;&#046;&#099;&#111;&#109;">&#099;&#104;&#114;&#105;&#115;&#064;&#103;&#111;&#109;&#097;&#107;&#101;&#116;&#104;&#105;&#110;&#103;&#115;&#046;&#099;&#111;&#109;</a> or contact me on Twitter at <a href="http://twitter.com/ChrisFerdinandi">@ChrisFerdinandi</a>.</em></p>

	<form action="https://gomakethings.us1.list-manage.com/subscribe/post?u=f2d244c0df42a0431bd08ddea&amp;id=aeaa9dd034" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" target="_blank">
	<div class="row">
		<div class="grid-two-thirds">
			<div class="tarpit">
				<label for="name">Don't fill this field in</label>
				<input type="text" name="b_f2d244c0df42a0431bd08ddea_aeaa9dd034" id="name" value="">
			</div>
			<div>
				<label class="screen-reader" for="mce-EMAIL">Email Address</label>
				<input type="email" name="EMAIL" id="mce-EMAIL" title="The domain portion of the email address is invalid (the part after the @)." pattern="^([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x22([^\x0d\x22\x5c\x80-\xff]|\x5c[\x00-\x7f])*\x22))*\x40([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d)(\x2e([^\x00-\x20\x22\x28\x29\x2c\x2e\x3a-\x3c\x3e\x40\x5b-\x5d\x7f-\xff]+|\x5b([^\x0d\x5b-\x5d\x80-\xff]|\x5c[\x00-\x7f])*\x5d))*(\.\w{2,})+$" placeholder="Your email address..." required>
			</div>
			<input type="hidden" value="16" name="group[6981][16]" id="mce-group[6981]-6981-0">
		</div>
		<div class="grid-third">
			<button class="btn btn-block" type="submit">Get Daily Developer Tips</button>
		</div>
	</div>
	<div class="mc-status"></div>
</form>
</aside>

			</div>
		</main>

		<footer class="container container-large">
			<hr class="margin-bottom">
			<nav class="tabindex nav-secondary" id="nav-secondary" tabindex="-1">
	<ul class="list-inline list-inline-responsive">
		<li><a href="https://gomakethings.com/about">About</a></li><li><a href="https://gomakethings.com/guides">Guides</a></li><li><a href="https://gomakethings.com/courses">Courses</a></li><li><a href="https://gomakethings.com/resources">Resources</a></li><li><a href="https://gomakethings.com/articles">Daily Tips</a></li>
	</ul>
</nav>
			<p class="text-small">Made with ❤️ in Massachussets. Unless otherwise noted, all code is free to use under the <a href="/mit">MIT License</a>.</p>
		</footer>

		<script src="https://gomakethings.com/js/loadJS.min.1.1.0.js"></script>
		<script>
			if ('querySelector' in document && 'addEventListener' in window) {
				loadJS('https:\/\/gomakethings.com\/js\/main.min.1.1.0.js');
			}
		</script>
	</body>
</html>