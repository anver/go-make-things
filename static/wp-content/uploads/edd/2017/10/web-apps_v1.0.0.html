<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
  </style>
  <style>
  html {
  	font-size: 100%;
  	overflow-y: scroll;
  	-webkit-text-size-adjust: 100%;
  	-ms-text-size-adjust: 100%;
  }
  
  body {
  	color: #272727;
  	font-family: Georgia, Palatino, "Palatino Linotype", Times, "Times New Roman", serif;
  	line-height: 1.7;
  	padding: 1em;
  	/*margin: auto;*/
  	max-width: 42em;
  	background: #ffffff;
  }
  
  a {
  	color: #0088cc;
  	text-decoration: none;
  }
  
  a:visited {
  	color: #0088cc;
  }
  
  a:hover {
  	color: #005580;
  }
  
  a:active {
  	color: #005580;
  }
  
  a:focus {
  	outline: thin dotted;
  }
  
  p {
  	margin: 0 0 1em;
  }
  
  img {
  	max-width: 100%;
  }
  
  h1, h2, h3, h4, h5, h6,
  .book-title {
  	line-height: 125%;
  	margin-top: 2em;
  	font-weight: normal;
  }
  
  p,
  h1, h2, h3 {
  	orphans: 3;
  	widows: 3;
  }
  
  h1, h2, h3 {
  	page-break-after: avoid;
  }
  
  h4, h5, h6 {
  	font-weight: bold;
  }
  
  h1,
  .book-title {
  	font-size: 2.5em;
  	margin-top: 0;
  	margin-bottom: 0;
  	padding-top: 0;
  	padding-bottom: 0;
  }
  
  h2 {
  	font-size: 1.8em;
  	margin-top: 0;
  	padding-top: 0;
  	page-break-before: always;
  }
  
  h3 {
  	font-size: 1.5em;
  }
  
  h4 {
  	font-size: 1.2em;
  }
  
  h5 {
  	font-size: 1em;
  }
  
  h6 {
  	font-size: 0.9em;
  }
  
  blockquote {
  	color: #666666;
  	margin: 0;
  	padding-left: 3em;
  	page-break-inside: avoid;
  	border-left: 0.5em #eee solid;
  }
  
  hr {
  	display: block;
  	height: 2px;
  	border: 0;
  	border-top: 1px solid #aaa;
  	border-bottom: 1px solid #eee;
  	margin: 1em 0;
  	padding: 0;
  }
  
  pre, code, kbd, samp {
  	color: #000;
  	font-family: monospace, monospace;
  	_font-family: 'courier new', monospace;
  	font-size: 0.98em;
  }
  
  pre {
  	padding: 0 0 1em;
  	page-break-inside: avoid !important;
  	white-space: pre;
  	white-space: pre-wrap !important;
  	word-wrap: break-word;
  }
  
  b, strong {
  	font-weight: bold;
  }
  
  dfn {
  	font-style: italic;
  }
  
  ins {
  	background: #ff9;
  	color: #000;
  	text-decoration: none;
  }
  
  mark {
  	background: #ff0;
  	color: #000;
  	font-style: italic;
  	font-weight: bold;
  }
  
  sub, sup {
  	font-size: 75%;
  	line-height: 0;
  	position: relative;
  	vertical-align: baseline;
  }
  
  sup {
  	top: -0.5em;
  }
  
  sub {
  	bottom: -0.25em;
  }
  
  ul, ol {
  	margin: 1em 0;
  	padding: 0 0 0 2em;
  }
  
  li p:last-child {
  	margin-bottom: 0;
  }
  
  ul ul, ol ol {
  	margin: .3em 0;
  }
  
  dl {
  	margin-bottom: 1em;
  }
  
  dt {
  	font-weight: bold;
  	margin-bottom: .8em;
  }
  
  dd {
  	margin: 0 0 .8em 2em;
  }
  
  dd:last-child {
  	margin-bottom: 0;
  }
  
  img {
  	border: 0;
  	-ms-interpolation-mode: bicubic;
  	vertical-align: middle;
  }
  
  figure {
  	display: block;
  	text-align: center;
  	margin: 1em 0;
  }
  
  figure img {
  	border: none;
  	margin: 0 auto;
  }
  
  figcaption {
  	font-size: 0.8em;
  	font-style: italic;
  	margin: 0 0 .8em;
  }
  
  table {
  	margin-bottom: 2em;
  	border-bottom: 1px solid #ddd;
  	border-right: 1px solid #ddd;
  	border-spacing: 0;
  	border-collapse: collapse;
  }
  
  table th {
  	padding: .2em 1em;
  	background-color: #eee;
  	border-top: 1px solid #ddd;
  	border-left: 1px solid #ddd;
  }
  
  table td {
  	padding: .2em 1em;
  	border-top: 1px solid #ddd;
  	border-left: 1px solid #ddd;
  	vertical-align: top;
  }
  
  .meta {
  	color: #666666;
  	margin-bottom: 0;
  }
  
  .author-img {
  	border-radius: 50%;
  	display: inline-block;
  	height: 200px;
  	width: 200px;
  	margin-left: auto;
  	margin-right: auto;
  }
  
  .break {
  	page-break-before: always;
  }
  
  @media print {
  	* {
  		background: transparent !important;
  		color: black !important;
  		filter: none !important;
  		-ms-filter: none !important;
  	}
  
  	body {
  		font-size: 12pt;
  		max-width: 100%;
  	}
  
  	a, a:visited {
  		text-decoration: underline;
  	}
  
  	hr {
  		height: 1px;
  		border: 0;
  		border-bottom: 1px solid black;
  	}
  
  	a[href]:after {
  		content: " (" attr(href) ")";
  	}
  
  	abbr[title]:after {
  		content: " (" attr(title) ")";
  	}
  
  	.ir a:after, a[href^="javascript:"]:after, a[href^="#"]:after {
  		content: "";
  	}
  
  	pre, blockquote {
  		border: 1px solid #999;
  		padding-right: 1em;
  	}
  
  	tr, img {
  		page-break-inside: avoid;
  	}
  
  	img {
  		max-width: 100% !important;
  	}
  
  	@page :left {
  		margin: 15mm 20mm 15mm 10mm;
  }
  
  	@page :right {
  		margin: 15mm 10mm 15mm 20mm;
  }
  
  /*	p, h2, h3 {
  		orphans: 3;
  		widows: 3;
  	}
  
  	h2, h3 {
  		page-break-after: avoid;
  	}*/
  }
  body {
  	margin: 0 auto;
  }
  
  a {
  	word-wrap: break-word;
  }
  
  pre, code, kbd, samp {
  	white-space: pre-wrap;
  }
  
  code {
  	word-wrap: break-word;
  }
  </style>
</head>
<body>
<h1 id="web-apps-with-vanilla-javascript">Web Apps with Vanilla JavaScript</h1>
<p>By Chris Ferdinandi<br> Go Make Things, LLC<br> v1.0.0</p>
<p>Copyright 2017 Chris Ferdinandi and Go Make Things, LLC. All Rights Reserved.</p>
<div data-toc="">

</div>
<h2 id="intro">Intro</h2>
<p>In this guide, you’ll learn:</p>
<ul>
<li>How to render dynamic content into the DOM.</li>
<li>How to detect changes to your data and selectively update content.</li>
<li>How to listen for user interactions and behaviors.</li>
<li>How to handle URL routing with single page apps.</li>
<li>How to use placeholder content to improve perceived initial load time.</li>
<li>How to put it all together and write a working web app with vanilla JavaScript.</li>
</ul>
<h3 id="a-quick-word-about-browser-compatibility">A quick word about browser compatibility</h3>
<p>This guide makes heavy use of ECMAScript 5 (more commonly known as ES5) and ECMA 6 (ES6) methods and APIs.</p>
<p>My goal for browser support is IE9 and above. Each function or technique mentioned in this guide includes specific browser support information. For methods and APIs that don’t meet that standard, I also include information about polyfills—snippets of code that add support for features to browsers that don’t natively offer it.</p>
<p>You’ll never have to run a command line prompt, compile code, or learn a weird pseudo language (though you certain can if you want to). Let’s get started…</p>
<p><em><strong>Note:</strong> You can extend support all the way back to IE7 with a polyfill service like <a href="https://polyfill.io">polyfill.io</a>.</em></p>
<h2 id="rendering-content">Rendering Content</h2>
<p>To render content into into the DOM, there are two things we need:</p>
<ol style="list-style-type: decimal">
<li>A template string with your content.</li>
<li>An element to render content into.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// The template string</span>
<span class="kw">var</span> template <span class="op">=</span> <span class="st">&#39;&lt;h1&gt;Hello, world!&lt;/h1&gt;&#39;</span><span class="op">;</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode html"><code class="sourceCode html"><span class="co">&lt;!-- The element --&gt;</span>
<span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;app&quot;</span><span class="kw">&gt;&lt;/div&gt;</span></code></pre></div>
<p>There are a handful of ways to approach this, but to make it easier, we’ll use <code>render()</code>, a helper method based on React’s method of the same name.</p>
<p>First, I’m going to show you how to use it. Then I’ll show you the helper function itself and explain how it works.</p>
<h3 id="rendering-a-template-into-the-dom">Rendering a template into the DOM</h3>
<p><code>render()</code> accepts two arguments.</p>
<p>The first is the template you want to render. It can be a string, or a function that returns a string (useful for complex templates or when you need to use <code>if...else</code> logic).</p>
<p>The second is the element to render the content into. This can be either a selector, or an actual element.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// This works</span>
<span class="at">render</span>(<span class="st">&#39;&lt;h1&gt;Hello, world!&lt;/h1&gt;&#39;</span><span class="op">,</span> <span class="st">&#39;#app&#39;</span>)<span class="op">;</span>

<span class="co">// So does this</span>
<span class="kw">var</span> app <span class="op">=</span> <span class="va">document</span>.<span class="at">querySelector</span>(<span class="st">&#39;#app&#39;</span>)<span class="op">;</span>
<span class="kw">var</span> template <span class="op">=</span> <span class="st">&#39;&lt;h1&gt;Hello, world!&lt;/h1&gt;&#39;</span><span class="op">;</span>
<span class="at">render</span>(template<span class="op">,</span> app)<span class="op">;</span>

<span class="co">// And so does this</span>
<span class="kw">var</span> template <span class="op">=</span> <span class="kw">function</span> () <span class="op">{</span>
    <span class="cf">return</span> <span class="st">&#39;&lt;h1&gt;Hello, world!&lt;/h1&gt;&#39;</span><span class="op">;</span>
<span class="op">};</span>
<span class="at">render</span>(template<span class="op">,</span> <span class="st">&#39;#app&#39;</span>)<span class="op">;</span></code></pre></div>
<h4 id="returning-the-element">Returning the element</h4>
<p>The <code>render()</code> method also returns the element back to you, so you can do things with it after your content renders.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">var</span> app <span class="op">=</span> <span class="at">render</span>(<span class="st">&#39;&lt;h1&gt;Hello, world!&lt;/h1&gt;&#39;</span><span class="op">,</span> <span class="st">&#39;#app&#39;</span>)<span class="op">;</span>
<span class="va">app</span>.<span class="va">style</span>.<span class="at">backgroundColor</span> <span class="op">=</span> <span class="st">&#39;rebeccapurple&#39;</span><span class="op">;</span>
<span class="va">app</span>.<span class="va">style</span>.<span class="at">color</span> <span class="op">=</span> <span class="st">&#39;white&#39;</span><span class="op">;</span></code></pre></div>
<h4 id="event-hooks">Event hooks</h4>
<p>It also provides a custom event&amp;mdash<code>render</code>—that you can hook into to whenever an element is rendered.</p>
<p>You can listen for a specific element to be rendered.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">var</span> app <span class="op">=</span> <span class="va">document</span>.<span class="at">querySelector</span>(<span class="st">&#39;#app&#39;</span>)<span class="op">;</span>
<span class="va">app</span>.<span class="at">addEventListener</span>(<span class="st">&#39;render&#39;</span><span class="op">,</span> <span class="kw">function</span> () <span class="op">{</span>
    <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;It was rendered!&#39;</span>)<span class="op">;</span>
<span class="op">},</span> <span class="kw">false</span>)<span class="op">;</span>

<span class="co">// Logs &quot;It was rendered!&quot; in the console</span>
<span class="at">render</span>(<span class="st">&#39;&lt;h1&gt;Hello, world!&lt;/h1&gt;&#39;</span><span class="op">,</span> app)<span class="op">;</span></code></pre></div>
<p>You can also detect any element that’s rendered, and get the specific element with the <code>event.target</code> property.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">var</span> app <span class="op">=</span> <span class="va">document</span>.<span class="at">querySelector</span>(<span class="st">&#39;#app&#39;</span>)<span class="op">;</span>
<span class="va">window</span>.<span class="at">addEventListener</span>(<span class="st">&#39;render&#39;</span><span class="op">,</span> <span class="kw">function</span> (event) <span class="op">{</span>

    <span class="co">// The rendered element</span>
    <span class="kw">var</span> elem <span class="op">=</span> <span class="va">event</span>.<span class="at">target</span><span class="op">;</span>

    <span class="co">// Log the console</span>
    <span class="va">console</span>.<span class="at">log</span>(elem)<span class="op">;</span>

<span class="op">},</span> <span class="kw">false</span>)<span class="op">;</span>

<span class="co">// Logs &quot;&lt;div id=&quot;app&quot;&gt;&lt;h1&gt;Hello, world!&lt;/h1&gt;&lt;/div&gt;&quot;&quot; in the console</span>
<span class="at">render</span>(<span class="st">&#39;&lt;h1&gt;Hello, world!&lt;/h1&gt;&#39;</span><span class="op">,</span> app)<span class="op">;</span></code></pre></div>
<h4 id="updating-content">Updating content</h4>
<p>Any time you want to update your content, call your <code>render()</code> function again.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// Initial render</span>
<span class="at">render</span>(<span class="st">&#39;&lt;h1&gt;Hello, world!&lt;/h1&gt;&#39;</span><span class="op">,</span> <span class="st">&#39;#app&#39;</span>)<span class="op">;</span>

<span class="co">// Update 5 seconds later</span>
<span class="va">window</span>.<span class="at">setTimeout</span>(<span class="kw">function</span> () <span class="op">{</span>
    <span class="at">render</span>(<span class="st">&#39;&lt;h1&gt;Bonjour, world!&lt;/h1&gt;&#39;</span><span class="op">,</span> <span class="st">&#39;#app&#39;</span>)<span class="op">;</span>
<span class="op">},</span> <span class="dv">5000</span>)<span class="op">;</span>

<span class="co">// Update 10 seconds after that</span>
<span class="va">window</span>.<span class="at">setTimeout</span>(<span class="kw">function</span> () <span class="op">{</span>
    <span class="at">render</span>(<span class="st">&#39;&lt;h1&gt;Hola, world!&lt;/h1&gt;&#39;</span><span class="op">,</span> <span class="st">&#39;#app&#39;</span>)<span class="op">;</span>
<span class="op">},</span> <span class="dv">10000</span>)<span class="op">;</span></code></pre></div>
<h3 id="the-render-method">The <code>render()</code> method</h3>
<p>Here’s the helper method that powers all of this.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">/**</span>
<span class="co"> * Render a template into the DOM</span>
<span class="co"> * </span><span class="kw">@param</span><span class="co">  </span><span class="kw">{String|Function}</span><span class="co"> template The template to render</span>
<span class="co"> * </span><span class="kw">@param</span><span class="co">  </span><span class="kw">{String|Node}</span><span class="co">     elem     The element to render into</span>
<span class="co"> * </span><span class="kw">@return</span><span class="co"> {[type]}                   The element</span>
<span class="co"> */</span>
<span class="kw">var</span> render <span class="op">=</span> <span class="kw">function</span> (template<span class="op">,</span> elem) <span class="op">{</span>

    <span class="co">// Set rendering element for the component</span>
    <span class="cf">if</span> (<span class="kw">typeof</span> template <span class="op">===</span> <span class="st">&#39;function&#39;</span>) <span class="op">{</span>
        <span class="va">template</span>.<span class="at">elem</span> <span class="op">=</span> elem<span class="op">;</span>
    <span class="op">}</span>

    <span class="co">// If elem is an element, use it.</span>
    <span class="co">// If it&#39;s a selector, get it.</span>
    elem <span class="op">=</span> <span class="kw">typeof</span> elem <span class="op">===</span> <span class="st">&#39;string&#39;</span> <span class="op">?</span> <span class="va">document</span>.<span class="at">querySelector</span>(elem) : elem<span class="op">;</span>
    <span class="cf">if</span> (<span class="op">!</span>elem) <span class="cf">return</span><span class="op">;</span>

    <span class="co">// Get the template</span>
    template <span class="op">=</span> (<span class="kw">typeof</span> template <span class="op">===</span> <span class="st">&#39;function&#39;</span> <span class="op">?</span> <span class="at">template</span>(<span class="va">template</span>.<span class="at">state</span>) : template)<span class="op">;</span>
    <span class="cf">if</span> (<span class="kw">typeof</span> template <span class="op">!==</span> <span class="st">&#39;string&#39;</span>) <span class="cf">return</span><span class="op">;</span>

    <span class="co">// Render the template into the element</span>
    <span class="cf">if</span> (<span class="va">elem</span>.<span class="at">innerHTML</span> <span class="op">===</span> template) <span class="cf">return</span><span class="op">;</span>
    <span class="va">elem</span>.<span class="at">innerHTML</span> <span class="op">=</span> template<span class="op">;</span>

    <span class="co">// Dispatch a render event</span>
    <span class="cf">if</span> (<span class="kw">typeof</span> <span class="va">window</span>.<span class="at">CustomEvent</span> <span class="op">===</span> <span class="st">&#39;function&#39;</span>) <span class="op">{</span>
        <span class="kw">var</span> event <span class="op">=</span> <span class="kw">new</span> <span class="at">CustomEvent</span>(<span class="st">&#39;render&#39;</span><span class="op">,</span> <span class="op">{</span>
            <span class="dt">bubbles</span><span class="op">:</span> <span class="kw">true</span>
        <span class="op">}</span>)<span class="op">;</span>
        <span class="va">elem</span>.<span class="at">dispatchEvent</span>(event)<span class="op">;</span>
    <span class="op">}</span>

    <span class="co">// Return the elem for use elsewhere</span>
    <span class="cf">return</span> elem<span class="op">;</span>

<span class="op">};</span></code></pre></div>
<p>Let’s break it down and look at what each piece of the code does.</p>
<h4 id="set-the-rendering-element-for-the-component">Set the rendering element for the component</h4>
<p>If the template passed in is a function, we give it a property of <code>elem</code> and store the target element or select to it. This probably doesn’t make much sense now, but we’ll be using this in the next chapter to help automatically re-render content when our data changes.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// Set rendering element for the component</span>
<span class="cf">if</span> (<span class="kw">typeof</span> template <span class="op">===</span> <span class="st">&#39;function&#39;</span>) <span class="op">{</span>
    <span class="va">template</span>.<span class="at">elem</span> <span class="op">=</span> elem<span class="op">;</span>
<span class="op">}</span></code></pre></div>
<h4 id="get-the-element">Get the element</h4>
<p>The element can be a selector or an element. If it’s a string, pass it into <code>querySelector()</code> to get the actual element.</p>
<p>We’re also checking to make sure the element actually exists or was found so that we don’t throw a JavaScript error and break our app.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// If elem is an element, use it.</span>
<span class="co">// If it&#39;s a selector, get it.</span>
elem <span class="op">=</span> <span class="kw">typeof</span> elem <span class="op">===</span> <span class="st">&#39;string&#39;</span> <span class="op">?</span> <span class="va">document</span>.<span class="at">querySelector</span>(elem) : elem<span class="op">;</span>
<span class="cf">if</span> (<span class="op">!</span>elem) <span class="cf">return</span><span class="op">;</span></code></pre></div>
<h4 id="get-the-template">Get the template</h4>
<p>The template can be either a string or a function. If it’s a function, we need to run it to get our string. If there’s no string, we’ll end our function.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// Get the template</span>
template <span class="op">=</span> (<span class="kw">typeof</span> template <span class="op">===</span> <span class="st">&#39;function&#39;</span> <span class="op">?</span> <span class="at">template</span>(<span class="va">template</span>.<span class="at">state</span>) : template)<span class="op">;</span>
<span class="cf">if</span> (<span class="kw">typeof</span> template <span class="op">!==</span> <span class="st">&#39;string&#39;</span>) <span class="cf">return</span><span class="op">;</span></code></pre></div>
<h4 id="render-our-template-into-our-element">Render our template into our element</h4>
<p>Now we’re ready to render our template string into our element, using the <code>innerHTML</code> property.</p>
<p>But in order to avoid causing a browser repaint if we don’t need to, we’re first going to get the current HTML in our element as a string, and compare it to our template.</p>
<p>If they’re the same, we won’t render. If they’re different, we will.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// Render the template into the element</span>
<span class="cf">if</span> (<span class="va">elem</span>.<span class="at">innerHTML</span> <span class="op">===</span> template) <span class="cf">return</span><span class="op">;</span>
<span class="va">elem</span>.<span class="at">innerHTML</span> <span class="op">=</span> template<span class="op">;</span></code></pre></div>
<h4 id="dispatch-a-custom-event">Dispatch a custom event</h4>
<p>Next, we’re going to dispatch our custom event.</p>
<p>This uses the <code>CustomEvent</code> API, which lacks support for Internet Explorer and, at time of writing, Safari. As such, we’ll want to check that it’s supported first. You can also add a polyfill to extend <code>CustomEvent</code> support<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a> back to IE9.</p>
<p>We’re setting <code>bubbles</code> to true so that you can listen for <code>render</code> events on the <code>document</code> or <code>window</code>, not just the event it was dispatched on.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// Dispatch a render event</span>
<span class="cf">if</span> (<span class="kw">typeof</span> <span class="va">window</span>.<span class="at">CustomEvent</span> <span class="op">===</span> <span class="st">&#39;function&#39;</span>) <span class="op">{</span>
    <span class="kw">var</span> event <span class="op">=</span> <span class="kw">new</span> <span class="at">CustomEvent</span>(<span class="st">&#39;render&#39;</span><span class="op">,</span> <span class="op">{</span>
        <span class="dt">bubbles</span><span class="op">:</span> <span class="kw">true</span>
    <span class="op">}</span>)<span class="op">;</span>
    <span class="va">elem</span>.<span class="at">dispatchEvent</span>(event)<span class="op">;</span>
<span class="op">}</span></code></pre></div>
<h4 id="return-the-event">Return the event</h4>
<p>Finally, we’re going to return the rendered element for use elsewhere in your scripts.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// Return the elem for use elsewhere</span>
<span class="cf">return</span> elem<span class="op">;</span></code></pre></div>
<h3 id="browser-compatibility">Browser Compatibility</h3>
<p>The <code>render()</code> method works in all moderns browsers, and IE9 and up.</p>
<p>However, it requires a polyfill for <code>CustomEvent</code> support<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a> in Internet Explorer and Safari. It will render content without it, but you won’t be able to use the events feature.</p>
<h2 id="components-and-state">Components and State</h2>
<p>If you’ve never heard that word “state” before in JavaScript—or have but don’t know what it means—you’re not alone!</p>
<p><strong>State is just data.</strong></p>
<p>So why do they call it state instead of data? Because there’s a time-bound aspect to it.</p>
<p>State is data at a particular moment in time. It’s the present “state” of your data. Get it?</p>
<h3 id="components">Components</h3>
<p>A component is a template function that has state (or data) attached to it. Here’s our “Hello, world” function from last chapter?</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">var</span> template <span class="op">=</span> <span class="kw">function</span> () <span class="op">{</span>
    <span class="cf">return</span> <span class="st">&#39;&lt;h1&gt;Hello, world!&lt;/h1&gt;&#39;</span><span class="op">;</span>
<span class="op">};</span></code></pre></div>
<p>We can add state to it by giving our function a <code>state</code> property with an object as it’s value. That object can contain any data relevant to the template.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="va">template</span>.<span class="at">state</span> <span class="op">=</span> <span class="op">{</span>
    <span class="dt">greeting</span><span class="op">:</span> <span class="st">&#39;Hello&#39;</span>
<span class="op">};</span></code></pre></div>
<p>Our <code>render()</code> function from the previous chapter passes our <code>state</code> property into the function as an argument. We can use this to add logic to our template.</p>
<p>Let’s use <code>props</code> as the argument name for our <code>state</code>.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">var</span> template <span class="op">=</span> <span class="kw">function</span> (props) <span class="op">{</span>
    <span class="cf">return</span> <span class="st">&#39;&lt;h1&gt;&#39;</span> <span class="op">+</span> <span class="va">props</span>.<span class="at">greeting</span> <span class="op">+</span> <span class="st">&#39;, world!&lt;/h1&gt;&#39;</span><span class="op">;</span>
<span class="op">};</span></code></pre></div>
<p>Now, our template will use whatever greeting is in it’s current state.</p>
<h3 id="updating-state">Updating State</h3>
<p>To update state, you can reassign a value to to your <code>state</code> property as a whole, or any property in the <code>state</code> object, just like you would with any other JavaScript object.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="at">render</span>(template<span class="op">,</span> <span class="st">&#39;#app&#39;</span>)<span class="op">;</span>

<span class="co">// Update 5 seconds later</span>
<span class="va">window</span>.<span class="at">setTimeout</span>(<span class="kw">function</span> () <span class="op">{</span>
    <span class="co">// Change the greeting to &quot;Bonjour&quot;</span>
    <span class="co">// Update just the `greeting` property</span>
    <span class="va">template</span>.<span class="va">state</span>.<span class="at">greeting</span> <span class="op">=</span> <span class="st">&#39;Bonjour&#39;</span><span class="op">;</span>
    <span class="at">render</span>(template<span class="op">,</span> <span class="st">&#39;#app&#39;</span>)<span class="op">;</span>
<span class="op">},</span> <span class="dv">5000</span>)<span class="op">;</span>

<span class="co">// Update 10 seconds after that</span>
<span class="va">window</span>.<span class="at">setTimeout</span>(<span class="kw">function</span> () <span class="op">{</span>
    <span class="co">// Change the greeting to &quot;Hola&quot;</span>
    <span class="co">// Update the whole state this time instead</span>
    <span class="va">template</span>.<span class="at">state</span> <span class="op">=</span> <span class="op">{</span>
        <span class="dt">greeting</span><span class="op">:</span> <span class="st">&#39;Hola&#39;</span>
    <span class="op">}</span>
    <span class="at">render</span>(template<span class="op">,</span> <span class="st">&#39;#app&#39;</span>)<span class="op">;</span>
<span class="op">},</span> <span class="dv">10000</span>)<span class="op">;</span></code></pre></div>
<h3 id="detecting-state-changes">Detecting State Changes</h3>
<p>There’s a good chance that when your state updates, you’ll want to render your content again with the new data.</p>
<p><code>component()</code> is a helper method that adds a helper function, <code>setState()</code>, that you can use to update the state of your component <em>and</em> render (or re-render) your content as the same time. It also adds state to your template, turning it into a component.</p>
<p>Just like <code>render()</code>, first I’ll show you how to use it, and then explain how it works.</p>
<h4 id="create-your-component">Create your component</h4>
<p>The <code>component()</code> method accepts three arguments: your template, the state, and the element (or element selector) to render your content into.</p>
<p>It returns the template back to you, so you can use it to setup a template for the first time <em>or</em> add state to an existing template.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// Create a new template</span>
<span class="kw">var</span> template <span class="op">=</span> <span class="at">component</span>(<span class="kw">function</span> (props) <span class="op">{</span>
    <span class="cf">return</span> <span class="st">&#39;&lt;h1&gt;&#39;</span> <span class="op">+</span> <span class="va">props</span>.<span class="at">greeting</span> <span class="op">+</span> <span class="st">&#39;, world!&lt;/h1&gt;&#39;</span><span class="op">;</span>
<span class="op">},</span> <span class="op">{</span>
    <span class="dt">greeting</span><span class="op">:</span> <span class="st">&#39;Hello&#39;</span>
<span class="op">},</span> <span class="st">&#39;#app&#39;</span>)<span class="op">;</span>

<span class="co">// Or add state to an existing template</span>
<span class="kw">var</span> template <span class="op">=</span> <span class="kw">function</span> (props) <span class="op">{</span>
    <span class="cf">return</span> <span class="st">&#39;&lt;h1&gt;&#39;</span> <span class="op">+</span> <span class="va">props</span>.<span class="at">greeting</span> <span class="op">+</span> <span class="st">&#39;, world!&lt;/h1&gt;&#39;</span><span class="op">;</span>
<span class="op">};</span>
<span class="at">component</span>(template<span class="op">,</span> <span class="op">{</span>
    <span class="dt">greeting</span><span class="op">:</span> <span class="st">&#39;Hello&#39;</span>
<span class="op">},</span> <span class="st">&#39;#app&#39;</span>)<span class="op">;</span></code></pre></div>
<p>The last argument—the node to render content into—is optional.</p>
<p>In the last chapter, I mentioned that the <code>render()</code> method adds the <code>elem</code> property to your function. If you don’t specify an element for your component when setting it up, it will use whatever element (or selector) you used for your last render.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// Create your component</span>
<span class="kw">var</span> template <span class="op">=</span> <span class="at">component</span>(<span class="kw">function</span> (props) <span class="op">{</span>
    <span class="cf">return</span> <span class="st">&#39;&lt;h1&gt;&#39;</span> <span class="op">+</span> <span class="va">props</span>.<span class="at">greeting</span> <span class="op">+</span> <span class="st">&#39;, world!&lt;/h1&gt;&#39;</span><span class="op">;</span>
<span class="op">},</span> <span class="op">{</span>
    <span class="dt">greeting</span><span class="op">:</span> <span class="st">&#39;Hello&#39;</span>
<span class="op">}</span>)<span class="op">;</span>

<span class="co">// Render your component</span>
<span class="co">// It will use `#app` as your element selector going forward</span>
<span class="at">render</span>(template<span class="op">,</span> <span class="st">&#39;#app&#39;</span>)<span class="op">;</span></code></pre></div>
<h4 id="update-state-and-render">Update state and render</h4>
<p>To update state and cause your content to render, use the <code>setState()</code> method.</p>
<p>The <code>setState()</code> method requires you to pass in an object, and will conduct a shallow merge into your existing state. You can pass in your entire state object, or just the properties you want to update.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="at">render</span>(template<span class="op">,</span> <span class="st">&#39;#app&#39;</span>)<span class="op">;</span>

<span class="co">// Update 5 seconds later</span>
<span class="va">window</span>.<span class="at">setTimeout</span>(<span class="kw">function</span> () <span class="op">{</span>
    <span class="co">// Change the greeting to &quot;Bonjour&quot; and re-render the template</span>
    <span class="va">template</span>.<span class="at">setState</span>(<span class="op">{</span><span class="dt">greeting</span><span class="op">:</span> <span class="st">&#39;Bonjour&#39;</span><span class="op">}</span>)<span class="op">;</span>
<span class="op">},</span> <span class="dv">5000</span>)<span class="op">;</span>

<span class="co">// Update 10 seconds after that</span>
<span class="va">window</span>.<span class="at">setTimeout</span>(<span class="kw">function</span> () <span class="op">{</span>
    <span class="co">// Change the greeting to &quot;Hola&quot; and re-render the template</span>
    <span class="va">template</span>.<span class="at">setState</span>(<span class="op">{</span><span class="dt">greeting</span><span class="op">:</span> <span class="st">&#39;Hola&#39;</span><span class="op">}</span>)
<span class="op">},</span> <span class="dv">10000</span>)<span class="op">;</span></code></pre></div>
<h3 id="the-component-method">The <code>component()</code> method</h3>
<p>Here’s the helper method for creating components.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">/**</span>
<span class="co"> * Create a component</span>
<span class="co"> * </span><span class="kw">@param</span><span class="co">  </span><span class="kw">{Function}</span><span class="co">       template  The template function</span>
<span class="co"> * </span><span class="kw">@param</span><span class="co">  </span><span class="kw">{Object}</span><span class="co">         props     The state data</span>
<span class="co"> * </span><span class="kw">@param</span><span class="co">  </span><span class="kw">{String|Element}</span><span class="co"> elem      The element to render content into</span>
<span class="co"> * </span><span class="kw">@return</span><span class="co"> {Function}                 The template function</span>
<span class="co"> */</span>
<span class="kw">var</span> component <span class="op">=</span> <span class="kw">function</span> (template<span class="op">,</span> props<span class="op">,</span> elem) <span class="op">{</span>

    <span class="va">Object</span>.<span class="at">defineProperties</span>(template<span class="op">,</span> <span class="op">{</span>
        <span class="dt">elem</span><span class="op">:</span> <span class="op">{</span>
            <span class="dt">value</span><span class="op">:</span> elem<span class="op">,</span>
            <span class="dt">writable</span><span class="op">:</span> <span class="kw">true</span>
        <span class="op">},</span>
        <span class="dt">state</span><span class="op">:</span> <span class="op">{</span>
            <span class="dt">value</span><span class="op">:</span> props<span class="op">,</span>
            <span class="dt">writable</span><span class="op">:</span> <span class="kw">true</span>
        <span class="op">},</span>
        <span class="dt">setState</span><span class="op">:</span> <span class="op">{</span>
            <span class="dt">value</span><span class="op">:</span> <span class="kw">function</span> (props) <span class="op">{</span>

                <span class="co">// Shallow merge new properties into state object</span>
                <span class="cf">for</span> (<span class="kw">var</span> key <span class="kw">in</span> props) <span class="op">{</span>
                    <span class="cf">if</span> (<span class="va">props</span>.<span class="at">hasOwnProperty</span>(key)) <span class="op">{</span>
                        <span class="va">template</span>.<span class="at">state</span>[key] <span class="op">=</span> props[key]<span class="op">;</span>
                    <span class="op">}</span>
                <span class="op">}</span>

                <span class="co">// Render the element</span>
                <span class="at">render</span>(template<span class="op">,</span> <span class="va">template</span>.<span class="at">elem</span>)<span class="op">;</span>

                <span class="co">// Return the elem for use elsewhere</span>
                <span class="cf">return</span> <span class="va">template</span>.<span class="at">elem</span><span class="op">;</span>

            <span class="op">}</span>
        <span class="op">}</span>
    <span class="op">}</span>)<span class="op">;</span>

    <span class="co">// Return the elem for use elsewhere</span>
    <span class="cf">return</span> template<span class="op">;</span>

<span class="op">};</span></code></pre></div>
<p>Let’s break it down and look at what each piece of the code does.</p>
<h4 id="define-object-properties">Define object properties</h4>
<p>The <code>Object.defineProperties()</code> method let’s you add multiple properties to an object. Unlike simply assigning them—<code>template.someProperty = ...</code>—this method let’s you specify whether or the property value can be changed or deleted, and if it should be iterated over in loops.</p>
<p>We use it to add our properties to the <code>template</code> function.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="va">Object</span>.<span class="at">defineProperties</span>(template<span class="op">,</span> <span class="op">{</span>
    <span class="co">// ...</span>
<span class="op">}</span>)<span class="op">;</span></code></pre></div>
<h4 id="add-the-element-as-a-property">Add the element as a property</h4>
<p>If an element or element selector is passed in as an argument, we set it as a property. We’ll use it later when we automatically call our <code>render()</code> function inside the <code>setState()</code> method.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript">elem<span class="op">:</span> <span class="op">{</span>
    <span class="dt">value</span><span class="op">:</span> elem<span class="op">,</span>
    <span class="dt">writable</span><span class="op">:</span> <span class="kw">true</span>
<span class="op">}</span></code></pre></div>
<h4 id="add-state">Add state</h4>
<p>Next, we need to add state to our template.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript">state<span class="op">:</span> <span class="op">{</span>
    <span class="dt">value</span><span class="op">:</span> props<span class="op">,</span>
    <span class="dt">writable</span><span class="op">:</span> <span class="kw">true</span>
<span class="op">}</span></code></pre></div>
<h4 id="create-the-setstate-method">Create the <code>setState()</code> method</h4>
<p>Finally, we’ll add the <code>setState()</code> method to our template.</p>
<p>This loops through any passed in object properties and merges them into the existing template state. Then it calls our <code>render()</code> function, passing in the template and the <code>elem</code> property for the template. Finally, it returns the rendered element.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript">setState<span class="op">:</span> <span class="op">{</span>
    <span class="dt">value</span><span class="op">:</span> <span class="kw">function</span> (props) <span class="op">{</span>

        <span class="co">// Shallow merge new properties into state object</span>
        <span class="cf">for</span> (<span class="kw">var</span> key <span class="kw">in</span> props) <span class="op">{</span>
            <span class="cf">if</span> (<span class="va">props</span>.<span class="at">hasOwnProperty</span>(key)) <span class="op">{</span>
                <span class="va">template</span>.<span class="at">state</span>[key] <span class="op">=</span> props[key]<span class="op">;</span>
            <span class="op">}</span>
        <span class="op">}</span>

        <span class="co">// Render the element</span>
        <span class="at">render</span>(template<span class="op">,</span> <span class="va">template</span>.<span class="at">elem</span>)<span class="op">;</span>

        <span class="co">// Return the elem for use elsewhere</span>
        <span class="cf">return</span> <span class="va">template</span>.<span class="at">elem</span><span class="op">;</span>

    <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<h3 id="browser-compatibility-1">Browser Compatibility</h3>
<p>The <code>component()</code> method works in all moderns browsers, and IE9 and up.</p>
<h2 id="handling-events">Handling Events</h2>
<p>For your app to be truly interactive, you need to listen to user inputs and interactions and update your state accordingly.</p>
<p>We can use the browser-native <code>addEventListener()</code> method for this. You can find a full list of available events on the Mozilla Developer Network. <a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a></p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">var</span> btn <span class="op">=</span> <span class="va">document</span>.<span class="at">querySelector</span>(<span class="st">&#39;#click-me&#39;</span>)<span class="op">;</span>
<span class="va">btn</span>.<span class="at">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> <span class="kw">function</span> (event) <span class="op">{</span>
    <span class="va">console</span>.<span class="at">log</span>(event)<span class="op">;</span> <span class="co">// The event details</span>
    <span class="va">console</span>.<span class="at">log</span>(<span class="va">event</span>.<span class="at">target</span>)<span class="op">;</span> <span class="co">// The clicked element</span>
<span class="op">},</span> <span class="kw">false</span>)<span class="op">;</span></code></pre></div>
<h3 id="multiple-targets">Multiple Targets</h3>
<p>The vanilla JavaScript <code>addEventListener()</code> function requires you to pass in a specific, individual element to listen to. You cannot pass in an array or node list of matching elements like you might in jQuery or other frameworks.</p>
<p>To add the same event listener to multiple elements, you also <strong>cannot</strong> just use a <code>for</code> loop because of how the <code>i</code> variable is scoped (as in, it’s not and changes with each loop).</p>
<p>Fortunately, there’s an easy way to detect events on multiple elements with a single listener: event bubbling.</p>
<p>Instead of listening to specific elements, we’ll instead listen for <em>all</em> clicks on a page, and then check to see if the clicked item has a matching selector.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// Listen for clicks on the entire window</span>
<span class="va">window</span>.<span class="at">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> <span class="kw">function</span> (event) <span class="op">{</span>

    <span class="co">// If the clicked element has the `.click-me` class, it&#39;s a match!</span>
    <span class="cf">if</span> (<span class="va">event</span>.<span class="va">target</span>.<span class="at">matches</span>(<span class="st">&#39;.click-me&#39;</span>)) <span class="op">{</span>
        <span class="co">// Do something...</span>
    <span class="op">}</span>

<span class="op">},</span> <span class="kw">false</span>)<span class="op">;</span></code></pre></div>
<p>This works for other types of events as well.</p>
<h3 id="multiple-events">Multiple Events</h3>
<p>In vanilla JavaScript, each event type requires it’s own event listener. Unfortunately, you <em>can’t</em> pass in multiple events to a single listener like you might in other frameworks.</p>
<p><strong>But…</strong> by using a named function and passing that into your event listener, you can avoid having to write the same code over and over again.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// Setup our function to run on various events</span>
<span class="kw">var</span> someFunction <span class="op">=</span> <span class="kw">function</span> (event) <span class="op">{</span>
    <span class="co">// Do something...</span>
<span class="op">};</span>

<span class="co">// Add our event listeners</span>
<span class="va">window</span>.<span class="at">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> someFunction<span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span>
<span class="va">window</span>.<span class="at">addEventListener</span>(<span class="st">&#39;scroll&#39;</span><span class="op">,</span> someFunction<span class="op">,</span> <span class="kw">false</span>)<span class="op">;</span></code></pre></div>
<h3 id="use-capture">Use Capture</h3>
<p>The last argument in <code>addEventListener()</code> is <code>useCapture</code>, and it specifies whether or not you want to “capture” the event. For most event types, this should be set to <code>false</code>. But certain events, like <code>focus</code>, don’t bubble.</p>
<p>Setting <code>useCapture</code> to <code>true</code> allows you to take advantage of event bubbling for events that otherwise don’t support it.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// Listen for all focus events in the document</span>
<span class="va">document</span>.<span class="at">addEventListener</span>(<span class="st">&#39;focus&#39;</span><span class="op">,</span> <span class="kw">function</span> (event) <span class="op">{</span>
    <span class="co">// Run functions whenever an element in the document comes into focus</span>
<span class="op">},</span> <span class="kw">true</span>)<span class="op">;</span></code></pre></div>
<h3 id="preventing-the-default-behavior">Preventing the default behavior</h3>
<p>You can prevent the default behavior from happening with <code>event.preventDefault()</code>. You would use it to, for example, prevent a link for triggering a page reload or stop a form from submitting data.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="va">document</span>.<span class="at">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> <span class="kw">function</span> (event) <span class="op">{</span>
    <span class="va">event</span>.<span class="at">preventDefault</span>()<span class="op">;</span>
    <span class="co">// The rest of your code...</span>
<span class="op">},</span> <span class="kw">true</span>)<span class="op">;</span></code></pre></div>
<h3 id="an-example-of-event-handling">An Example of Event Handling</h3>
<p>If you were building a todo app, you’d want users to be able to add items to their list. Here’s a sample template for that list that will generate an unordered list with all of the todos.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// Create the template</span>
<span class="kw">var</span> todoList <span class="op">=</span> <span class="kw">function</span> (props) <span class="op">{</span>
    <span class="kw">var</span> items <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="op">;</span>
    <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="va">props</span>.<span class="va">todos</span>.<span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) <span class="op">{</span>
        items <span class="op">+=</span> <span class="st">&#39;&lt;li&gt;&#39;</span> <span class="op">+</span> <span class="va">props</span>.<span class="at">todos</span>[i] <span class="op">+</span> <span class="st">&#39;&lt;/li&gt;&#39;</span><span class="op">;</span>
    <span class="op">}</span>
    <span class="cf">return</span> <span class="st">&#39;&lt;ul&gt;&#39;</span> <span class="op">+</span> items <span class="op">+</span> <span class="st">&#39;&lt;/ul&gt;&#39;</span><span class="op">;</span>
<span class="op">};</span>

<span class="co">// Add state</span>
<span class="at">component</span>(todoList<span class="op">,</span> <span class="op">{</span><span class="dt">todos</span><span class="op">:</span> []<span class="op">},</span> <span class="st">&#39;#todo-list&#39;</span>)<span class="op">;</span></code></pre></div>
<p>And here’s a form users can use to add items to their list (we’re not going to worry about marking them as complete or anything in this example).</p>
<div class="sourceCode"><pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;form</span><span class="ot"> id=</span><span class="st">&quot;add-todos&quot;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;label</span><span class="ot"> for=</span><span class="st">&quot;add-todo-item&quot;</span><span class="kw">&gt;</span>Add a task to your list<span class="kw">&lt;/label&gt;</span>
    <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">&quot;text&quot;</span><span class="ot"> name=</span><span class="st">&quot;add-todo-item&quot;</span><span class="ot"> id=</span><span class="st">&quot;add-todo-item&quot;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;button</span><span class="ot"> type=</span><span class="st">&quot;submit&quot;</span><span class="kw">&gt;</span>Add Todo<span class="kw">&lt;/button&gt;</span>
<span class="kw">&lt;/form&gt;</span></code></pre></div>
<p>And here’s the event listener we would use to listen for new todos and update our list.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// Listen for form submit events</span>
<span class="co">// This let&#39;s us capture both submit button clicks AND someone hitting enter on the keyboard</span>
<span class="va">document</span>.<span class="at">addEventListener</span>(<span class="st">&#39;submit&#39;</span><span class="op">,</span> <span class="kw">function</span> (event) <span class="op">{</span>

    <span class="co">// If the submitted form is the `#add-todos` form</span>
    <span class="cf">if</span> (<span class="va">event</span>.<span class="va">target</span>.<span class="at">matches</span>(<span class="st">&#39;#add-todos&#39;</span>)) <span class="op">{</span>

        <span class="co">// Get the input field</span>
        <span class="kw">var</span> todo <span class="op">=</span> <span class="va">event</span>.<span class="va">target</span>.<span class="at">querySelector</span>(<span class="st">&#39;#add-todo-item&#39;</span>)<span class="op">;</span>

        <span class="co">// If there&#39;s no todo item, bail</span>
        <span class="cf">if</span> (<span class="va">todo</span>.<span class="va">value</span>.<span class="at">length</span> <span class="op">&lt;</span> <span class="dv">1</span>) <span class="cf">return</span><span class="op">;</span>

        <span class="co">// Update our state</span>
        <span class="va">todoList</span>.<span class="at">setState</span>(<span class="op">{</span><span class="dt">todos</span><span class="op">:</span> <span class="va">todoList</span>.<span class="va">state</span>.<span class="at">push</span>(<span class="va">todo</span>.<span class="at">value</span>)<span class="op">}</span>)<span class="op">;</span>

        <span class="co">// Clear our todo field</span>
        <span class="va">todo</span>.<span class="at">value</span> <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="op">;</span>

    <span class="op">}</span>

<span class="op">},</span> <span class="kw">false</span>)<span class="op">;</span></code></pre></div>
<h3 id="browser-compatibility-2">Browser Compatibility</h3>
<p><code>addEventListener</code> works in all modern browsers, and IE9 and above.</p>
<p>The <code>matches()</code> method, mentioned under event bubbling, is also supported in all modern browsers, and IE9 and up. <em>But…</em> older versions of certain browsers used a vendor prefixed version instead of the official spec. You should use a polyfill<a href="#fn4" class="footnoteRef" id="fnref4"><sup>4</sup></a> to ensure consistent behavior in all browsers.</p>
<h2 id="urls-and-single-page-apps">URLs and Single Page Apps</h2>
<p>One of the bigger challenges with single page apps (apps that serve different views and layouts from a single HTML file) is handling URL routing.</p>
<p>In this chapter, you’ll learn how to provide unique URLs for different pages, update the browser history so that the forward and back buttons works properly, and show different content based on those URLs.</p>
<h3 id="the-history-api">The History API</h3>
<p>The History API is a browser API that provides a way for you to update URLs and interact with the browser history.</p>
<h4 id="updating-the-url">Updating the URL</h4>
<p>The <code>pushState()</code> method lets you update the browser URL without triggering a page refresh. It accepts three arguments.</p>
<ol style="list-style-type: decimal">
<li><code>state</code> - Info about the new URL. You can access this data for the current URL in the browser history with the <code>history.state</code> property.</li>
<li><code>title</code> - The new page title, though it’s ignored by most browsers (more on that later).</li>
<li><code>url</code> - The URL of the new page. This can only be a URL on the current domain (no external links, for security reasons).</li>
</ol>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="va">history</span>.<span class="at">pushState</span>(<span class="op">{</span>
    <span class="dt">page</span><span class="op">:</span> <span class="st">&#39;settings&#39;</span>
<span class="op">},</span> <span class="st">&#39;Settings | My Awesome App&#39;</span><span class="op">,</span> <span class="st">&#39;my-awesome-app.com?p=settings&#39;</span>)<span class="op">;</span></code></pre></div>
<p><code>pushState()</code> creates a new item in the browser history. Clicking the forward and backward buttons will update the URL in the address bar.</p>
<p>There’s also a <code>replaceState()</code> method that works exactly the same way, but instead of creating a new item in the browser history, it replaces the current one.</p>
<h4 id="detecting-forward-and-back-button-clicks">Detecting forward and back button clicks</h4>
<p>The <code>onpopstate</code> event is triggered whenever someone clicks the forward or backward buttons in their browser. You can use it to update the page content when someone uses those buttons to navigate.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="va">windown</span>.<span class="at">onpopstate</span> <span class="op">=</span> <span class="kw">function</span> (event) <span class="op">{</span>
    <span class="cf">if</span> (<span class="va">history</span>.<span class="at">state</span> <span class="op">&amp;&amp;</span> <span class="va">history</span>.<span class="va">state</span>.<span class="at">page</span> <span class="op">===</span> <span class="st">&#39;settings&#39;</span>) <span class="op">{</span>
        <span class="co">// Render new content for the settings page</span>
    <span class="op">}</span>
<span class="op">};</span></code></pre></div>
<p>You can also use it with <code>addEventListener</code>, which is my preferred approach.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="va">window</span>.<span class="at">addEventListener</span>(<span class="st">&#39;popstate&#39;</span><span class="op">,</span> <span class="kw">function</span> (event) <span class="op">{</span>
    <span class="cf">if</span> (<span class="va">history</span>.<span class="at">state</span> <span class="op">&amp;&amp;</span> <span class="va">history</span>.<span class="va">state</span>.<span class="at">page</span> <span class="op">===</span> <span class="st">&#39;settings&#39;</span>) <span class="op">{</span>
        <span class="co">// Render new content for the settings page</span>
    <span class="op">}</span>
<span class="op">},</span> <span class="kw">false</span>)<span class="op">;</span></code></pre></div>
<p><em><strong>Note:</strong> The <code>pushState()</code> and <code>replaceState()</code> methods don’t trigger an <code>onpopstate</code> event.</em></p>
<h3 id="query-strings">Query Strings</h3>
<p>Query strings are key/value pairs in a URL.</p>
<p>You’ve almost certainly seen them before. They look like this.</p>
<pre><code>http://my-awesome-app.com?search=vanilla%20javascript&amp;referer=https://twitter.com</code></pre>
<p>In the example above, <code>search</code> has a value of <code>vanilla javascript</code> (the <code>%20</code> is a URL encoded space), and <code>referer</code> has a value of <code>https://twitter.com</code>.</p>
<p>Query strings are perfect for single page apps for a few reasons:</p>
<ol style="list-style-type: decimal">
<li>Servers by default do not treat them as a different page. <code>my-awesome-app.com</code> and <code>my-awesome-app.com/search/vanillajs</code> are viewed as two separate pages, but <code>my-awesome-app.com?search=vanillajs</code> is viewed by the server as <code>my-awesome-app.com</code>.</li>
<li>You can easily encode information about a page/view into your URL.</li>
<li>Google and other search engines recognize and index them as unique URLs (if the content is different).</li>
</ol>
<p>I like to use <code>p</code> as the key for page names. For example, <code>my-awesome-app.com?p=settings</code>.</p>
<h4 id="getting-query-string-values">Getting query string values</h4>
<p>The <code>getParams()</code> helper method, adapted from CSS Tricks, gets all of the query strings in a URL and returns an object of key/value pairs.</p>
<p>Here’s how to use it.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// Example with the current browser URL</span>
<span class="at">getParams</span>(<span class="va">window</span>.<span class="va">location</span>.<span class="at">href</span>)<span class="op">;</span>

<span class="co">// Example with a string</span>
<span class="co">// Returns {</span>
<span class="co">//   p: &#39;settings&#39;,</span>
<span class="co">//   referer: &#39;https://twitter.com&#39;</span>
<span class="co">// }</span>
<span class="at">getParams</span>(<span class="st">&#39;my-awesome-app.com?p=settings&amp;referer=https://twitter.com&#39;</span>)<span class="op">;</span></code></pre></div>
<p>And here’s the method itself.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">/**</span>
<span class="co"> * Get the URL parameters</span>
<span class="co"> * source: https://css-tricks.com/snippets/javascript/get-url-variables/</span>
<span class="co"> * </span><span class="kw">@param</span><span class="co">  </span><span class="kw">{String}</span><span class="co"> url The URL</span>
<span class="co"> * </span><span class="kw">@return</span><span class="co"> {Object}     The URL parameters</span>
<span class="co"> */</span>
<span class="kw">var</span> getParams <span class="op">=</span> <span class="kw">function</span> (url) <span class="op">{</span>
    <span class="kw">var</span> params <span class="op">=</span> <span class="op">{};</span>
    <span class="kw">var</span> parser <span class="op">=</span> <span class="va">document</span>.<span class="at">createElement</span>(<span class="st">&#39;a&#39;</span>)<span class="op">;</span>
    <span class="va">parser</span>.<span class="at">href</span> <span class="op">=</span> url<span class="op">;</span>
    <span class="kw">var</span> query <span class="op">=</span> <span class="va">parser</span>.<span class="va">search</span>.<span class="at">substring</span>(<span class="dv">1</span>)<span class="op">;</span>
    <span class="kw">var</span> vars <span class="op">=</span> <span class="va">query</span>.<span class="at">split</span>(<span class="st">&#39;&amp;&#39;</span>)<span class="op">;</span>
    <span class="cf">for</span> (<span class="kw">var</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="va">vars</span>.<span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) <span class="op">{</span>
        <span class="kw">var</span> pair <span class="op">=</span> vars[i].<span class="at">split</span>(<span class="st">&quot;=&quot;</span>)<span class="op">;</span>
        params[pair[<span class="dv">0</span>]] <span class="op">=</span> <span class="at">decodeURIComponent</span>(pair[<span class="dv">1</span>])<span class="op">;</span>
    <span class="op">}</span>
    <span class="cf">return</span> params<span class="op">;</span>
<span class="op">};</span></code></pre></div>
<h3 id="real-urls">Real URLs</h3>
<p>Many single page apps today use real URLs. Instead of <code>my-awesome-app.com?p=settings</code>, you would use <code>my-awesome-app.com/settings</code>.</p>
<p>In order to use this approach, you need to be able to configure your server to user your <code>index.html</code> file for all paths or routes. If you don’t and someone tries to go directly to a page within your app instead of the homepage (for example, <code>my-awesome-app.com/settings</code>), they’ll get a <code>404</code> error.</p>
<h4 id="parsing-the-url-pathname">Parsing the URL pathname</h4>
<p>The <code>parsePathname()</code> method is a function I wrote to extract variables from the pathname (the <code>/something</code> part) of a URL.</p>
<p>Pass in the pattern to match against, and the pathname to parse. The pattern can be a basic string.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// matches: &#39;/settings&#39;</span>
<span class="co">// doesn&#39;t match: &#39;/settings/username&#39;</span>
<span class="kw">var</span> pattern1 <span class="op">=</span> <span class="st">&#39;/settings&#39;</span><span class="op">;</span>

<span class="co">// matches: &#39;/settings/username&#39;</span>
<span class="co">// doesn&#39;t match: &#39;/settings&#39;</span>
<span class="kw">var</span> pattern2 <span class="op">=</span> <span class="st">&#39;/settings/username&#39;</span><span class="op">;</span></code></pre></div>
<p>Or, it can include parameters you want to extract from the URL pathname. Your parameter names should be wrapped in parentheses and start with a colon: <code>(:myVariable)</code>. Use <code>(*)</code> for wildcards (these won’t be matched or extracted).</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// matches: &#39;/books/rowling/harry%20potter&#39;</span>
<span class="co">// matches: &#39;/books/adams/hitchhikers&#39;</span>
<span class="co">// doesn&#39;t match: &#39;/books/adams/hitchhikers/part-2&#39;</span>
<span class="kw">var</span> pattern1 <span class="op">=</span> <span class="st">&#39;/books/(:author)/(:book)&#39;</span><span class="op">;</span>

<span class="co">// matches: &#39;/publisher/adams/hitchhikers&#39;</span>
<span class="co">// matches: &#39;/publisher/1979/hitchhikers&#39;</span>
<span class="kw">var</span> pattern2 <span class="op">=</span> <span class="st">&#39;/publisher/(*)/(:book)&#39;</span><span class="op">;</span></code></pre></div>
<p>It returns an object with the pattern, any parameters, and the url.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="op">{</span>
    <span class="dt">id</span><span class="op">:</span> pattern<span class="op">,</span> <span class="co">// The pattern if it matches, or null if it doesn&#39;t</span>
    <span class="dt">params</span><span class="op">:</span> <span class="op">{},</span>  <span class="co">// Any parameters extracted from the URL</span>
    <span class="dt">url</span><span class="op">:</span> url     <span class="co">// The URL itself</span>
<span class="op">};</span>

<span class="co">// Example</span>
<span class="at">parsePathname</span>(<span class="st">&#39;/books/(:author)/(:book)&#39;</span><span class="op">,</span> <span class="st">&#39;/books/adams/hitchhikers&#39;</span>)<span class="op">;</span>

<span class="co">// Returns</span>
<span class="op">{</span>
    <span class="dt">id</span><span class="op">:</span> <span class="st">&#39;/books/(:author)/(:book)&#39;</span><span class="op">,</span>
    <span class="dt">params</span><span class="op">:</span> <span class="op">{</span>
        <span class="dt">author</span><span class="op">:</span> <span class="st">&#39;adams&#39;</span><span class="op">,</span>
        <span class="dt">book</span><span class="op">:</span> <span class="st">&#39;hitchhikers&#39;</span>
    <span class="op">},</span>
    <span class="dt">url</span><span class="op">:</span> <span class="st">&#39;/books/adams/hitchhikers&#39;</span>
<span class="op">}</span></code></pre></div>
<h4 id="parsepathname"><code>parsePathname()</code></h4>
<p>And here’s the <code>parsePathname()</code> helper method.</p>
<pre class="lang-js"><code>/**
 * Parse a URL pathname for variables
 * @param  {String} pattern The pattern to match
 * @param  {String} url     The pathname to parse
 * @return {Object}         Details from the pathname
 */
var parsePathname = function (pattern, url) {

    // Variables
    var map = {};
    var keys = [];
    var matches = false;

    // If the URL is an exact match for the pattern, return it
    if (url === pattern || url + &#39;/&#39; === pattern) {
        return {
            id: pattern,
            params: {},
            url: url
        };
    }

    // Add a trailing slash to the URL if one is missing
    url = url.slice(-1) === &#39;/&#39; ? url : url + &#39;/&#39;;

    // Push variables in the pattern to our key array and replace them with regex match grouping
    var newPattern = pattern.replace(&#39;(*)&#39;, &#39;.+?&#39;).replace(/\(:.+?\)/g, function(match) {
        var key = match.slice(2, -1);
        keys.push(key);
        return &#39;([^/]*)&#39;;
    });

    // Test the URL against the pattern.
    // If it&#39;s a match, pull the variables out into the map
    var test = url.replace(new RegExp(&#39;^&#39; + newPattern + &#39;/$&#39;), function() {
        matches = true;
        for (var i = 0; i &lt; keys.length; i++) {
            map[keys[i]] = arguments[i+1];
        }
    });

    // Return the data
    return {
        id: (matches ? pattern : null),
        params: map,
        url: url
    };
};</code></pre>
<h3 id="putting-it-all-together">Putting it all together</h3>
<p>You can use <code>pushState()</code> to update browser URL without reloading the page, <code>onpopstate</code> to handle browser buttons, and query strings or a real URL for the different pages in your web app.</p>
<p>There are still a few missing pieces, though:</p>
<ol style="list-style-type: decimal">
<li>A page-level state you can hook into in your components for styling purposes (as in, some JavaScript object that indicates what page should be displayed). You <em>could</em> use <code>history.state</code>, but I’d prefer something independent from it.</li>
<li>A way to trigger rendering when the page state changes. Remember, <code>onpopstate</code> events aren’t triggered by <code>pushState()</code>.</li>
<li>A way to reliably update the page title in the tab or menu bar.</li>
<li>A way to handle URLs for pages in our app that don’t exist (as in, what to do about <code>404</code> errors).</li>
</ol>
<p>We’ll take a look at how to address them in the next chapter.</p>
<h3 id="browser-compatibility-3">Browser Compatibility</h3>
<p>Query strings work in any browser, as do the <code>getParams()</code> and <code>parsePathname()</code> helper methods.</p>
<p>The History API works in all modern browsers, and IE10 and up. You can add more backwards compatibility with a polyfill. history.js<a href="#fn5" class="footnoteRef" id="fnref5"><sup>5</sup></a> is the most popular. Alternatively, you could allow a full page refresh instead of Ajax page loading.</p>
<h2 id="url-routing">URL Routing</h2>
<p>The <code>router()</code> function is a helper method I wrote to handle some of the heavy lifting with URL routing and address some of the unanswered challenges I mentioned at the end of the last chapter.</p>
<p>It does a few things:</p>
<ol style="list-style-type: decimal">
<li>Creates a page-level state you can access inside your components.</li>
<li>Provides a hook to render content on URL changes.</li>
<li>Updates the document title.</li>
<li>Handles <code>404</code> errors.</li>
</ol>
<p>As always, I’ll first explain how to use it, and then dig into how it works.</p>
<h3 id="passing-links-through-the-router">Passing links through the router</h3>
<p>You can route links in your app through your router by giving them the <code>[data-route]</code> data attribute.</p>
<div class="sourceCode"><pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;a</span><span class="ot"> data-route href=</span><span class="st">&quot;?p=settings&quot;</span><span class="kw">&gt;</span>Settings<span class="kw">&lt;/a&gt;</span></code></pre></div>
<h3 id="creating-url-routes">Creating URL routes</h3>
<p>The <code>router()</code> method accepts two arguments: your URL routes, and an optional object of settings that you can configure.</p>
<h4 id="the-routes">The routes</h4>
<p>For each route in your <code>routes</code> object, the key should be the query string value (if using query strings) or URL pattern (if using real URLs) for that page.</p>
<p>The value is an object with some details about the page. <code>title</code> is the title for that page. If the page should redirect to another page, also include the <code>redirect</code> key, and use the query string value or URL pattern for the page it should redirect to as the value.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// Example with Query Strings</span>
<span class="kw">var</span> routes <span class="op">=</span> <span class="at">router</span>(<span class="op">{</span>

    <span class="co">// The settings page</span>
    <span class="co">// The query string for this page is &quot;?p=settings&quot;</span>
    <span class="dt">settings</span><span class="op">:</span> <span class="op">{</span>
        <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Settings&#39;</span> <span class="co">// The page title</span>
    <span class="op">},</span>

    <span class="co">// The homepage</span>
    <span class="co">// The query string for this page is &quot;?p=home&quot;</span>
    <span class="dt">home</span><span class="op">:</span> <span class="op">{</span>
        <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;My Awesome App&#39;</span>
    <span class="op">},</span>

    <span class="co">// Pages with no query string</span>
    <span class="st">&#39;&#39;</span><span class="op">:</span> <span class="op">{</span>
        <span class="dt">redirect</span><span class="op">:</span> <span class="st">&#39;?p=home&#39;</span> <span class="co">// Redirect to &quot;?p=home&quot;</span>
    <span class="op">}</span>

<span class="op">}</span>)<span class="op">;</span>

<span class="co">// Example with URL Pathnames</span>
<span class="kw">var</span> routes <span class="op">=</span> <span class="at">router</span>(<span class="op">{</span>

    <span class="co">// The settings page</span>
    <span class="st">&#39;/settings&#39;</span><span class="op">:</span> <span class="op">{</span>
        <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Settings&#39;</span> <span class="co">// The page title</span>
    <span class="op">},</span>

    <span class="co">// The homepage</span>
    <span class="st">&#39;/&#39;</span><span class="op">:</span> <span class="op">{</span>
        <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;My Awesome App&#39;</span>
    <span class="op">},</span>

    <span class="co">// The old homepage, which we now redirect</span>
    <span class="st">&#39;/home&#39;</span><span class="op">:</span> <span class="op">{</span>
        <span class="dt">redirect</span><span class="op">:</span> <span class="st">&#39;/&#39;</span>
    <span class="op">}</span>

<span class="op">}</span>)<span class="op">;</span></code></pre></div>
<h4 id="configuring-router-settings">Configuring router settings</h4>
<p>You can also configure a few settings for your router. Every one is optional.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">var</span> routerSettings <span class="op">=</span> <span class="op">{</span>

    <span class="co">// The selector to use for your links</span>
    <span class="co">// If your app has no external links, you could set this to `a` and skip the data attribute</span>
    <span class="dt">selector</span><span class="op">:</span> <span class="st">&#39;[data-route]&#39;</span><span class="op">,</span>

    <span class="co">// Links to ignore, useful if you use a more broad `selector`</span>
    <span class="dt">ignore</span><span class="op">:</span> <span class="st">&#39;[data-route-ignore]&#39;</span><span class="op">,</span>

    <span class="co">// The query string key to use</span>
    <span class="co">// You might, for example, set this to `page` instead</span>
    <span class="co">// URLs would look like this: &quot;?page=settings&quot;</span>
    <span class="dt">key</span><span class="op">:</span> <span class="st">&#39;p&#39;</span><span class="op">,</span>

    <span class="co">// The default title for app pages.</span>
    <span class="co">// This gets appended to the end of your route-specific title.</span>
    <span class="co">// For example, if this was set to &quot;My App&quot; and your settings page title was &quot;Settings | &quot;, the rendered page title would be &quot;Settings | My App&quot;</span>
    <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;&#39;</span><span class="op">,</span>

    <span class="co">// If true, listen for onpopstate events and route the updated URL</span>
    <span class="dt">onpopstate</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span>

    <span class="co">// If true, force a full page reload instead of using pushState()</span>
    <span class="co">// By default, this is set to true automatically when pushState() isn&#39;t supported, false when it is</span>
    <span class="dt">forceReload</span><span class="op">:</span> <span class="op">!</span>(<span class="va">history</span>.<span class="at">pushState</span>)<span class="op">,</span>

    <span class="co">// The type of routing to use (query strings or URL pathnames)</span>
    <span class="co">// valid values: query|path</span>
    <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;query&#39;</span>

<span class="op">};</span>

<span class="kw">var</span> routes <span class="op">=</span> <span class="at">router</span>(<span class="op">{</span>
    <span class="dt">settings</span><span class="op">:</span> <span class="op">{</span>
        <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Settings&#39;</span> <span class="co">// The page title</span>
    <span class="op">},</span>
    ...
<span class="op">},</span> routerSettings)<span class="op">;</span></code></pre></div>
<h3 id="rendering-content-when-the-url-changes">Rendering content when the URL changes</h3>
<p>Every time a URL is routed, the <code>router()</code> function emits a custom <code>route</code> event you can hook into to call the appropriate <code>render()</code> functions.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="va">window</span>.<span class="at">addEventListener</span>(<span class="st">&#39;route&#39;</span><span class="op">,</span> <span class="kw">function</span> () <span class="op">{</span>
    <span class="at">render</span>(template<span class="op">,</span> <span class="st">&#39;#app&#39;</span>)<span class="op">;</span>
<span class="op">},</span> <span class="kw">false</span>)<span class="op">;</span></code></pre></div>
<p>State is added to your URL routes, and contains the current page, a full list of all parameters from the URL, and the URL itself.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// URL: &quot;?p=settings&amp;user=Chris&quot;</span>
<span class="va">routes</span>.<span class="at">state</span> <span class="op">=</span> <span class="op">{</span>
    <span class="dt">id</span><span class="op">:</span> <span class="st">&#39;settings&#39;</span><span class="op">,</span>
    <span class="dt">params</span><span class="op">:</span> <span class="op">{</span>
        <span class="dt">p</span><span class="op">:</span> <span class="st">&#39;settings&#39;</span><span class="op">,</span>
        <span class="dt">user</span><span class="op">:</span> <span class="st">&#39;Chris&#39;</span>
    <span class="op">},</span>
    <span class="dt">url</span><span class="op">:</span> <span class="st">&#39;?p=settings&amp;user=Chris&#39;</span>
<span class="op">};</span>

<span class="co">// URL: &quot;/settings/chris&quot;</span>
<span class="va">routes</span>.<span class="at">state</span> <span class="op">=</span> <span class="op">{</span>
    <span class="dt">id</span><span class="op">:</span> <span class="st">&#39;settings&#39;</span><span class="op">,</span>
    <span class="dt">params</span><span class="op">:</span> <span class="op">{</span>
        <span class="dt">page</span><span class="op">:</span> <span class="st">&#39;settings&#39;</span><span class="op">,</span>
        <span class="dt">user</span><span class="op">:</span> <span class="st">&#39;Chris&#39;</span>
    <span class="op">},</span>
    <span class="dt">url</span><span class="op">:</span> <span class="st">&#39;/settings/chris&#39;</span>
<span class="op">};</span></code></pre></div>
<p>You can hook into it in your templates.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">var</span> template <span class="op">=</span> <span class="kw">function</span> (props) <span class="op">{</span>
    <span class="kw">var</span> str <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="op">;</span>
    <span class="cf">if</span> (<span class="va">routes</span>.<span class="va">state</span>.<span class="at">id</span> <span class="op">===</span> <span class="st">&#39;settings&#39;</span>) <span class="op">{</span>
        str <span class="op">=</span>
            <span class="st">&#39;&lt;h1&gt;Settings&lt;/h1&gt;&#39;</span> <span class="op">+</span>
            <span class="st">&#39;&lt;p&gt;Configure your settings&lt;/p&gt;&#39;</span><span class="op">;</span>
    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span>
        str <span class="op">=</span> <span class="st">&#39;&lt;h1&gt;&#39;</span> <span class="op">+</span> <span class="va">props</span>.<span class="at">greeting</span> <span class="op">+</span> <span class="st">&#39;, world!&lt;/h1&gt;&#39;</span>
    <span class="op">}</span>
    <span class="cf">return</span> str<span class="op">;</span>
<span class="op">};</span></code></pre></div>
<h3 id="the-router-api">The Router API</h3>
<p>The <code>router()</code> function will automatically route any URLs when links with the <code>[data-route]</code> attribute (or whatever other selector you’ve set) are clicked.</p>
<p>But you can also manually run some of its internal processes.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// Route any URL (and trigger a `route` event)</span>
<span class="va">routes</span>.<span class="at">route</span>(<span class="st">&#39;?p=home&#39;</span>)<span class="op">;</span>

<span class="co">// Add a page to the routes.state, but don&#39;t trigger a a `route` event or update the URL</span>
<span class="va">routes</span>.<span class="at">setRoute</span>(<span class="st">&#39;?p=home&#39;</span>)<span class="op">;</span>

<span class="co">// Update the URL with the current state</span>
<span class="va">routes</span>.<span class="at">push</span>()<span class="op">;</span>

<span class="co">// Replace the current item in browser history with the current state</span>
<span class="va">routes</span>.<span class="at">replace</span>()<span class="op">;</span></code></pre></div>
<h3 id="the-router-method">The <code>router()</code> method</h3>
<p>Here’s the <code>router()</code> helper method.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">/**</span>
<span class="co"> * Setup URL router</span>
<span class="co"> * </span><span class="kw">@param</span><span class="co">  </span><span class="kw">{Object}</span><span class="co"> routes  The URL paths</span>
<span class="co"> * </span><span class="kw">@param</span><span class="co">  </span><span class="kw">{Object}</span><span class="co"> options Custom options</span>
<span class="co"> * </span><span class="kw">@return</span><span class="co"> {Object}         The routes</span>
<span class="co"> */</span>
<span class="kw">var</span> router <span class="op">=</span> <span class="kw">function</span> (routes<span class="op">,</span> options) <span class="op">{</span>

    <span class="co">// Defaults</span>
    <span class="kw">var</span> settings <span class="op">=</span> <span class="op">{</span>
        <span class="dt">selector</span><span class="op">:</span> <span class="st">&#39;[data-route]&#39;</span><span class="op">,</span>
        <span class="dt">ignore</span><span class="op">:</span> <span class="st">&#39;[data-route-ignore]&#39;</span><span class="op">,</span>
        <span class="dt">key</span><span class="op">:</span> <span class="st">&#39;p&#39;</span><span class="op">,</span> <span class="co">// The query string key to use</span>
        <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;&#39;</span><span class="op">,</span>
        <span class="dt">onpopstate</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span>
        <span class="dt">forceReload</span><span class="op">:</span> <span class="op">!</span>(<span class="va">history</span>.<span class="at">pushState</span>)<span class="op">,</span>
        <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;query&#39;</span> <span class="co">// valid: query|path</span>
    <span class="op">};</span>

    <span class="co">// Shallow merge new properties into settings object</span>
    <span class="cf">for</span> (<span class="kw">var</span> key <span class="kw">in</span> options) <span class="op">{</span>
        <span class="cf">if</span> (<span class="va">options</span>.<span class="at">hasOwnProperty</span>(key)) <span class="op">{</span>
            settings[key] <span class="op">=</span> options[key]<span class="op">;</span>
        <span class="op">}</span>
    <span class="op">}</span>

    <span class="co">/**</span>
<span class="co">     * Get the URL parameters</span>
<span class="co">     * source: https://css-tricks.com/snippets/javascript/get-url-variables/</span>
<span class="co">     * </span><span class="kw">@param</span><span class="co">  </span><span class="kw">{String}</span><span class="co"> url The URL</span>
<span class="co">     * </span><span class="kw">@return</span><span class="co"> {Object}     The URL parameters</span>
<span class="co">     */</span>
    <span class="kw">var</span> getParams <span class="op">=</span> <span class="kw">function</span> (url) <span class="op">{</span>
        <span class="kw">var</span> params <span class="op">=</span> <span class="op">{};</span>
        <span class="kw">var</span> parser <span class="op">=</span> <span class="va">document</span>.<span class="at">createElement</span>(<span class="st">&#39;a&#39;</span>)<span class="op">;</span>
        <span class="va">parser</span>.<span class="at">href</span> <span class="op">=</span> url<span class="op">;</span>
        <span class="kw">var</span> query <span class="op">=</span> <span class="va">parser</span>.<span class="va">search</span>.<span class="at">substring</span>(<span class="dv">1</span>)<span class="op">;</span>
        <span class="kw">var</span> vars <span class="op">=</span> <span class="va">query</span>.<span class="at">split</span>(<span class="st">&#39;&amp;&#39;</span>)<span class="op">;</span>
        <span class="cf">for</span> (<span class="kw">var</span> i<span class="op">=</span><span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="va">vars</span>.<span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) <span class="op">{</span>
            <span class="kw">var</span> pair <span class="op">=</span> vars[i].<span class="at">split</span>(<span class="st">&quot;=&quot;</span>)<span class="op">;</span>
            params[pair[<span class="dv">0</span>]] <span class="op">=</span> <span class="at">decodeURIComponent</span>(pair[<span class="dv">1</span>])<span class="op">;</span>
        <span class="op">}</span>
        <span class="cf">return</span> params<span class="op">;</span>
    <span class="op">};</span>

    <span class="co">/**</span>
<span class="co">     * Parse a URL pathname for variables</span>
<span class="co">     * </span><span class="kw">@param</span><span class="co">  </span><span class="kw">{String}</span><span class="co"> pattern The pattern to match</span>
<span class="co">     * </span><span class="kw">@param</span><span class="co">  </span><span class="kw">{String}</span><span class="co"> url     The pathname to parse</span>
<span class="co">     * </span><span class="kw">@return</span><span class="co"> {Object}         Details from the pathname</span>
<span class="co">     */</span>
    <span class="kw">var</span> parsePathname <span class="op">=</span> <span class="kw">function</span> (pattern<span class="op">,</span> url) <span class="op">{</span>

        <span class="co">// Variables</span>
        <span class="kw">var</span> map <span class="op">=</span> <span class="op">{};</span>
        <span class="kw">var</span> keys <span class="op">=</span> []<span class="op">;</span>
        <span class="kw">var</span> matches <span class="op">=</span> <span class="kw">false</span><span class="op">;</span>

        <span class="co">// If the URL is an exact match for the pattern, return it</span>
        <span class="cf">if</span> (url <span class="op">===</span> pattern <span class="op">||</span> url <span class="op">+</span> <span class="st">&#39;/&#39;</span> <span class="op">===</span> pattern) <span class="op">{</span>
            <span class="cf">return</span> <span class="op">{</span>
                <span class="dt">id</span><span class="op">:</span> pattern<span class="op">,</span>
                <span class="dt">params</span><span class="op">:</span> <span class="op">{},</span>
                <span class="dt">url</span><span class="op">:</span> url
            <span class="op">};</span>
        <span class="op">}</span>

        <span class="co">// Add a trailing slash to the URL if one is missing</span>
        url <span class="op">=</span> <span class="va">url</span>.<span class="at">slice</span>(<span class="op">-</span><span class="dv">1</span>) <span class="op">===</span> <span class="st">&#39;/&#39;</span> <span class="op">?</span> url : url <span class="op">+</span> <span class="st">&#39;/&#39;</span><span class="op">;</span>

        <span class="co">// Push variables in the pattern to our key array and replace them with regex match grouping</span>
        <span class="kw">var</span> newPattern <span class="op">=</span> <span class="va">pattern</span>.<span class="at">replace</span>(<span class="st">&#39;(*)&#39;</span><span class="op">,</span> <span class="st">&#39;.+?&#39;</span>).<span class="at">replace</span>(<span class="ss">/</span><span class="sc">\(</span><span class="ss">:.</span><span class="sc">+?\)</span><span class="ss">/g</span><span class="op">,</span> <span class="kw">function</span>(match) <span class="op">{</span>
            <span class="kw">var</span> key <span class="op">=</span> <span class="va">match</span>.<span class="at">slice</span>(<span class="dv">2</span><span class="op">,</span> <span class="op">-</span><span class="dv">1</span>)<span class="op">;</span>
            <span class="va">keys</span>.<span class="at">push</span>(key)<span class="op">;</span>
            <span class="cf">return</span> <span class="st">&#39;([^/]*)&#39;</span><span class="op">;</span>
        <span class="op">}</span>)<span class="op">;</span>

        <span class="co">// Test the URL against the pattern.</span>
        <span class="co">// If it&#39;s a match, pull the variables out into the map</span>
        <span class="kw">var</span> test <span class="op">=</span> <span class="va">url</span>.<span class="at">replace</span>(<span class="kw">new</span> <span class="at">RegExp</span>(<span class="st">&#39;^&#39;</span> <span class="op">+</span> newPattern <span class="op">+</span> <span class="st">&#39;/$&#39;</span>)<span class="op">,</span> <span class="kw">function</span>() <span class="op">{</span>
            matches <span class="op">=</span> <span class="kw">true</span><span class="op">;</span>
            <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="va">keys</span>.<span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) <span class="op">{</span>
                map[keys[i]] <span class="op">=</span> arguments[i<span class="dv">+1</span>]<span class="op">;</span>
            <span class="op">}</span>
        <span class="op">}</span>)<span class="op">;</span>

        <span class="co">// Return the data</span>
        <span class="cf">return</span> <span class="op">{</span>
            <span class="dt">id</span><span class="op">:</span> (matches <span class="op">?</span> pattern : <span class="kw">null</span>)<span class="op">,</span>
            <span class="dt">params</span><span class="op">:</span> map<span class="op">,</span>
            <span class="dt">url</span><span class="op">:</span> url
        <span class="op">};</span>
    <span class="op">};</span>

    <span class="co">/**</span>
<span class="co">     * Get the route state from query strings</span>
<span class="co">     * </span><span class="kw">@param</span><span class="co">  </span><span class="kw">{String}</span><span class="co"> url The URL</span>
<span class="co">     * </span><span class="kw">@return</span><span class="co"> {Object}     The route state</span>
<span class="co">     */</span>
    <span class="kw">var</span> getRouteFromQuery <span class="op">=</span> <span class="kw">function</span> (url) <span class="op">{</span>

        <span class="co">// Get the query string parameters and the page id</span>
        <span class="kw">var</span> params <span class="op">=</span> <span class="at">getParams</span>(url)<span class="op">;</span>
        <span class="kw">var</span> id <span class="op">=</span> params[<span class="va">settings</span>.<span class="at">key</span>] <span class="op">?</span> params[<span class="va">settings</span>.<span class="at">key</span>].<span class="at">toLowerCase</span>() : <span class="st">&#39;&#39;</span><span class="op">;</span>

        <span class="co">// If route has redirect, call setRoute with redirect URL</span>
        <span class="cf">if</span> (routes[id] <span class="op">&amp;&amp;</span> routes[id].<span class="at">redirect</span>) <span class="op">{</span>
            <span class="va">routes</span>.<span class="at">setRoute</span>(routes[id].<span class="at">redirect</span>)<span class="op">;</span>
            <span class="cf">return</span><span class="op">;</span>
        <span class="op">}</span>

        <span class="cf">return</span> <span class="op">{</span>
            <span class="dt">id</span><span class="op">:</span> routes[id] <span class="op">?</span> id : <span class="dv">404</span><span class="op">,</span>
            <span class="dt">params</span><span class="op">:</span> params<span class="op">,</span>
            <span class="dt">url</span><span class="op">:</span> url
        <span class="op">};</span>
    <span class="op">};</span>

    <span class="co">/**</span>
<span class="co">     * Get a route state from a pathname</span>
<span class="co">     * </span><span class="kw">@param</span><span class="co">  </span><span class="kw">{String}</span><span class="co"> url The URL</span>
<span class="co">     * </span><span class="kw">@return</span><span class="co"> {Object}     The route state</span>
<span class="co">     */</span>
    <span class="kw">var</span> getRouteFromPath <span class="op">=</span> <span class="kw">function</span> (url) <span class="op">{</span>

        <span class="co">// Make URL case-insensitive</span>
        url <span class="op">=</span> <span class="va">url</span>.<span class="at">toLowerCase</span>()<span class="op">;</span>

        <span class="co">// Loop through each route and test against URL</span>
        <span class="cf">for</span> (<span class="kw">var</span> route <span class="kw">in</span> routes) <span class="op">{</span>
            <span class="cf">if</span> (<span class="va">routes</span>.<span class="at">hasOwnProperty</span>(route)) <span class="op">{</span>
                <span class="kw">var</span> parsed <span class="op">=</span> <span class="at">parsePathname</span>(route<span class="op">,</span> url)<span class="op">;</span>
                <span class="cf">if</span> (<span class="va">parsed</span>.<span class="at">id</span>) <span class="op">{</span>
                    <span class="cf">return</span> parsed<span class="op">;</span>
                <span class="op">}</span>
            <span class="op">}</span>
        <span class="op">}</span>

        <span class="co">// Otherwise return 404</span>
        <span class="cf">return</span> <span class="op">{</span>
            <span class="dt">id</span><span class="op">:</span> <span class="dv">404</span><span class="op">,</span>
            <span class="dt">params</span><span class="op">:</span> <span class="op">{},</span>
            <span class="dt">url</span><span class="op">:</span> url
        <span class="op">};</span>

    <span class="op">};</span>

    <span class="co">/**</span>
<span class="co">     * Setup the route properties</span>
<span class="co">     */</span>
    <span class="va">Object</span>.<span class="at">defineProperties</span>(routes<span class="op">,</span> <span class="op">{</span>
        <span class="dt">state</span><span class="op">:</span> <span class="op">{</span>
            <span class="dt">value</span><span class="op">:</span> <span class="op">{</span>
                <span class="dt">id</span><span class="op">:</span> <span class="st">&#39;&#39;</span><span class="op">,</span>
                <span class="dt">params</span><span class="op">:</span> <span class="op">{},</span>
                <span class="dt">url</span><span class="op">:</span> <span class="kw">null</span>
            <span class="op">}</span>
        <span class="op">},</span>
        <span class="dt">setRoute</span><span class="op">:</span> <span class="op">{</span>
            <span class="dt">value</span><span class="op">:</span> <span class="kw">function</span> (url) <span class="op">{</span>

                <span class="co">// Bail if there&#39;s no URL</span>
                <span class="cf">if</span> (<span class="op">!</span>url) <span class="cf">return</span><span class="op">;</span>

                <span class="co">// Get the route state</span>
                <span class="kw">var</span> state<span class="op">;</span>
                <span class="cf">if</span> (<span class="va">settings</span>.<span class="at">type</span> <span class="op">===</span> <span class="st">&#39;path&#39;</span>) <span class="op">{</span>
                    state <span class="op">=</span> <span class="at">getRouteFromPath</span>(url)<span class="op">;</span>
                    <span class="cf">if</span> (<span class="op">!</span>state) <span class="cf">return</span><span class="op">;</span>
                    <span class="va">routes</span>.<span class="va">state</span>.<span class="at">id</span> <span class="op">=</span> <span class="va">state</span>.<span class="at">id</span><span class="op">;</span>
                    <span class="va">routes</span>.<span class="va">state</span>.<span class="at">params</span> <span class="op">=</span> <span class="va">state</span>.<span class="at">params</span><span class="op">;</span>
                    <span class="va">routes</span>.<span class="va">state</span>.<span class="at">url</span> <span class="op">=</span> <span class="va">state</span>.<span class="at">url</span><span class="op">;</span>
                <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span>
                    state <span class="op">=</span> <span class="at">getRouteFromQuery</span>(url)<span class="op">;</span>
                    <span class="cf">if</span> (<span class="op">!</span>state) <span class="cf">return</span><span class="op">;</span>
                    <span class="va">routes</span>.<span class="va">state</span>.<span class="at">id</span> <span class="op">=</span> <span class="va">state</span>.<span class="at">id</span><span class="op">;</span>
                    <span class="va">routes</span>.<span class="va">state</span>.<span class="at">params</span> <span class="op">=</span> <span class="va">state</span>.<span class="at">params</span><span class="op">;</span>
                    <span class="va">routes</span>.<span class="va">state</span>.<span class="at">url</span> <span class="op">=</span> <span class="va">state</span>.<span class="at">url</span><span class="op">;</span>
                <span class="op">}</span>

                <span class="cf">return</span> <span class="va">routes</span>.<span class="at">state</span><span class="op">;</span>
            <span class="op">}</span>
        <span class="op">},</span>
        <span class="dt">push</span><span class="op">:</span> <span class="op">{</span>
            <span class="dt">value</span><span class="op">:</span> <span class="kw">function</span> () <span class="op">{</span>
                <span class="cf">if</span> (<span class="va">settings</span>.<span class="at">forceReload</span>) <span class="op">{</span>
                    <span class="cf">if</span> (<span class="va">window</span>.<span class="va">location</span>.<span class="at">href</span> <span class="op">===</span> <span class="va">routes</span>.<span class="va">state</span>.<span class="at">url</span>) <span class="cf">return</span><span class="op">;</span>
                    <span class="va">window</span>.<span class="va">location</span>.<span class="at">href</span> <span class="op">=</span> <span class="va">routes</span>.<span class="va">state</span>.<span class="at">url</span><span class="op">;</span>
                <span class="op">}</span>

                <span class="cf">if</span> (<span class="op">!</span><span class="va">history</span>.<span class="at">pushState</span>) <span class="cf">return</span><span class="op">;</span>

                <span class="co">// Update the page title</span>
                <span class="va">document</span>.<span class="at">title</span> <span class="op">=</span> (routes[<span class="va">routes</span>.<span class="va">state</span>.<span class="at">id</span>] <span class="op">&amp;&amp;</span> routes[<span class="va">routes</span>.<span class="va">state</span>.<span class="at">id</span>].<span class="at">title</span> <span class="op">?</span> routes[<span class="va">routes</span>.<span class="va">state</span>.<span class="at">id</span>].<span class="at">title</span> : <span class="st">&#39;&#39;</span>) <span class="op">+</span> <span class="va">settings</span>.<span class="at">title</span><span class="op">;</span>

                <span class="co">// Don&#39;t run if already current page</span>
                <span class="cf">if</span> (<span class="va">history</span>.<span class="at">state</span> <span class="op">&amp;&amp;</span> <span class="va">history</span>.<span class="va">state</span>.<span class="at">url</span> <span class="op">&amp;&amp;</span> <span class="va">history</span>.<span class="va">state</span>.<span class="at">url</span> <span class="op">===</span> <span class="va">routes</span>.<span class="va">state</span>.<span class="at">url</span>) <span class="cf">return</span><span class="op">;</span>
                <span class="va">history</span>.<span class="at">pushState</span>(
                    <span class="va">routes</span>.<span class="at">state</span><span class="op">,</span>
                    (routes[<span class="va">routes</span>.<span class="va">state</span>.<span class="at">id</span>] <span class="op">&amp;&amp;</span> routes[<span class="va">routes</span>.<span class="va">state</span>.<span class="at">id</span>].<span class="at">title</span> <span class="op">?</span> routes[<span class="va">routes</span>.<span class="va">state</span>.<span class="at">id</span>].<span class="at">title</span> : <span class="st">&#39;&#39;</span>) <span class="op">+</span> <span class="va">settings</span>.<span class="at">title</span><span class="op">,</span>
                    <span class="va">routes</span>.<span class="va">state</span>.<span class="at">url</span>
                )<span class="op">;</span>
            <span class="op">}</span>
        <span class="op">},</span>
        <span class="dt">replace</span><span class="op">:</span> <span class="op">{</span>
            <span class="dt">value</span><span class="op">:</span> <span class="kw">function</span> () <span class="op">{</span>
                <span class="cf">if</span> (<span class="op">!</span><span class="va">history</span>.<span class="at">replaceState</span>) <span class="cf">return</span><span class="op">;</span>

                <span class="co">// Update the page title</span>
                <span class="va">document</span>.<span class="at">title</span> <span class="op">=</span> (routes[<span class="va">routes</span>.<span class="va">state</span>.<span class="at">id</span>] <span class="op">&amp;&amp;</span> routes[<span class="va">routes</span>.<span class="va">state</span>.<span class="at">id</span>].<span class="at">title</span> <span class="op">?</span> routes[<span class="va">routes</span>.<span class="va">state</span>.<span class="at">id</span>].<span class="at">title</span> : <span class="st">&#39;&#39;</span>) <span class="op">+</span> <span class="va">settings</span>.<span class="at">title</span><span class="op">;</span>

                <span class="co">// Don&#39;t run if already current page</span>
                <span class="cf">if</span> (<span class="va">history</span>.<span class="at">state</span> <span class="op">&amp;&amp;</span> <span class="va">history</span>.<span class="va">state</span>.<span class="at">url</span> <span class="op">&amp;&amp;</span> <span class="va">history</span>.<span class="va">state</span>.<span class="at">url</span> <span class="op">===</span> <span class="va">routes</span>.<span class="va">state</span>.<span class="at">url</span>) <span class="cf">return</span><span class="op">;</span>
                <span class="va">history</span>.<span class="at">pushState</span>(
                    <span class="va">routes</span>.<span class="at">state</span><span class="op">,</span>
                    (routes[<span class="va">routes</span>.<span class="va">state</span>.<span class="at">id</span>].<span class="at">title</span> <span class="op">?</span> routes[<span class="va">routes</span>.<span class="va">state</span>.<span class="at">id</span>].<span class="at">title</span> : <span class="st">&#39;&#39;</span>) <span class="op">+</span> <span class="va">settings</span>.<span class="at">title</span><span class="op">,</span>
                    <span class="va">routes</span>.<span class="va">state</span>.<span class="at">url</span>
                )<span class="op">;</span>
            <span class="op">}</span>
        <span class="op">},</span>
        <span class="dt">route</span><span class="op">:</span> <span class="op">{</span>
            <span class="dt">value</span><span class="op">:</span> <span class="kw">function</span> (url) <span class="op">{</span>
                <span class="cf">if</span> (<span class="op">!</span>url) <span class="cf">return</span><span class="op">;</span>
                <span class="va">routes</span>.<span class="at">setRoute</span>(url)<span class="op">;</span>
                <span class="va">routes</span>.<span class="at">push</span>()<span class="op">;</span>
                <span class="kw">var</span> event <span class="op">=</span> <span class="kw">new</span> <span class="at">CustomEvent</span>(<span class="st">&#39;route&#39;</span><span class="op">,</span> <span class="op">{</span>
                    <span class="dt">bubbles</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span>
                    <span class="dt">detail</span><span class="op">:</span> <span class="op">{</span>
                        <span class="dt">state</span><span class="op">:</span> <span class="va">routes</span>.<span class="at">state</span>
                    <span class="op">}</span>
                <span class="op">}</span>)<span class="op">;</span>
                <span class="va">document</span>.<span class="at">dispatchEvent</span>(event)<span class="op">;</span>
                <span class="cf">return</span> <span class="va">routes</span>.<span class="at">state</span><span class="op">;</span>
            <span class="op">}</span>
        <span class="op">}</span>
    <span class="op">}</span>)<span class="op">;</span>

    <span class="co">/**</span>
<span class="co">     * Add event listeners</span>
<span class="co">     */</span>

    <span class="co">// Listen for router link clicks</span>
    <span class="va">window</span>.<span class="at">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> <span class="kw">function</span> (event) <span class="op">{</span>
        <span class="cf">if</span> (<span class="op">!</span><span class="va">event</span>.<span class="va">target</span>.<span class="at">matches</span>(<span class="va">settings</span>.<span class="at">selector</span>) <span class="op">||</span> <span class="va">event</span>.<span class="va">target</span>.<span class="at">matches</span>(<span class="va">settings</span>.<span class="at">ignore</span>)) <span class="cf">return</span><span class="op">;</span>
        <span class="va">event</span>.<span class="at">preventDefault</span>()<span class="op">;</span>
        <span class="va">routes</span>.<span class="at">route</span>(<span class="va">event</span>.<span class="va">target</span>.<span class="at">href</span>)<span class="op">;</span>
    <span class="op">},</span> <span class="kw">false</span>)<span class="op">;</span>

    <span class="co">// Listen for popstate events</span>
    <span class="cf">if</span> (<span class="va">settings</span>.<span class="at">onpopstate</span>) <span class="op">{</span>
        <span class="va">window</span>.<span class="at">addEventListener</span>(<span class="st">&#39;popstate&#39;</span><span class="op">,</span> <span class="kw">function</span> (event) <span class="op">{</span>
            <span class="cf">if</span> (<span class="op">!</span><span class="va">history</span>.<span class="va">state</span>.<span class="at">url</span>) <span class="cf">return</span><span class="op">;</span>
            <span class="va">routes</span>.<span class="at">route</span>(<span class="va">history</span>.<span class="va">state</span>.<span class="at">url</span>)<span class="op">;</span>
        <span class="op">},</span> <span class="kw">false</span>)<span class="op">;</span>
    <span class="op">}</span>

    <span class="cf">return</span> routes<span class="op">;</span>

<span class="op">};</span></code></pre></div>
<p>Let’s break it down and look at what each piece of the code does.</p>
<h4 id="merging-options-into-defaults">Merging options into defaults</h4>
<p>First, we establish default setting values, and merge any options passed into the <code>router()</code> method into them.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// Defaults</span>
<span class="kw">var</span> settings <span class="op">=</span> <span class="op">{</span>
    <span class="dt">selector</span><span class="op">:</span> <span class="st">&#39;[data-route]&#39;</span><span class="op">,</span>
    <span class="dt">ignore</span><span class="op">:</span> <span class="st">&#39;[data-route-ignore]&#39;</span><span class="op">,</span>
    <span class="dt">key</span><span class="op">:</span> <span class="st">&#39;p&#39;</span><span class="op">,</span>
    <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;&#39;</span><span class="op">,</span>
    <span class="dt">onpopstate</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span>
    <span class="dt">forceReload</span><span class="op">:</span> <span class="op">!</span>(<span class="va">history</span>.<span class="at">pushState</span>)<span class="op">,</span>
    <span class="dt">type</span><span class="op">:</span> <span class="st">&#39;query&#39;</span>
<span class="op">};</span>

<span class="co">// Shallow merge new properties into settings object</span>
<span class="cf">for</span> (<span class="kw">var</span> key <span class="kw">in</span> options) <span class="op">{</span>
    <span class="cf">if</span> (<span class="va">options</span>.<span class="at">hasOwnProperty</span>(key)) <span class="op">{</span>
        settings[key] <span class="op">=</span> options[key]<span class="op">;</span>
    <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<h4 id="get-parameters">Get parameters</h4>
<p>Next, I’ve included our <code>getParams()</code> and <code>parsePathname()</code> helper methods for getting query string and URL parameters.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">/**</span>
<span class="co"> * Get the URL parameters</span>
<span class="co"> * source: https://css-tricks.com/snippets/javascript/get-url-variables/</span>
<span class="co"> * </span><span class="kw">@param</span><span class="co">  </span><span class="kw">{String}</span><span class="co"> url The URL</span>
<span class="co"> * </span><span class="kw">@return</span><span class="co"> {Object}     The URL parameters</span>
<span class="co"> */</span>
<span class="kw">var</span> getParams <span class="op">=</span> <span class="kw">function</span> (url) <span class="op">{</span>
    <span class="co">// ...</span>
<span class="op">};</span>

<span class="co">/**</span>
<span class="co"> * Parse a URL pathname for variables</span>
<span class="co"> * </span><span class="kw">@param</span><span class="co">  </span><span class="kw">{String}</span><span class="co"> pattern The pattern to match</span>
<span class="co"> * </span><span class="kw">@param</span><span class="co">  </span><span class="kw">{String}</span><span class="co"> url     The pathname to parse</span>
<span class="co"> * </span><span class="kw">@return</span><span class="co"> {Object}         Details from the pathname</span>
<span class="co"> */</span>
<span class="kw">var</span> parsePathname <span class="op">=</span> <span class="kw">function</span> (pattern<span class="op">,</span> url) <span class="op">{</span>
    <span class="co">// ...</span>
<span class="op">};</span></code></pre></div>
<h4 id="get-the-route-from-a-query-string">Get the route from a query string</h4>
<p>If using query strings, this gets the page parameter from the URL, checks to see if it exists in your routes, and returns back the state object.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">/**</span>
<span class="co"> * Get the route state from query strings</span>
<span class="co"> * </span><span class="kw">@param</span><span class="co">  </span><span class="kw">{String}</span><span class="co"> url The URL</span>
<span class="co"> * </span><span class="kw">@return</span><span class="co"> {Object}     The route state</span>
<span class="co"> */</span>
<span class="kw">var</span> getRouteFromQuery <span class="op">=</span> <span class="kw">function</span> (url) <span class="op">{</span>

    <span class="co">// Get the query string parameters and the page id</span>
    <span class="kw">var</span> params <span class="op">=</span> <span class="at">getParams</span>(url)<span class="op">;</span>
    <span class="kw">var</span> id <span class="op">=</span> params[<span class="va">settings</span>.<span class="at">key</span>] <span class="op">?</span> params[<span class="va">settings</span>.<span class="at">key</span>].<span class="at">toLowerCase</span>() : <span class="st">&#39;&#39;</span><span class="op">;</span>

    <span class="co">// If route has redirect, call setRoute with redirect URL</span>
    <span class="cf">if</span> (routes[id] <span class="op">&amp;&amp;</span> routes[id].<span class="at">redirect</span>) <span class="op">{</span>
        <span class="va">routes</span>.<span class="at">setRoute</span>(routes[id].<span class="at">redirect</span>)<span class="op">;</span>
        <span class="cf">return</span><span class="op">;</span>
    <span class="op">}</span>

    <span class="cf">return</span> <span class="op">{</span>
        <span class="dt">id</span><span class="op">:</span> routes[id] <span class="op">?</span> id : <span class="dv">404</span><span class="op">,</span>
        <span class="dt">params</span><span class="op">:</span> params<span class="op">,</span>
        <span class="dt">url</span><span class="op">:</span> url
    <span class="op">};</span>
<span class="op">};</span></code></pre></div>
<h4 id="get-the-route-from-a-pathname">Get the route from a pathname</h4>
<p>If using URL pathnames, this loops through each route until it finds a match. Then it returns the route state.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">/**</span>
<span class="co"> * Get a route state from a pathname</span>
<span class="co"> * </span><span class="kw">@param</span><span class="co">  </span><span class="kw">{String}</span><span class="co"> url The URL</span>
<span class="co"> * </span><span class="kw">@return</span><span class="co"> {Object}     The route state</span>
<span class="co"> */</span>
<span class="kw">var</span> getRouteFromPath <span class="op">=</span> <span class="kw">function</span> (url) <span class="op">{</span>

    <span class="co">// Make URL case-insensitive</span>
    url <span class="op">=</span> <span class="va">url</span>.<span class="at">toLowerCase</span>()<span class="op">;</span>

    <span class="co">// Loop through each route and test against URL</span>
    <span class="cf">for</span> (<span class="kw">var</span> route <span class="kw">in</span> routes) <span class="op">{</span>
        <span class="cf">if</span> (<span class="va">routes</span>.<span class="at">hasOwnProperty</span>(route)) <span class="op">{</span>
            <span class="kw">var</span> parsed <span class="op">=</span> <span class="at">parsePathname</span>(route<span class="op">,</span> url)<span class="op">;</span>
            <span class="cf">if</span> (<span class="va">parsed</span>.<span class="at">id</span>) <span class="op">{</span>
                <span class="cf">return</span> parsed<span class="op">;</span>
            <span class="op">}</span>
        <span class="op">}</span>
    <span class="op">}</span>

    <span class="co">// Otherwise return 404</span>
    <span class="cf">return</span> <span class="op">{</span>
        <span class="dt">id</span><span class="op">:</span> <span class="dv">404</span><span class="op">,</span>
        <span class="dt">params</span><span class="op">:</span> <span class="op">{},</span>
        <span class="dt">url</span><span class="op">:</span> url
    <span class="op">};</span>

<span class="op">};</span></code></pre></div>
<h4 id="add-properties-to-the-routes">Add properties to the routes</h4>
<p>I’m again using <code>Object.defineProperties</code> to add properites to the routes that were passed in to <code>router()</code>.</p>
<h4 id="route-state">Route State</h4>
<p>The <code>routes.state</code> property sets up our baseline state.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript">state<span class="op">:</span> <span class="op">{</span>
    <span class="dt">value</span><span class="op">:</span> <span class="op">{</span>
        <span class="dt">id</span><span class="op">:</span> <span class="st">&#39;&#39;</span><span class="op">,</span>
        <span class="dt">params</span><span class="op">:</span> <span class="op">{},</span>
        <span class="dt">url</span><span class="op">:</span> <span class="kw">null</span>
    <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<p>The <code>routes.setRoute()</code> method sets our route state.</p>
<p>If using query strings, it gets the query string or pathname (depending on your settings) from whatever URL is passed into it. Then it gets the route state form the URL using one of the methods mentioned above.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript">setRoute<span class="op">:</span> <span class="op">{</span>
    <span class="dt">value</span><span class="op">:</span> <span class="kw">function</span> (url) <span class="op">{</span>

        <span class="co">// Bail if there&#39;s no URL</span>
        <span class="cf">if</span> (<span class="op">!</span>url) <span class="cf">return</span><span class="op">;</span>

        <span class="co">// Get the route state</span>
        <span class="kw">var</span> state<span class="op">;</span>
        <span class="cf">if</span> (<span class="va">settings</span>.<span class="at">type</span> <span class="op">===</span> <span class="st">&#39;path&#39;</span>) <span class="op">{</span>
            state <span class="op">=</span> <span class="at">getRouteFromPath</span>(url)<span class="op">;</span>
            <span class="cf">if</span> (<span class="op">!</span>state) <span class="cf">return</span><span class="op">;</span>
            <span class="va">routes</span>.<span class="va">state</span>.<span class="at">id</span> <span class="op">=</span> <span class="va">state</span>.<span class="at">id</span><span class="op">;</span>
            <span class="va">routes</span>.<span class="va">state</span>.<span class="at">params</span> <span class="op">=</span> <span class="va">state</span>.<span class="at">params</span><span class="op">;</span>
            <span class="va">routes</span>.<span class="va">state</span>.<span class="at">url</span> <span class="op">=</span> <span class="va">state</span>.<span class="at">url</span><span class="op">;</span>
        <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span>
            state <span class="op">=</span> <span class="at">getRouteFromQuery</span>(url)<span class="op">;</span>
            <span class="cf">if</span> (<span class="op">!</span>state) <span class="cf">return</span><span class="op">;</span>
            <span class="va">routes</span>.<span class="va">state</span>.<span class="at">id</span> <span class="op">=</span> <span class="va">state</span>.<span class="at">id</span><span class="op">;</span>
            <span class="va">routes</span>.<span class="va">state</span>.<span class="at">params</span> <span class="op">=</span> <span class="va">state</span>.<span class="at">params</span><span class="op">;</span>
            <span class="va">routes</span>.<span class="va">state</span>.<span class="at">url</span> <span class="op">=</span> <span class="va">state</span>.<span class="at">url</span><span class="op">;</span>
        <span class="op">}</span>

        <span class="cf">return</span> <span class="va">routes</span>.<span class="at">state</span><span class="op">;</span>
    <span class="op">}</span>
<span class="op">},</span></code></pre></div>
<h4 id="updating-the-url-1">Updating the URL</h4>
<p>The <code>routes.push()</code> method updates the URL based on the <code>state.page</code> of your routes. It also uses <code>document.title</code> to update the title of the document.</p>
<p>If <code>forceReload</code> is set to true, it forces a page reload instead of using <code>pushState()</code>.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript">push<span class="op">:</span> <span class="op">{</span>
    <span class="dt">value</span><span class="op">:</span> <span class="kw">function</span> () <span class="op">{</span>
        <span class="cf">if</span> (<span class="va">settings</span>.<span class="at">forceReload</span>) <span class="op">{</span>
            <span class="cf">if</span> (<span class="va">window</span>.<span class="va">location</span>.<span class="at">href</span> <span class="op">===</span> <span class="va">routes</span>.<span class="va">state</span>.<span class="at">url</span>) <span class="cf">return</span><span class="op">;</span>
            <span class="va">window</span>.<span class="va">location</span>.<span class="at">href</span> <span class="op">=</span> <span class="va">routes</span>.<span class="va">state</span>.<span class="at">url</span><span class="op">;</span>
        <span class="op">}</span>

        <span class="cf">if</span> (<span class="op">!</span><span class="va">history</span>.<span class="at">pushState</span>) <span class="cf">return</span><span class="op">;</span>

        <span class="co">// Update the page title</span>
        <span class="va">document</span>.<span class="at">title</span> <span class="op">=</span> (routes[<span class="va">routes</span>.<span class="va">state</span>.<span class="at">id</span>] <span class="op">&amp;&amp;</span> routes[<span class="va">routes</span>.<span class="va">state</span>.<span class="at">id</span>].<span class="at">title</span> <span class="op">?</span> routes[<span class="va">routes</span>.<span class="va">state</span>.<span class="at">id</span>].<span class="at">title</span> : <span class="st">&#39;&#39;</span>) <span class="op">+</span> <span class="va">settings</span>.<span class="at">title</span><span class="op">;</span>

        <span class="co">// Don&#39;t run if already current page</span>
        <span class="cf">if</span> (<span class="va">history</span>.<span class="at">state</span> <span class="op">&amp;&amp;</span> <span class="va">history</span>.<span class="va">state</span>.<span class="at">url</span> <span class="op">&amp;&amp;</span> <span class="va">history</span>.<span class="va">state</span>.<span class="at">url</span> <span class="op">===</span> <span class="va">routes</span>.<span class="va">state</span>.<span class="at">url</span>) <span class="cf">return</span><span class="op">;</span>
        <span class="va">history</span>.<span class="at">pushState</span>(
            <span class="va">routes</span>.<span class="at">state</span><span class="op">,</span>
            (routes[<span class="va">routes</span>.<span class="va">state</span>.<span class="at">id</span>] <span class="op">&amp;&amp;</span> routes[<span class="va">routes</span>.<span class="va">state</span>.<span class="at">id</span>].<span class="at">title</span> <span class="op">?</span> routes[<span class="va">routes</span>.<span class="va">state</span>.<span class="at">id</span>].<span class="at">title</span> : <span class="st">&#39;&#39;</span>) <span class="op">+</span> <span class="va">settings</span>.<span class="at">title</span><span class="op">,</span>
            <span class="va">routes</span>.<span class="va">state</span>.<span class="at">url</span>
        )<span class="op">;</span>
    <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<p>The <code>routes.replace()</code> method works almost the same exact way as <code>routes.push()</code>, but uses <code>replaceState()</code> and doesn’t force a page reload.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript">replace<span class="op">:</span> <span class="op">{</span>
    <span class="dt">value</span><span class="op">:</span> <span class="kw">function</span> () <span class="op">{</span>
        <span class="cf">if</span> (<span class="op">!</span><span class="va">history</span>.<span class="at">replaceState</span>) <span class="cf">return</span><span class="op">;</span>

        <span class="co">// Update the page title</span>
        <span class="va">document</span>.<span class="at">title</span> <span class="op">=</span> (routes[<span class="va">routes</span>.<span class="va">state</span>.<span class="at">id</span>] <span class="op">&amp;&amp;</span> routes[<span class="va">routes</span>.<span class="va">state</span>.<span class="at">id</span>].<span class="at">title</span> <span class="op">?</span> routes[<span class="va">routes</span>.<span class="va">state</span>.<span class="at">id</span>].<span class="at">title</span> : <span class="st">&#39;&#39;</span>) <span class="op">+</span> <span class="va">settings</span>.<span class="at">title</span><span class="op">;</span>

        <span class="co">// Don&#39;t run if already current page</span>
        <span class="cf">if</span> (<span class="va">history</span>.<span class="at">state</span> <span class="op">&amp;&amp;</span> <span class="va">history</span>.<span class="va">state</span>.<span class="at">url</span> <span class="op">&amp;&amp;</span> <span class="va">history</span>.<span class="va">state</span>.<span class="at">url</span> <span class="op">===</span> <span class="va">routes</span>.<span class="va">state</span>.<span class="at">url</span>) <span class="cf">return</span><span class="op">;</span>
        <span class="va">history</span>.<span class="at">pushState</span>(
            <span class="va">routes</span>.<span class="at">state</span><span class="op">,</span>
            (routes[<span class="va">routes</span>.<span class="va">state</span>.<span class="at">id</span>].<span class="at">title</span> <span class="op">?</span> routes[<span class="va">routes</span>.<span class="va">state</span>.<span class="at">id</span>].<span class="at">title</span> : <span class="st">&#39;&#39;</span>) <span class="op">+</span> <span class="va">settings</span>.<span class="at">title</span><span class="op">,</span>
            <span class="va">routes</span>.<span class="va">state</span>.<span class="at">url</span>
        )<span class="op">;</span>
    <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<h4 id="routing-the-url">Routing the URL</h4>
<p>The <code>routes.route()</code> method actually routes the URL for us.</p>
<p>First, it runs <code>setRoute()</code> to get the route state. Then it runs <code>routes.push()</code> to update the URL. Finally, it emits our custom <code>route</code> event. Finally, it returns the route state for use in other scripts and returns the route state.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript">route<span class="op">:</span> <span class="op">{</span>
    <span class="dt">value</span><span class="op">:</span> <span class="kw">function</span> (url) <span class="op">{</span>
        <span class="cf">if</span> (<span class="op">!</span>url) <span class="cf">return</span><span class="op">;</span>
        <span class="va">routes</span>.<span class="at">setRoute</span>(url)<span class="op">;</span>
        <span class="va">routes</span>.<span class="at">push</span>()<span class="op">;</span>
        <span class="kw">var</span> event <span class="op">=</span> <span class="kw">new</span> <span class="at">CustomEvent</span>(<span class="st">&#39;route&#39;</span><span class="op">,</span> <span class="op">{</span>
            <span class="dt">bubbles</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span>
            <span class="dt">detail</span><span class="op">:</span> <span class="op">{</span>
                <span class="dt">state</span><span class="op">:</span> <span class="va">routes</span>.<span class="at">state</span>
            <span class="op">}</span>
        <span class="op">}</span>)<span class="op">;</span>
        <span class="va">document</span>.<span class="at">dispatchEvent</span>(event)<span class="op">;</span>
        <span class="cf">return</span> <span class="va">routes</span>.<span class="at">state</span><span class="op">;</span>
    <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<h4 id="event-listeners">Event Listeners</h4>
<p>The handle our click events, <code>router()</code> sets up a click event listener and checks to see if the clicked link has our route selector.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// Listen for router link clicks</span>
<span class="va">window</span>.<span class="at">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> <span class="kw">function</span> (event) <span class="op">{</span>
    <span class="cf">if</span> (<span class="op">!</span><span class="va">event</span>.<span class="va">target</span>.<span class="at">matches</span>(<span class="va">settings</span>.<span class="at">selector</span>) <span class="op">||</span> <span class="va">event</span>.<span class="va">target</span>.<span class="at">matches</span>(<span class="va">settings</span>.<span class="at">ignore</span>)) <span class="cf">return</span><span class="op">;</span>
    <span class="va">event</span>.<span class="at">preventDefault</span>()<span class="op">;</span>
    <span class="va">routes</span>.<span class="at">route</span>(<span class="va">event</span>.<span class="va">target</span>.<span class="at">href</span>)<span class="op">;</span>
<span class="op">},</span> <span class="kw">false</span>)<span class="op">;</span></code></pre></div>
<p>If <code>settings.onpopstate</code> is true, it also listens for <code>popstate</code> events and routes the update URL through <code>routes.route()</code>.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// Listen for popstate events</span>
<span class="cf">if</span> (<span class="va">settings</span>.<span class="at">onpopstate</span>) <span class="op">{</span>
    <span class="va">window</span>.<span class="at">addEventListener</span>(<span class="st">&#39;popstate&#39;</span><span class="op">,</span> <span class="kw">function</span> (event) <span class="op">{</span>
        <span class="cf">if</span> (<span class="op">!</span><span class="va">history</span>.<span class="va">state</span>.<span class="at">url</span>) <span class="cf">return</span><span class="op">;</span>
        <span class="va">routes</span>.<span class="at">route</span>(<span class="va">history</span>.<span class="va">state</span>.<span class="at">url</span>)<span class="op">;</span>
    <span class="op">},</span> <span class="kw">false</span>)<span class="op">;</span>
<span class="op">}</span></code></pre></div>
<h3 id="browser-compatibility-4">Browser Compatibility</h3>
<p>The <code>router()</code> method works in any browser, and IE9 and up.</p>
<h2 id="placeholders">Placeholders</h2>
<p>Depending on which parts of your user interface you’re rendering with JavaScript and how you’re fetching your data (Ajax vs. local storage, and so on), there may be parts of your UI that aren’t ready when the page first loads.</p>
<p>Placeholder content—sometimes called an app shell—can help improve the perceived load time of your app.</p>
<p>// <span class="citation">@todo</span> insert image</p>
<p>Your placeholders mimick the completed layout of the app. They’re typically gray, and often have a slight animation to them to imply that the real content is loading.</p>
<p>Let’s look at how to use them in your web app.</p>
<h3 id="creating-placeholders">Creating placeholders</h3>
<p>Placeholder content can be created with just a little bit of HTML and CSS. First, reate a <code>&lt;div&gt;</code> and add the <code>.placeholder</code> class.</p>
<div class="sourceCode"><pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;placeholder&quot;</span><span class="kw">&gt;&lt;/div&gt;</span></code></pre></div>
<p>Then we’ll add this CSS to our app.</p>
<div class="sourceCode"><pre class="sourceCode css"><code class="sourceCode css"><span class="co">/**</span>
<span class="co"> * Setup keyframes for pulsing animation</span>
<span class="co"> */</span>
@-webkit-keyframes loadingPlaceholders <span class="kw">{</span>
    <span class="er">0%</span> <span class="er">{</span>
        <span class="kw">background-color:</span> lightgray<span class="kw">;</span>
    <span class="kw">}</span>
    50% <span class="kw">{</span>
        <span class="kw">background-color:</span> <span class="dt">#e5e5e5</span><span class="kw">;</span>
    <span class="kw">}</span>
    100% <span class="kw">{</span>
        <span class="kw">background-color:</span> lightgray<span class="kw">;</span>
    <span class="kw">}</span>
}
@keyframes loadingPlaceholders <span class="kw">{</span>
    <span class="er">0%</span> <span class="er">{</span>
        <span class="kw">background-color:</span> lightgray<span class="kw">;</span>
    <span class="kw">}</span>
    50% <span class="kw">{</span>
        <span class="kw">background-color:</span> <span class="dt">#e5e5e5</span><span class="kw">;</span>
    <span class="kw">}</span>
    100% <span class="kw">{</span>
        <span class="kw">background-color:</span> lightgray<span class="kw">;</span>
    <span class="kw">}</span>
}

<span class="co">/**</span>
<span class="co"> * Style the placeholder</span>
<span class="co"> */</span>
<span class="fl">.placeholder</span> <span class="kw">{</span>
  <span class="kw">-webkit-animation:</span> loadingPlaceholders <span class="dt">1.5s</span> ease-in infinite<span class="kw">;</span>
          <span class="kw">animation:</span> loadingPlaceholders <span class="dt">1.5s</span> ease-in infinite<span class="kw">;</span>
  <span class="kw">background-color:</span> <span class="dt">#e5e5e5</span><span class="kw">;</span>
<span class="kw">}</span></code></pre></div>
<h3 id="customizing-placeholders">Customizing Placeholders</h3>
<p>While the CSS above adds the basic functionality, you’ll want to style your placeholders to match the layout of your app.</p>
<p>I use a handful of modifier classes to create different shapes to match my content.</p>
<div class="sourceCode"><pre class="sourceCode css"><code class="sourceCode css"><span class="fl">.placeholder-hero</span> <span class="kw">{</span>
    <span class="kw">height:</span> <span class="dt">20em</span><span class="kw">;</span>
<span class="kw">}</span>

<span class="fl">.placeholder-heading</span> <span class="kw">{</span>
    <span class="kw">height:</span> <span class="dt">3em</span><span class="kw">;</span>
    <span class="kw">width:</span> <span class="dt">55%</span><span class="kw">;</span>
<span class="kw">}</span>

<span class="fl">.placeholder-sentence</span> <span class="kw">{</span>
    <span class="kw">height:</span> <span class="dt">1.5em</span><span class="kw">;</span>
    <span class="kw">margin-bottom:</span> <span class="dt">0.5em</span><span class="kw">;</span>
<span class="kw">}</span>

<span class="fl">.placeholder-sentence-last</span> <span class="kw">{</span>
    <span class="kw">width:</span> <span class="dt">85%</span><span class="kw">;</span>
<span class="kw">}</span>

<span class="fl">.placeholder-paragraph</span> <span class="kw">{</span>
    <span class="kw">height:</span> <span class="dt">8em</span><span class="kw">;</span>
    <span class="kw">margin-top:</span> <span class="dt">1.625em</span><span class="kw">;</span>
<span class="kw">}</span>

<span class="fl">.placeholder-btn</span> <span class="kw">{</span>
    <span class="kw">height:</span> <span class="dt">3em</span><span class="kw">;</span>
    <span class="kw">width:</span> <span class="dt">8em</span><span class="kw">;</span>

<span class="kw">}</span>

<span class="fl">.placeholder-thumbnail</span> <span class="kw">{</span>
    <span class="kw">border-radius:</span> <span class="dt">50%</span><span class="kw">;</span>
    <span class="kw">height:</span> <span class="dt">9em</span><span class="kw">;</span>
    <span class="kw">width:</span> <span class="dt">9em</span><span class="kw">;</span>
<span class="kw">}</span>

<span class="fl">.placeholder-hero</span>,
<span class="fl">.placeholder-heading</span>,
<span class="fl">.placeholder-paragraph</span>,
<span class="fl">.placeholder-btn</span>,
<span class="fl">.placeholder-thumbnail</span> <span class="kw">{</span>
    <span class="kw">margin-bottom:</span> <span class="dt">1.625em</span><span class="kw">;</span>
<span class="kw">}</span></code></pre></div>
<p>And you use them like this.</p>
<div class="sourceCode"><pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;placeholder placeholder-hero&quot;</span><span class="kw">&gt;&lt;/div&gt;</span>

<span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;placeholder placeholder-thumbnail&quot;</span><span class="kw">&gt;&lt;/div&gt;</span>

<span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;placeholder placeholder-paragraph&quot;</span><span class="kw">&gt;&lt;/div&gt;</span>

<span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;placeholder placeholder-sentence&quot;</span><span class="kw">&gt;&lt;/div&gt;</span>
<span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;placeholder placeholder-sentence&quot;</span><span class="kw">&gt;&lt;/div&gt;</span>
<span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;placeholder placeholder-sentence placeholder-sentence-last&quot;</span><span class="kw">&gt;&lt;/div&gt;</span>

<span class="kw">&lt;div</span><span class="ot"> class=</span><span class="st">&quot;placeholder placeholder-btn&quot;</span><span class="kw">&gt;&lt;/div&gt;</span></code></pre></div>
<h2 id="putting-it-all-together-1">Putting it all together</h2>
<p>To make this all tangible, let’s work on a project together. We’ll build a web app that let’s you randomly pick who’s going to drive from a group of friends.</p>
<p>The starter template and complete project code are included in the source code<a href="#fn6" class="footnoteRef" id="fnref6"><sup>6</sup></a> on GitHub.</p>
<h3 id="getting-setup">Getting Setup</h3>
<p>I’ve dropped some placeholder markup into the template to help you get started.</p>
<p>It includes an empty <code>&lt;div&gt;</code> with an ID of <code>#app</code>. This is where we’ll render all of the content for our app. There’s also a <code>&lt;script&gt;</code> tag in the footer for our JavaScript.</p>
<div class="sourceCode"><pre class="sourceCode html"><code class="sourceCode html"><span class="co">&lt;!-- The app container --&gt;</span>
<span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;app&quot;</span><span class="kw">&gt;&lt;/div&gt;</span>

<span class="kw">&lt;script&gt;</span>
    <span class="co">// Codes goes here...</span>
<span class="kw">&lt;/script&gt;</span></code></pre></div>
<p>There’s also some light CSS to give form labels a bit of style.</p>
<div class="sourceCode"><pre class="sourceCode css"><code class="sourceCode css">label <span class="kw">{</span>
    <span class="kw">display:</span> <span class="dt">block</span><span class="kw">;</span>
    <span class="kw">font-weight:</span> <span class="dt">bold</span><span class="kw">;</span>
    <span class="kw">margin-bottom:</span> <span class="dt">0.5em</span><span class="kw">;</span>
<span class="kw">}</span></code></pre></div>
<h3 id="how-its-going-to-work">How it’s going to work</h3>
<p>Our app will have three sections:</p>
<ol style="list-style-type: decimal">
<li>A list of all potential drivers.</li>
<li>A form you can use to add new drivers to the list.</li>
<li>A button that shuffles the list and picks a driver.</li>
</ol>
<h3 id="render-our-base-layout">Render our base layout</h3>
<p>The first thing we need to do is render our base layout.</p>
<p>We want unique <code>&lt;div&gt;</code> containers for each of our three content sections so that we can independently render and re-render them as users add new drivers and then select one. We also probably want to add a heading for our app.</p>
<p>The finished markup should look something like this.</p>
<div class="sourceCode"><pre class="sourceCode html"><code class="sourceCode html"><span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;app&quot;</span><span class="kw">&gt;</span>
    <span class="kw">&lt;h1&gt;</span>Who&#39;s Driving<span class="kw">&lt;/h1&gt;</span>
    <span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;driver-list&quot;</span><span class="kw">&gt;&lt;/div&gt;</span>
    <span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;driver-actions&quot;</span><span class="kw">&gt;</span>
        <span class="kw">&lt;form</span><span class="ot"> id=</span><span class="st">&quot;add-driver&quot;</span><span class="kw">&gt;</span>
            <span class="kw">&lt;label&gt;</span>Type the name of your driver and hit enter<span class="kw">&lt;/label&gt;</span>
            <span class="kw">&lt;input</span><span class="ot"> type=</span><span class="st">&quot;text&quot;</span><span class="ot"> name=</span><span class="st">&quot;new-driver&quot;</span><span class="ot"> id=</span><span class="st">&quot;new-driver&quot;</span><span class="ot"> autofocus</span><span class="kw">&gt;</span>
            <span class="kw">&lt;button</span><span class="ot"> class=</span><span class="st">&quot;btn&quot;</span><span class="ot"> type=</span><span class="st">&quot;submit&quot;</span><span class="kw">&gt;</span>Add Driver<span class="kw">&lt;/button&gt;</span>
        <span class="kw">&lt;/form&gt;</span>
        <span class="kw">&lt;form</span><span class="ot"> id=</span><span class="st">&quot;pick-driver&quot;</span><span class="kw">&gt;&lt;button</span><span class="ot"> class=</span><span class="st">&quot;btn btn-secondary&quot;</span><span class="ot"> id=</span><span class="st">&quot;pick-driver-submit&quot;</span><span class="kw">&gt;</span>Pick Who Drives<span class="kw">&lt;/button&gt;&lt;/form&gt;</span>
    <span class="kw">&lt;/div&gt;</span>
    <span class="kw">&lt;div</span><span class="ot"> id=</span><span class="st">&quot;selected-driver&quot;</span><span class="kw">&gt;&lt;/div&gt;</span>
<span class="kw">&lt;/div&gt;</span></code></pre></div>
<p>The <code>#driver-actions</code> content shouldn’t ever need to be updated, since the user is just entering names there, so we can render out all of it’s content on load.</p>
<h3 id="create-a-layout-component">Create a layout component</h3>
<p>Let’s first add our <code>render()</code> and <code>component()</code> helper functions.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">var</span> render <span class="op">=</span> <span class="kw">function</span> (template<span class="op">,</span> elem) <span class="op">{</span>
    <span class="co">// ...</span>
<span class="op">};</span>

<span class="kw">var</span> component <span class="op">=</span> <span class="kw">function</span> (template<span class="op">,</span> props<span class="op">,</span> elem) <span class="op">{</span>
    <span class="co">// ...</span>
<span class="op">};</span></code></pre></div>
<p>Next, let’s set up our HTML above as a component, and render it into the app. We don’t need to set a state for the layout, since it’s really just a container for the rest of the page content.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// The base layout</span>
<span class="kw">var</span> layout <span class="op">=</span> <span class="at">component</span>(<span class="kw">function</span> () <span class="op">{</span>
    <span class="kw">var</span> template <span class="op">=</span>
        <span class="st">&#39;&lt;div id=&quot;app&quot;&gt;&#39;</span> <span class="op">+</span>
            <span class="st">&#39;&lt;h1&gt;Who</span><span class="sc">\&#39;</span><span class="st">s Driving&lt;/h1&gt;&#39;</span> <span class="op">+</span>
            <span class="st">&#39;&lt;div id=&quot;driver-list&quot;&gt;&lt;/div&gt;&#39;</span> <span class="op">+</span>
            <span class="st">&#39;&lt;div id=&quot;driver-actions&quot;&gt;&#39;</span> <span class="op">+</span>
                <span class="st">&#39;&lt;form id=&quot;add-driver&quot;&gt;&#39;</span> <span class="op">+</span>
                    <span class="st">&#39;&lt;label&gt;Type the name of your driver and hit enter&lt;/label&gt;&#39;</span> <span class="op">+</span>
                    <span class="st">&#39;&lt;input type=&quot;text&quot; name=&quot;new-driver&quot; id=&quot;new-driver&quot; autofocus&gt;&#39;</span> <span class="op">+</span>
                    <span class="st">&#39;&lt;button class=&quot;btn&quot; type=&quot;submit&quot;&gt;Add Driver&lt;/button&gt;&#39;</span> <span class="op">+</span>
                <span class="st">&#39;&lt;/form&gt;&#39;</span> <span class="op">+</span>
                <span class="st">&#39;&lt;form id=&quot;pick-driver&quot;&gt;&lt;button class=&quot;btn btn-secondary&quot; id=&quot;pick-driver-submit&quot;&gt;Pick Who Drives&lt;/button&gt;&lt;/form&gt;&#39;</span> <span class="op">+</span>
            <span class="st">&#39;&lt;/div&gt;&#39;</span> <span class="op">+</span>
            <span class="st">&#39;&lt;div id=&quot;selected-driver&quot;&gt;&lt;/div&gt;&#39;</span> <span class="op">+</span>
        <span class="st">&#39;&lt;/div&gt;&#39;</span><span class="op">;</span>
    <span class="cf">return</span> template<span class="op">;</span>
<span class="op">}</span>)<span class="op">;</span>

<span class="co">// Render the base layout</span>
<span class="at">render</span>(layout<span class="op">,</span> <span class="st">&#39;#app&#39;</span>)<span class="op">;</span></code></pre></div>
<h3 id="create-the-driver-list">Create the driver list</h3>
<p>Next, let’s set up our list of potential drivers. This will be a simple unordered list with each driver’s name.</p>
<p>Before we build our template, let’s set up the state (or data) for our component. We’ll call it <code>drivers</code>, and give it a default value of an empty array. As the user adds potential drivers, we’ll push them into the array.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// The list of potential drivers</span>
<span class="kw">var</span> driverList <span class="op">=</span> <span class="at">component</span>(<span class="kw">function</span> (props) <span class="op">{</span>
    <span class="co">// Our template will go here...</span>
<span class="op">},</span> <span class="op">{</span><span class="dt">drivers</span><span class="op">:</span> []<span class="op">}</span>)<span class="op">;</span></code></pre></div>
<p>In our template, we’ll loop through each driver in our state (<code>props.drivers</code>) and create a list item. If there are no drivers, we’ll <code>return</code> an empty string. Otherwise, we’ll return our unordered list with each driver in it. Then we can render our list into the DOM.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// The list of potential drivers</span>
<span class="kw">var</span> driverList <span class="op">=</span> <span class="at">component</span>(<span class="kw">function</span> (props) <span class="op">{</span>

    <span class="co">// If their are no drivers, bail</span>
    <span class="cf">if</span> (<span class="va">props</span>.<span class="va">drivers</span>.<span class="at">length</span> <span class="op">&lt;</span> <span class="dv">1</span>) <span class="cf">return</span> <span class="st">&#39;&#39;</span><span class="op">;</span>

    <span class="co">// Setup our template</span>
    <span class="kw">var</span> template <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="op">;</span>

    <span class="co">// For each driver, create a list item</span>
    <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="va">props</span>.<span class="va">drivers</span>.<span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) <span class="op">{</span>
        template <span class="op">+=</span>
            <span class="st">&#39;&lt;li&gt;&#39;</span> <span class="op">+</span>
                <span class="va">props</span>.<span class="at">drivers</span>[i] <span class="op">+</span>
            <span class="st">&#39;&lt;/li&gt;&#39;</span><span class="op">;</span>
    <span class="op">}</span>

    <span class="co">// Otherwise, return our unordered list</span>
    <span class="cf">return</span> <span class="st">&#39;&lt;ul&gt;&#39;</span> <span class="op">+</span> template <span class="op">+</span> <span class="st">&#39;&lt;/ul&gt;&#39;</span><span class="op">;</span>

<span class="op">},</span> <span class="op">{</span><span class="dt">drivers</span><span class="op">:</span> []<span class="op">}</span>)<span class="op">;</span>

<span class="co">// Render the driver list</span>
<span class="at">render</span>(driverList<span class="op">,</span> <span class="st">&#39;#driver-list&#39;</span>)<span class="op">;</span></code></pre></div>
<h3 id="add-drivers-to-the-list">Add drivers to the list</h3>
<p>Now we’re ready to start adding potential drivers to the list.</p>
<p>To do this, we <em>could</em> listen for clicks on our “Add Driver” button. A better way, though, is to listen for <code>submit</code> events. This will let users click the “Add Driver” button <em>or</em> hit the enter key for faster submissions.</p>
<p>We’ll use event bubbling to listen for all form submissions and filter out the form to add drivers.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// Listen for form submissions</span>
<span class="va">document</span>.<span class="at">addEventListener</span>(<span class="st">&#39;submit&#39;</span><span class="op">,</span> <span class="kw">function</span> (event) <span class="op">{</span>

    <span class="co">// Check if the form is the driver list form</span>
    <span class="cf">if</span> (<span class="va">event</span>.<span class="va">target</span>.<span class="at">id</span> <span class="op">===</span> <span class="st">&#39;add-driver&#39;</span>) <span class="op">{</span>
        <span class="co">// Add driver to the list</span>
    <span class="op">}</span>

<span class="op">},</span> <span class="kw">false</span>)<span class="op">;</span></code></pre></div>
<p>Next, we need to do a few things:</p>
<ol style="list-style-type: decimal">
<li>Prevent the form from submitting.</li>
<li>Get the input field in our form.</li>
<li>Check that a name was entered (if it’s empty, we’ll do nothing).</li>
<li>Update the state for our <code>driverList</code> component using <code>setState()</code> to cause the list to render again.</li>
<li>Clear the input field.</li>
</ol>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// Listen for form submissions</span>
<span class="va">document</span>.<span class="at">addEventListener</span>(<span class="st">&#39;submit&#39;</span><span class="op">,</span> <span class="kw">function</span> (event) <span class="op">{</span>

    <span class="co">// Check if the form is the driver list form</span>
    <span class="cf">if</span> (<span class="va">event</span>.<span class="va">target</span>.<span class="at">id</span> <span class="op">===</span> <span class="st">&#39;add-driver&#39;</span>) <span class="op">{</span>

        <span class="co">// Prevent the form from submitting</span>
        <span class="va">event</span>.<span class="at">preventDefault</span>()<span class="op">;</span>

        <span class="co">// Get the input field</span>
        <span class="co">// If there&#39;s no driver name, bail</span>
        <span class="kw">var</span> driver <span class="op">=</span> <span class="va">event</span>.<span class="va">target</span>.<span class="at">querySelector</span>(<span class="st">&#39;#new-driver&#39;</span>)<span class="op">;</span>
        <span class="cf">if</span> (<span class="va">driver</span>.<span class="va">value</span>.<span class="at">length</span> <span class="op">&lt;</span> <span class="dv">1</span>) <span class="cf">return</span><span class="op">;</span>

        <span class="co">// Update the state for our `driverList` component and render again</span>
        <span class="va">driverList</span>.<span class="va">state</span>.<span class="va">drivers</span>.<span class="at">push</span>(<span class="va">driver</span>.<span class="va">value</span>.<span class="at">trim</span>())<span class="op">;</span>
        <span class="va">driverList</span>.<span class="at">setState</span>(<span class="op">{</span>
            <span class="dt">drivers</span><span class="op">:</span> <span class="va">driverList</span>.<span class="va">state</span>.<span class="at">drivers</span>
        <span class="op">}</span>)<span class="op">;</span>

        <span class="co">// Clear the input field</span>
        <span class="va">driver</span>.<span class="at">value</span> <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="op">;</span>

    <span class="op">}</span>

<span class="op">},</span> <span class="kw">false</span>)<span class="op">;</span></code></pre></div>
<p>Try it out! Type a name and hit enter to see the list update.</p>
<h3 id="create-our-selected-driver-component">Create our selected driver component</h3>
<p>Once we have some potential drivers, we need to pick one to actually drive. For this, we need to add a selected driver component with it’s own state.</p>
<p>We’ll give it a state of <code>selected</code> with a default value of <code>null</code>. If there’s no selected driver, we won’t show anything. If there is a driver, though, we’ll display their name in bold, followed by the words, “is driving.”</p>
<p>We can render our component right into the DOM.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// The selected driver</span>
<span class="kw">var</span> selectedDriver <span class="op">=</span> <span class="at">component</span>(<span class="kw">function</span> (props) <span class="op">{</span>
    <span class="cf">if</span> (<span class="op">!</span><span class="va">props</span>.<span class="at">selected</span>) <span class="cf">return</span><span class="op">;</span>
    <span class="cf">return</span> <span class="st">&#39;&lt;p&gt;&lt;strong&gt;&#39;</span> <span class="op">+</span> <span class="va">props</span>.<span class="at">selected</span> <span class="op">+</span> <span class="st">&#39;&lt;/strong&gt; is driving&lt;/p&gt;&#39;</span><span class="op">;</span>
<span class="op">},</span> <span class="op">{</span>
    <span class="dt">selected</span><span class="op">:</span> <span class="kw">null</span>
<span class="op">}</span>)<span class="op">;</span>

<span class="co">// Render the selected driver</span>
<span class="at">render</span>(selectedDriver<span class="op">,</span> <span class="st">&#39;#selected-driver&#39;</span>)<span class="op">;</span></code></pre></div>
<h3 id="pick-a-driver">Pick a driver</h3>
<p>Now it’s time to pick a driver. We can use our same <code>submit</code> event listener to detect clicks or keyboard interactions with the “Pick Who Drives” button.</p>
<p>Just like last time, we want to prevent the default form submission behavior.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// Listen for form submissions</span>
<span class="va">document</span>.<span class="at">addEventListener</span>(<span class="st">&#39;submit&#39;</span><span class="op">,</span> <span class="kw">function</span> (event) <span class="op">{</span>

    <span class="co">// Check if the form is the driver list form</span>
    <span class="cf">if</span> (<span class="va">event</span>.<span class="va">target</span>.<span class="at">id</span> <span class="op">===</span> <span class="st">&#39;add-driver&#39;</span>) <span class="op">{</span>
        <span class="co">// ...</span>
    <span class="op">}</span>

    <span class="co">// Check if the form is the pick driver button</span>
    <span class="cf">else</span> <span class="cf">if</span> (<span class="va">event</span>.<span class="va">target</span>.<span class="at">id</span> <span class="op">===</span> <span class="st">&#39;pick-driver&#39;</span>) <span class="op">{</span>

        <span class="co">// Prevent the form from submitting</span>
        <span class="va">event</span>.<span class="at">preventDefault</span>()<span class="op">;</span>

        <span class="co">// Pick our driver...</span>
    <span class="op">}</span>

<span class="op">},</span> <span class="kw">false</span>)<span class="op">;</span></code></pre></div>
<p>To pick our driver, we want to grab our drivers from the <code>driverList.state</code> object, randomly shuffle the order of our array, and pick the first one in the new, shuffled list.</p>
<p>After some Googling, I found this great article from Frank Mitchell<a href="#fn7" class="footnoteRef" id="fnref7"><sup>7</sup></a> on the best way to shuffle arrays with JavaScript. He does a better job explaining it than I could, so go read the original for the details.</p>
<p>The one change I made was the clone our original array and shuffle the clone instead of the original. We want to keep the driver order the same in our <code>driverList</code>.</p>
<p>Add this helper method to the script.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">/**</span>
<span class="co"> * Shuffle our array of drivers and return the first item</span>
<span class="co"> * Source: https://www.frankmitchell.org/2015/01/fisher-yates/</span>
<span class="co"> * </span><span class="kw">@param</span><span class="co">  </span><span class="kw">{Array}</span><span class="co"> array The array to shuffle</span>
<span class="co"> * </span><span class="kw">@return</span><span class="co"> {String}      The first item in the shuffled array</span>
<span class="co"> */</span>
<span class="kw">var</span> pickDriver <span class="op">=</span> <span class="kw">function</span> (array) <span class="op">{</span>

    <span class="cf">if</span> (<span class="va">array</span>.<span class="at">length</span> <span class="op">&lt;</span> <span class="dv">1</span>) <span class="cf">return</span> <span class="st">&#39;&#39;</span><span class="op">;</span>

    <span class="co">// Create a clone of the array so that we don&#39;t shuffle the original one</span>
    <span class="kw">var</span> arr <span class="op">=</span> <span class="va">array</span>.<span class="at">slice</span>()<span class="op">;</span>

    <span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span>
    <span class="kw">var</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span>
    <span class="kw">var</span> temp <span class="op">=</span> <span class="kw">null</span><span class="op">;</span>

    <span class="cf">for</span> (i <span class="op">=</span> <span class="va">arr</span>.<span class="at">length</span> <span class="op">-</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&gt;</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">-=</span> <span class="dv">1</span>) <span class="op">{</span>
        j <span class="op">=</span> <span class="va">Math</span>.<span class="at">floor</span>(<span class="va">Math</span>.<span class="at">random</span>() <span class="op">*</span> (i <span class="op">+</span> <span class="dv">1</span>))<span class="op">;</span>
        temp <span class="op">=</span> arr[i]<span class="op">;</span>
        arr[i] <span class="op">=</span> array[j]<span class="op">;</span>
        arr[j] <span class="op">=</span> temp<span class="op">;</span>
    <span class="op">}</span>

    <span class="cf">return</span> arr[<span class="dv">0</span>]<span class="op">;</span>

<span class="op">};</span></code></pre></div>
<p>Now, we can pick a random driver and set our <code>selectedDriver</code> state.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// Listen for form submissions</span>
<span class="va">document</span>.<span class="at">addEventListener</span>(<span class="st">&#39;submit&#39;</span><span class="op">,</span> <span class="kw">function</span> (event) <span class="op">{</span>

    <span class="co">// Check if the form is the driver list form</span>
    <span class="cf">if</span> (<span class="va">event</span>.<span class="va">target</span>.<span class="at">id</span> <span class="op">===</span> <span class="st">&#39;add-driver&#39;</span>) <span class="op">{</span>
        <span class="co">// ...</span>
    <span class="op">}</span>

    <span class="co">// Check if the form is the pick driver button</span>
    <span class="cf">else</span> <span class="cf">if</span> (<span class="va">event</span>.<span class="va">target</span>.<span class="at">id</span> <span class="op">===</span> <span class="st">&#39;pick-driver&#39;</span>) <span class="op">{</span>

        <span class="co">// Prevent the form from submitting</span>
        <span class="va">event</span>.<span class="at">preventDefault</span>()<span class="op">;</span>

        <span class="co">// Pick a driver</span>
        <span class="kw">var</span> picked <span class="op">=</span> <span class="at">pickDriver</span>(<span class="va">driverList</span>.<span class="va">state</span>.<span class="at">drivers</span>)<span class="op">;</span>

        <span class="co">// Update the state</span>
        <span class="va">selectedDriver</span>.<span class="at">setState</span>(<span class="op">{</span>
            <span class="dt">selected</span><span class="op">:</span> picked
        <span class="op">}</span>)<span class="op">;</span>

    <span class="op">}</span>

<span class="op">},</span> <span class="kw">false</span>)<span class="op">;</span></code></pre></div>
<p>At this point, you now have a fully functional web app. Nice work!</p>
<p>Now let’s add a few extras.</p>
<h3 id="remove-a-driver-from-the-list">Remove a driver from the list</h3>
<p>There’s a good chance that at some point your user will want to remove a driver from the list. Someone backs out of plans, or they type the name in wrong, and so on.</p>
<p>Let’s add a link next to each driver in the list that our user can click to remove that name from the list. We’ll give it a <code>[data-driver-remove]</code> data attribute that we can hook into in an event listener. We’ll give it a value of the driver’s name.</p>
<p>We should also assign the link a <code>role</code> of <code>button</code>, so that assistive technologies like screen readers know what to expect.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// The list of potential drivers</span>
<span class="kw">var</span> driverList <span class="op">=</span> <span class="at">component</span>(<span class="kw">function</span> (props) <span class="op">{</span>

    <span class="co">// If their are no drivers, bail</span>
    <span class="cf">if</span> (<span class="va">props</span>.<span class="va">drivers</span>.<span class="at">length</span> <span class="op">&lt;</span> <span class="dv">1</span>) <span class="cf">return</span><span class="op">;</span>

    <span class="co">// Setup our template</span>
    <span class="kw">var</span> template <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="op">;</span>

    <span class="co">// For each driver, create a list item</span>
    <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="va">props</span>.<span class="va">drivers</span>.<span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) <span class="op">{</span>
        template <span class="op">+=</span>
            <span class="st">&#39;&lt;li&gt;&#39;</span> <span class="op">+</span>
                <span class="va">props</span>.<span class="at">drivers</span>[i] <span class="op">+</span>
                <span class="st">&#39; &lt;a role=&quot;button&quot; data-driver-remove=&quot;&#39;</span> <span class="op">+</span> <span class="va">props</span>.<span class="at">drivers</span>[i] <span class="op">+</span> <span class="st">&#39;&quot; href=&quot;#&quot;&gt;(remove)&lt;/a&gt;&#39;</span> <span class="op">+</span>
            <span class="st">&#39;&lt;/li&gt;&#39;</span><span class="op">;</span>
    <span class="op">}</span>

    <span class="co">// Otherwise, return our unordered list</span>
    <span class="cf">return</span> <span class="st">&#39;&lt;ul&gt;&#39;</span> <span class="op">+</span> template <span class="op">+</span> <span class="st">&#39;&lt;/ul&gt;&#39;</span><span class="op">;</span>

<span class="op">},</span> <span class="op">{</span><span class="dt">drivers</span><span class="op">:</span> []<span class="op">}</span>)<span class="op">;</span></code></pre></div>
<p>Now, we can add a <code>click</code> event listener. We’ll again use event bubbling and check for the <code>[data-driver-remove]</code> data attribute.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// Listen for click events</span>
<span class="va">document</span>.<span class="at">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> <span class="kw">function</span> (event) <span class="op">{</span>

    <span class="co">// If a remove driver link was clicked</span>
    <span class="cf">if</span> (<span class="va">event</span>.<span class="va">target</span>.<span class="at">hasAttribute</span>(<span class="st">&#39;data-driver-remove&#39;</span>)) <span class="op">{</span>
        <span class="co">// Remove the driver...</span>
    <span class="op">}</span>

<span class="op">},</span> <span class="kw">false</span>)<span class="op">;</span></code></pre></div>
<p>We need to prevent the default link behavior. We’ll use <code>indexOf</code> to get the driver from our <code>driversList.state.drivers</code> array, using the name stashed in our data attribute. Then, we’ll use the <code>splice()</code> method to remove it from the array.</p>
<p>Then, we’ll use the <code>setState()</code> method on our <code>driverList</code> component to update the DOM.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">//Listen for click events</span>
<span class="va">document</span>.<span class="at">addEventListener</span>(<span class="st">&#39;click&#39;</span><span class="op">,</span> <span class="kw">function</span> (event) <span class="op">{</span>

    <span class="co">// If a remove driver link was clicked</span>
    <span class="cf">if</span> (<span class="va">event</span>.<span class="va">target</span>.<span class="at">hasAttribute</span>(<span class="st">&#39;data-driver-remove&#39;</span>)) <span class="op">{</span>

        <span class="co">// Prevent the link from doing anything</span>
        <span class="va">event</span>.<span class="at">preventDefault</span>()<span class="op">;</span>

        <span class="co">// Get the driver from our state</span>
        <span class="kw">var</span> driver <span class="op">=</span> <span class="va">driverList</span>.<span class="va">state</span>.<span class="va">drivers</span>.<span class="at">indexOf</span>(<span class="va">event</span>.<span class="va">target</span>.<span class="at">getAttribute</span>(<span class="st">&#39;data-driver-remove&#39;</span>))<span class="op">;</span>

        <span class="co">// Remove the driver from state</span>
        <span class="va">driverList</span>.<span class="va">state</span>.<span class="va">drivers</span>.<span class="at">splice</span>(driver<span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span>

        <span class="co">// Update the state</span>
        <span class="va">driverList</span>.<span class="at">setState</span>(<span class="op">{</span>
            <span class="dt">drivers</span><span class="op">:</span> <span class="va">driverList</span>.<span class="va">state</span>.<span class="at">drivers</span>
        <span class="op">}</span>)<span class="op">;</span>

    <span class="op">}</span>

<span class="op">},</span> <span class="kw">false</span>)<span class="op">;</span></code></pre></div>
<h3 id="add-a-settings-page">Add a settings page</h3>
<p>Let’s add a settings page where users can delete all drivers out of their app at once.</p>
<p>This is, frankly, completely unneccessary for an app like this. But I want to make sure you get a chance to practice URL routing with single page apps.</p>
<p>The support this, let’s first add the <code>router()</code> helper method to our script.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">var</span> render <span class="op">=</span> <span class="kw">function</span> (template<span class="op">,</span> elem) <span class="op">{</span>
    <span class="co">// ...</span>
<span class="op">};</span>

<span class="kw">var</span> component <span class="op">=</span> <span class="kw">function</span> (template<span class="op">,</span> props<span class="op">,</span> elem) <span class="op">{</span>
    <span class="co">// ...</span>
<span class="op">};</span>

<span class="kw">var</span> router <span class="op">=</span> <span class="kw">function</span> (routes<span class="op">,</span> options) <span class="op">{</span>
    <span class="co">// ...</span>
<span class="op">};</span></code></pre></div>
<h3 id="add-routes">Add routes</h3>
<p>We only need three routes for this app: <code>home</code>, <code>settings</code>, and an empty string that we’ll redirect to <code>home</code> for people who visit for the first time without a query string in the URL.</p>
<p>We’ll also pass in a title of <code>Who\'s Driving</code> (the <code>\</code> is to escape the single quote) as a setting so that it will get added to each page.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">var</span> routes <span class="op">=</span> <span class="at">router</span>(<span class="op">{</span>
    <span class="dt">settings</span><span class="op">:</span> <span class="op">{</span>
        <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Settings | &#39;</span>
    <span class="op">},</span>
    <span class="dt">home</span><span class="op">:</span> <span class="op">{</span>
        <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;&#39;</span>
    <span class="op">},</span>
    <span class="st">&#39;&#39;</span><span class="op">:</span> <span class="op">{</span>
        <span class="dt">redirect</span><span class="op">:</span> <span class="st">&#39;?p=home&#39;</span>
    <span class="op">}</span>
<span class="op">},</span>
<span class="op">{</span>
    <span class="dt">title</span><span class="op">:</span> <span class="st">&#39;Who</span><span class="sc">\&#39;</span><span class="st">s Driving&#39;</span>
<span class="op">}</span>)<span class="op">;</span></code></pre></div>
<p>Now that we have routes set up, we need to listen for <code>route</code> events. When one occurs, we’ll render our app again.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// Listen for route events</span>
<span class="va">window</span>.<span class="at">addEventListener</span>(<span class="st">&#39;route&#39;</span><span class="op">,</span> <span class="kw">function</span> () <span class="op">{</span>

    <span class="co">// Render the base layout</span>
    <span class="at">render</span>(layout<span class="op">,</span> <span class="st">&#39;#app&#39;</span>)<span class="op">;</span>

    <span class="co">// Render the driver list</span>
    <span class="at">render</span>(driverList<span class="op">,</span> <span class="st">&#39;#driver-list&#39;</span>)<span class="op">;</span>

    <span class="co">// Render the selected driver</span>
    <span class="at">render</span>(selectedDriver<span class="op">,</span> <span class="st">&#39;#selected-driver&#39;</span>)<span class="op">;</span>

<span class="op">},</span> <span class="kw">false</span>)<span class="op">;</span></code></pre></div>
<h3 id="remove-our-standalone-render-functions">Remove our standalone <code>render()</code> functions</h3>
<p>Currently, we’re using the <code>render()</code> method to render our <code>layout</code>, <code>driverList</code>, and <code>selectedDriver</code> components when the page loads, and then again on <code>route</code> events.</p>
<p>We can make the code a bit more DRY (an acronym for “Don’t Repeat Yourself”) and easier to maintain by removing the standalone <code>render()</code> functions that happen on page load. We’ll instead rely on our <code>route</code> event to handle the initial page load as well.</p>
<p>How? We’ll use the <code>route()</code> method from the router API, and pass in the initial page URL using <code>window.location.href</code>.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// Listen for route events</span>
<span class="va">window</span>.<span class="at">addEventListener</span>(<span class="st">&#39;route&#39;</span><span class="op">,</span> <span class="kw">function</span> () <span class="op">{</span>

    <span class="co">// Render the base layout</span>
    <span class="at">render</span>(layout<span class="op">,</span> <span class="st">&#39;#app&#39;</span>)<span class="op">;</span>

    <span class="co">// Render the driver list</span>
    <span class="at">render</span>(driverList<span class="op">,</span> <span class="st">&#39;#driver-list&#39;</span>)<span class="op">;</span>

    <span class="co">// Render the selected driver</span>
    <span class="at">render</span>(selectedDriver<span class="op">,</span> <span class="st">&#39;#selected-driver&#39;</span>)<span class="op">;</span>

<span class="op">},</span> <span class="kw">false</span>)<span class="op">;</span>

<span class="co">// Render the page for the first time</span>
<span class="va">routes</span>.<span class="at">route</span>(<span class="va">window</span>.<span class="va">location</span>.<span class="at">href</span>)<span class="op">;</span></code></pre></div>
<h3 id="add-a-link-to-the-settings-page">Add a link to the settings page</h3>
<p>Now we have a router set up, but we’re not passing any links through it.</p>
<p>Let’s add a link to the settings page just below the heading. We’re using query strings, so the link <code>href</code> value will be <code>?p=settings</code>.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// The base layout</span>
<span class="kw">var</span> layout <span class="op">=</span> <span class="at">component</span>(<span class="kw">function</span> () <span class="op">{</span>
    <span class="kw">var</span> template <span class="op">=</span>
        <span class="st">&#39;&lt;div id=&quot;app&quot;&gt;&#39;</span> <span class="op">+</span>
            <span class="st">&#39;&lt;h1&gt;Who</span><span class="sc">\&#39;</span><span class="st">s Driving&lt;/h1&gt;&#39;</span> <span class="op">+</span>
            <span class="st">&#39;&lt;p&gt;&lt;a data-route href=&quot;?p=settings&quot;&gt;Settings &amp;rarr;&lt;/a&gt;&lt;/p&gt;&#39;</span> <span class="op">+</span>
            <span class="st">&#39;&lt;div id=&quot;driver-list&quot;&gt;&lt;/div&gt;&#39;</span> <span class="op">+</span>
            <span class="st">&#39;&lt;div id=&quot;driver-actions&quot;&gt;&#39;</span> <span class="op">+</span>
                <span class="st">&#39;&lt;form id=&quot;add-driver&quot;&gt;&#39;</span> <span class="op">+</span>
                    <span class="st">&#39;&lt;label&gt;Type the name of your driver and hit enter&lt;/label&gt;&#39;</span> <span class="op">+</span>
                    <span class="st">&#39;&lt;input type=&quot;text&quot; name=&quot;new-driver&quot; id=&quot;new-driver&quot; autofocus&gt;&#39;</span> <span class="op">+</span>
                    <span class="st">&#39;&lt;button class=&quot;btn&quot; type=&quot;submit&quot;&gt;Add Driver&lt;/button&gt;&#39;</span> <span class="op">+</span>
                <span class="st">&#39;&lt;/form&gt;&#39;</span> <span class="op">+</span>
                <span class="st">&#39;&lt;form id=&quot;pick-driver&quot;&gt;&lt;button class=&quot;btn btn-secondary&quot; id=&quot;pick-driver-submit&quot;&gt;Pick Who Drives&lt;/button&gt;&lt;/form&gt;&#39;</span> <span class="op">+</span>
            <span class="st">&#39;&lt;/div&gt;&#39;</span> <span class="op">+</span>
            <span class="st">&#39;&lt;div id=&quot;selected-driver&quot;&gt;&lt;/div&gt;&#39;</span> <span class="op">+</span>
        <span class="st">&#39;&lt;/div&gt;&#39;</span><span class="op">;</span>
    <span class="cf">return</span> template<span class="op">;</span>
<span class="op">}</span>)<span class="op">;</span></code></pre></div>
<p>Refresh the page. You should see a settings link now. If you click it, the title in the tab/navbar will update, and so will the URL. If you called <code>history.state</code> in the Console tab of developer tools, you’ll see something like this.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// history.state</span>
<span class="op">{</span>
    <span class="dt">id</span><span class="op">:</span> <span class="st">&quot;settings&quot;</span><span class="op">,</span>
    <span class="dt">params</span><span class="op">:</span> <span class="op">{</span>
        <span class="dt">p</span><span class="op">:</span> <span class="st">&quot;settings&quot;</span>
    <span class="op">},</span>
    <span class="dt">url</span><span class="op">:</span> <span class="st">&quot;03%20-%20project%20complete%20with%20url%20routing.html?p=settings&quot;</span>
<span class="op">}</span></code></pre></div>
<h3 id="show-different-content-based-on-route-state">Show different content based on route state</h3>
<p>Next, we need to conditionally show content based on the route. To do that, we’ll hook into the <code>routes</code> state in our components.</p>
<p>Let’s start with the the <code>layout</code> component. We’ll use an <code>if...else</code> statement to show different content based on the <code>routes.state.id</code>.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// The base layout</span>
<span class="kw">var</span> layout <span class="op">=</span> <span class="at">component</span>(<span class="kw">function</span> () <span class="op">{</span>
    <span class="kw">var</span> template<span class="op">;</span>
    <span class="cf">if</span> (<span class="va">routes</span>.<span class="va">state</span>.<span class="at">id</span> <span class="op">===</span> <span class="st">&#39;settings&#39;</span>) <span class="op">{</span>
        template <span class="op">=</span>
            <span class="st">&#39;&lt;h1&gt;Settings&lt;/h2&gt;&#39;</span> <span class="op">+</span>
            <span class="st">&#39;&lt;p&gt;&lt;a data-route href=&quot;?p=home&quot;&gt;&amp;larr; Pick who</span><span class="sc">\&#39;</span><span class="st">s driving&lt;/a&gt;&lt;/p&gt;&#39;</span> <span class="op">+</span>
            <span class="st">&#39;&lt;div id=&quot;settings&quot;&gt;&lt;/div&gt;&#39;</span><span class="op">;</span>
    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span>
        template <span class="op">=</span>
            <span class="st">&#39;&lt;div id=&quot;app&quot;&gt;&#39;</span> <span class="op">+</span>
                <span class="st">&#39;&lt;h1&gt;Who</span><span class="sc">\&#39;</span><span class="st">s Driving&lt;/h1&gt;&#39;</span> <span class="op">+</span>
                <span class="st">&#39;&lt;p&gt;&lt;a data-route href=&quot;?p=settings&quot;&gt;Settings &amp;rarr;&lt;/a&gt;&lt;/p&gt;&#39;</span> <span class="op">+</span>
                <span class="st">&#39;&lt;div id=&quot;driver-list&quot;&gt;&lt;/div&gt;&#39;</span> <span class="op">+</span>
                <span class="st">&#39;&lt;div id=&quot;driver-actions&quot;&gt;&#39;</span> <span class="op">+</span>
                    <span class="st">&#39;&lt;form id=&quot;add-driver&quot;&gt;&#39;</span> <span class="op">+</span>
                        <span class="st">&#39;&lt;label&gt;Type the name of your driver and hit enter&lt;/label&gt;&#39;</span> <span class="op">+</span>
                        <span class="st">&#39;&lt;input type=&quot;text&quot; name=&quot;new-driver&quot; id=&quot;new-driver&quot; autofocus&gt;&#39;</span> <span class="op">+</span>
                        <span class="st">&#39;&lt;button class=&quot;btn&quot; type=&quot;submit&quot;&gt;Add Driver&lt;/button&gt;&#39;</span> <span class="op">+</span>
                    <span class="st">&#39;&lt;/form&gt;&#39;</span> <span class="op">+</span>
                    <span class="st">&#39;&lt;form id=&quot;pick-driver&quot;&gt;&lt;button class=&quot;btn btn-secondary&quot; id=&quot;pick-driver-submit&quot;&gt;Pick Who Drives&lt;/button&gt;&lt;/form&gt;&#39;</span> <span class="op">+</span>
                <span class="st">&#39;&lt;/div&gt;&#39;</span> <span class="op">+</span>
                <span class="st">&#39;&lt;div id=&quot;selected-driver&quot;&gt;&lt;/div&gt;&#39;</span> <span class="op">+</span>
            <span class="st">&#39;&lt;/div&gt;&#39;</span><span class="op">;</span>
    <span class="op">}</span>
    <span class="cf">return</span> template<span class="op">;</span>
<span class="op">}</span>)<span class="op">;</span></code></pre></div>
<p>We should also conditionally render our <code>driverList</code> and <code>selectedDriver</code> components if the route ID is <code>home</code>.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// The list of potential drivers</span>
<span class="kw">var</span> driverList <span class="op">=</span> <span class="at">component</span>(<span class="kw">function</span> (props) <span class="op">{</span>

    <span class="co">// Only render on the homepage</span>
    <span class="cf">if</span> (<span class="va">routes</span>.<span class="va">state</span>.<span class="at">id</span> <span class="op">!==</span> <span class="st">&#39;home&#39;</span>) <span class="cf">return</span><span class="op">;</span>

    <span class="co">// If their are no drivers, bail</span>
    <span class="cf">if</span> (<span class="va">props</span>.<span class="va">drivers</span>.<span class="at">length</span> <span class="op">&lt;</span> <span class="dv">1</span>) <span class="cf">return</span> <span class="st">&#39;&#39;</span><span class="op">;</span>

    <span class="co">// Setup our template</span>
    <span class="kw">var</span> template <span class="op">=</span> <span class="st">&#39;&#39;</span><span class="op">;</span>

    <span class="co">// For each driver, create a list item</span>
    <span class="cf">for</span> (<span class="kw">var</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="va">props</span>.<span class="va">drivers</span>.<span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) <span class="op">{</span>
        template <span class="op">+=</span>
            <span class="st">&#39;&lt;li&gt;&#39;</span> <span class="op">+</span>
                <span class="va">props</span>.<span class="at">drivers</span>[i] <span class="op">+</span>
                <span class="st">&#39; &lt;a role=&quot;button&quot; data-driver-remove=&quot;&#39;</span> <span class="op">+</span> <span class="va">props</span>.<span class="at">drivers</span>[i] <span class="op">+</span> <span class="st">&#39;&quot; href=&quot;#&quot;&gt;(remove)&lt;/a&gt;&#39;</span> <span class="op">+</span>
            <span class="st">&#39;&lt;/li&gt;&#39;</span><span class="op">;</span>
    <span class="op">}</span>

    <span class="co">// Otherwise, return our unordered list</span>
    <span class="cf">return</span> <span class="st">&#39;&lt;ul&gt;&#39;</span> <span class="op">+</span> template <span class="op">+</span> <span class="st">&#39;&lt;/ul&gt;&#39;</span><span class="op">;</span>

<span class="op">},</span> <span class="op">{</span><span class="dt">drivers</span><span class="op">:</span> []<span class="op">}</span>)<span class="op">;</span>

<span class="co">// The selected driver</span>
<span class="kw">var</span> selectedDriver <span class="op">=</span> <span class="at">component</span>(<span class="kw">function</span> (props) <span class="op">{</span>

    <span class="co">// Only render on the homepage</span>
    <span class="cf">if</span> (<span class="va">routes</span>.<span class="va">state</span>.<span class="at">id</span> <span class="op">!==</span> <span class="st">&#39;home&#39;</span>) <span class="cf">return</span><span class="op">;</span>

    <span class="cf">if</span> (<span class="op">!</span><span class="va">props</span>.<span class="at">selected</span>) <span class="cf">return</span><span class="op">;</span>
    <span class="cf">return</span> <span class="st">&#39;&lt;p&gt;&lt;strong&gt;&#39;</span> <span class="op">+</span> <span class="va">props</span>.<span class="at">selected</span> <span class="op">+</span> <span class="st">&#39;&lt;/strong&gt; is driving&lt;/p&gt;&#39;</span><span class="op">;</span>

<span class="op">},</span> <span class="op">{</span>
    <span class="dt">selected</span><span class="op">:</span> <span class="kw">null</span>
<span class="op">}</span>)<span class="op">;</span></code></pre></div>
<p>Go ahead and refresh the browser to see this in action. You can now toggle between two different views.</p>
<h3 id="add-a-settings-component">Add a settings component</h3>
<p>Next, let’s create a component for our settings that we’ll use to add a “Remove All Drivers” button. We don’t need to add state to this one since the UI is not conditional on data.</p>
<p>We’ll only render this when the route ID is <code>settings</code>.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// The settings form</span>
<span class="kw">var</span> settings <span class="op">=</span> <span class="at">component</span>(<span class="kw">function</span> () <span class="op">{</span>
    <span class="cf">if</span> (<span class="va">routes</span>.<span class="va">state</span>.<span class="at">id</span> <span class="op">!==</span> <span class="st">&#39;settings&#39;</span>) <span class="cf">return</span><span class="op">;</span>
    <span class="kw">var</span> template <span class="op">=</span>
        <span class="st">&#39;&lt;form id=&quot;driver-settings&quot;&gt;&#39;</span> <span class="op">+</span>
            <span class="st">&#39;&lt;button type=&quot;submit&quot;&gt;Remove All Drivers&lt;/button&gt;&#39;</span> <span class="op">+</span>
        <span class="st">&#39;&lt;/form&gt;&#39;</span><span class="op">;</span>
    <span class="cf">return</span> template<span class="op">;</span>
<span class="op">}</span>)<span class="op">;</span></code></pre></div>
<p>Next, we need to add a <code>render()</code> function for our settings component into our <code>route</code> event listener.</p>
<h3 id="remove-all-drivers">Remove all drivers</h3>
<p>Finally, we need to remove all drivers when the “Remove All Drivers” form is submitted. We can use our existing <code>submit</code> event listener for this.</p>
<p>We’re going to reset the <code>driverList.state.drivers</code> value to an empty array. We’ll also wipe out any selected driver if one exists. Then, we’ll redirect users back to the homepage by calling the <code>routes.route()</code> method, with <code>?p=home</code> as the URL.</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="co">// Listen for form submissions</span>
<span class="va">document</span>.<span class="at">addEventListener</span>(<span class="st">&#39;submit&#39;</span><span class="op">,</span> <span class="kw">function</span> (event) <span class="op">{</span>

    <span class="co">// Check if the form is the driver list form</span>
    <span class="cf">if</span> (<span class="va">event</span>.<span class="va">target</span>.<span class="at">id</span> <span class="op">===</span> <span class="st">&#39;add-driver&#39;</span>) <span class="op">{</span>
        <span class="co">// ...</span>
    <span class="op">}</span>

    <span class="co">// Check if the form is the pick driver button</span>
    <span class="cf">else</span> <span class="cf">if</span> (<span class="va">event</span>.<span class="va">target</span>.<span class="at">id</span> <span class="op">===</span> <span class="st">&#39;pick-driver&#39;</span>) <span class="op">{</span>
        <span class="co">// ...</span>
    <span class="op">}</span>

    <span class="co">// Check if the form is the settings form</span>
    <span class="cf">else</span> <span class="cf">if</span> (<span class="va">event</span>.<span class="va">target</span>.<span class="at">id</span> <span class="op">===</span> <span class="st">&#39;driver-settings&#39;</span>) <span class="op">{</span>

        <span class="co">// Reset the `driverList` state to an empty array</span>
        <span class="va">driverList</span>.<span class="va">state</span>.<span class="at">drivers</span> <span class="op">=</span> []<span class="op">;</span>

        <span class="co">// Reset the `selectedDriver` state to null</span>
        <span class="va">selectedDriver</span>.<span class="va">state</span>.<span class="at">selected</span> <span class="op">=</span> <span class="kw">null</span><span class="op">;</span>

        <span class="co">// Redirect user back to the homepage</span>
        <span class="va">routes</span>.<span class="at">route</span>(<span class="st">&#39;?p=home&#39;</span>)<span class="op">;</span>

    <span class="op">}</span>

<span class="op">},</span> <span class="kw">false</span>)<span class="op">;</span></code></pre></div>
<p>And with that, our app is complete.</p>
<p>Congratulations! You just created your first web app with vanilla JavaScript!</p>
<h2 id="about-the-author">About the Author</h2>
<div class="figure">
<img src="assets/img/chris-ferdinandi.jpg" class="author-img" />

</div>
<p>Hi, I’m Chris Ferdinandi. I help people learn JavaScript.</p>
<p>I love pirates, puppies, and Pixar movies, and live near horse farms in rural Massachusetts. I run Go Make Things with Bailey Puppy, a lab-mix from Tennessee.</p>
<p>You can find me:</p>
<ul>
<li>On my website at <a href="https://gomakethings.com">GoMakeThings.com</a>.</li>
<li>By email at <script type="text/javascript">
<!--
h='&#x67;&#x6f;&#x6d;&#x61;&#x6b;&#x65;&#116;&#104;&#x69;&#110;&#x67;&#x73;&#46;&#x63;&#x6f;&#x6d;';a='&#64;';n='&#x63;&#104;&#114;&#x69;&#x73;';e=n+a+h;
document.write('<a h'+'ref'+'="ma'+'ilto'+':'+e+'" clas'+'s="em' + 'ail">'+e+'<\/'+'a'+'>');
// -->
</script><noscript>&#x63;&#104;&#114;&#x69;&#x73;&#32;&#x61;&#116;&#32;&#x67;&#x6f;&#x6d;&#x61;&#x6b;&#x65;&#116;&#104;&#x69;&#110;&#x67;&#x73;&#32;&#100;&#x6f;&#116;&#32;&#x63;&#x6f;&#x6d;</noscript>.</li>
<li>On Twitter at <a href="https://twitter.com/ChrisFerdinandi"><span class="citation">@ChrisFerdinandi</span></a>.</li>
</ul>
<div class="break">

</div>
<script>
    ;(function (window, document, undefined) {

        'use strict';


        // Feature test
        var supports = 'querySelector' in document;
        if ( !supports ) return;


        //
        // Variables
        //


        var headings = document.querySelectorAll( 'h2' ); // Headings
        var toc = document.querySelector( '[data-toc]' ); // Table of contents container
        var links = '';         // Placeholder variables

        // Make sure headings and TOC container exist. Otherwise, bail.
        if ( headings.length < 1 || !toc ) return;


        //
        // Methods
        //

        /**
         * Give heading an ID if it's missing one
         * @param  {Node} heading The heading
         */
        var createID = function ( heading ) {

            // If the heading already has and ID, bail
            if ( heading.id ) return;

            // Otherwise, convert heading text to valid ID
            // Regex pattern: http://stackoverflow.com/a/9635698/1293256
            heading.id = heading.innerHTML.replace( /^[^a-z]+|[^\w:.-]+/gi, '_' ).toLowerCase();

        };

        /**
         * Create the table of contents link
         * @param  {Node} heading The heading
         */
        var createLink = function ( heading ) {
            links += '<li><a href="#' + heading.id + '">' + heading.innerHTML + '</a></li>';
        };


        //
        // Inits
        //

        // Create the links
        for ( var i = 0; i < headings.length; i++ ) {
            createID( headings[i] ); // If the heading has no ID, give it one
            createLink( headings[i] ); // Create link
        }

        // Inject TOC into the DOM
        toc.innerHTML = '<h2>Table of Contents</h2><ol>' + links + '</ol>';

    })(window, document);

    /*! smooth-scroll v10.3.1 | (c) 2017 Chris Ferdinandi | MIT License | http://github.com/cferdinandi/smooth-scroll */
    !(function(e,t){"function"==typeof define&&define.amd?define([],t(e)):"object"==typeof exports?module.exports=t(e):e.smoothScroll=t(e)})("undefined"!=typeof global?global:this.window||this.global,(function(e){"use strict";var t,n,o,r,a,c,l,i={},u="querySelector"in document&&"addEventListener"in e,s={selector:"[data-scroll]",selectorHeader:null,speed:500,easing:"easeInOutCubic",offset:0,callback:function(){}},f=function(){var e={},t=!1,n=0,o=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(t=arguments[0],n++);for(;n<o;n++){var r=arguments[n];!(function(n){for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t&&"[object Object]"===Object.prototype.toString.call(n[o])?e[o]=f(!0,e[o],n[o]):e[o]=n[o])})(r)}return e},d=function(e){return Math.max(e.scrollHeight,e.offsetHeight,e.clientHeight)},h=function(e,t){for(Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){for(var t=(this.document||this.ownerDocument).querySelectorAll(e),n=t.length;--n>=0&&t.item(n)!==this;);return n>-1});e&&e!==document;e=e.parentNode)if(e.matches(t))return e;return null},m=function(e){"#"===e.charAt(0)&&(e=e.substr(1));for(var t,n=String(e),o=n.length,r=-1,a="",c=n.charCodeAt(0);++r<o;){if(0===(t=n.charCodeAt(r)))throw new InvalidCharacterError("Invalid character: the input contains U+0000.");a+=t>=1&&t<=31||127==t||0===r&&t>=48&&t<=57||1===r&&t>=48&&t<=57&&45===c?"\\"+t.toString(16)+" ":t>=128||45===t||95===t||t>=48&&t<=57||t>=65&&t<=90||t>=97&&t<=122?n.charAt(r):"\\"+n.charAt(r)}return"#"+a},p=function(e,t){var n;return"easeInQuad"===e&&(n=t*t),"easeOutQuad"===e&&(n=t*(2-t)),"easeInOutQuad"===e&&(n=t<.5?2*t*t:(4-2*t)*t-1),"easeInCubic"===e&&(n=t*t*t),"easeOutCubic"===e&&(n=--t*t*t+1),"easeInOutCubic"===e&&(n=t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1),"easeInQuart"===e&&(n=t*t*t*t),"easeOutQuart"===e&&(n=1- --t*t*t*t),"easeInOutQuart"===e&&(n=t<.5?8*t*t*t*t:1-8*--t*t*t*t),"easeInQuint"===e&&(n=t*t*t*t*t),"easeOutQuint"===e&&(n=1+--t*t*t*t*t),"easeInOutQuint"===e&&(n=t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t),n||t},g=function(e,t,n){var o=0;if(e.offsetParent)do{o+=e.offsetTop,e=e.offsetParent}while(e);return o=Math.max(o-t-n,0),Math.min(o,y()-b())},b=function(){return Math.max(document.documentElement.clientHeight,e.innerHeight||0)},y=function(){return Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight)},v=function(e){return e&&"object"==typeof JSON&&"function"==typeof JSON.parse?JSON.parse(e):{}},O=function(e){return e?d(e)+e.offsetTop:0},S=function(t,n,o){o||(t.focus(),document.activeElement.id!==t.id&&(t.setAttribute("tabindex","-1"),t.focus(),t.style.outline="none"),e.scrollTo(0,n))};i.animateScroll=function(n,o,c){var i=v(o?o.getAttribute("data-options"):null),u=f(t||s,c||{},i),d="[object Number]"===Object.prototype.toString.call(n),h=d||!n.tagName?null:n;if(d||h){var m=e.pageYOffset;u.selectorHeader&&!r&&(r=document.querySelector(u.selectorHeader)),a||(a=O(r));var b,E,I=d?n:g(h,a,parseInt("function"==typeof u.offset?u.offset():u.offset,10)),H=I-m,A=y(),j=0,C=function(t,r,a){var c=e.pageYOffset;(t==r||c==r||e.innerHeight+c>=A)&&(clearInterval(a),S(n,r,d),u.callback(n,o))},M=function(){j+=16,b=j/parseInt(u.speed,10),b=b>1?1:b,E=m+H*p(u.easing,b),e.scrollTo(0,Math.floor(E)),C(E,I,l)};0===e.pageYOffset&&e.scrollTo(0,0),(function(){clearInterval(l),l=setInterval(M,16)})()}};var E=function(t){try{m(decodeURIComponent(e.location.hash))}catch(t){m(e.location.hash)}n&&(n.id=n.getAttribute("data-scroll-id"),i.animateScroll(n,o),n=null,o=null)},I=function(r){if(0===r.button&&!r.metaKey&&!r.ctrlKey&&(o=h(r.target,t.selector))&&"a"===o.tagName.toLowerCase()&&o.hostname===e.location.hostname&&o.pathname===e.location.pathname&&/#/.test(o.href)){var a;try{a=m(decodeURIComponent(o.hash))}catch(e){a=m(o.hash)}if("#"===a){r.preventDefault(),n=document.body;var c=n.id?n.id:"smooth-scroll-top";return n.setAttribute("data-scroll-id",c),n.id="",void(e.location.hash.substring(1)===c?E():e.location.hash=c)}n=document.querySelector(a),n&&(n.setAttribute("data-scroll-id",n.id),n.id="",o.hash===e.location.hash&&(r.preventDefault(),E()))}},H=function(e){c||(c=setTimeout((function(){c=null,a=O(r)}),66))};return i.destroy=function(){t&&(document.removeEventListener("click",I,!1),e.removeEventListener("resize",H,!1),t=null,n=null,o=null,r=null,a=null,c=null,l=null)},i.init=function(n){u&&(i.destroy(),t=f(s,n||{}),r=t.selectorHeader?document.querySelector(t.selectorHeader):null,a=O(r),document.addEventListener("click",I,!1),e.addEventListener("hashchange",E,!1),r&&e.addEventListener("resize",H,!1))},i}));
    smoothScroll.init({
        selector: 'a[href*="#"]'
    })
</script>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p><a href="https://github.com/cferdinandi/vanilla-javascript-cheat-sheet/blob/master/polyfills/CustomEvent.js" class="uri">https://github.com/cferdinandi/vanilla-javascript-cheat-sheet/blob/master/polyfills/CustomEvent.js</a><a href="#fnref1">↩</a></p></li>
<li id="fn2"><p><a href="https://github.com/cferdinandi/vanilla-javascript-cheat-sheet/blob/master/polyfills/CustomEvent.js" class="uri">https://github.com/cferdinandi/vanilla-javascript-cheat-sheet/blob/master/polyfills/CustomEvent.js</a><a href="#fnref2">↩</a></p></li>
<li id="fn3"><p><a href="https://developer.mozilla.org/en-US/docs/Web/Events" class="uri">https://developer.mozilla.org/en-US/docs/Web/Events</a><a href="#fnref3">↩</a></p></li>
<li id="fn4"><p><a href="https://github.com/cferdinandi/vanilla-javascript-cheat-sheet/blob/master/polyfills/matches.js" class="uri">https://github.com/cferdinandi/vanilla-javascript-cheat-sheet/blob/master/polyfills/matches.js</a><a href="#fnref4">↩</a></p></li>
<li id="fn5"><p><a href="https://github.com/browserstate/history.js" class="uri">https://github.com/browserstate/history.js</a><a href="#fnref5">↩</a></p></li>
<li id="fn6"><p><a href="https://github.com/cferdinandi/web-apps-source-code/" class="uri">https://github.com/cferdinandi/web-apps-source-code/</a><a href="#fnref6">↩</a></p></li>
<li id="fn7"><p><a href="https://www.frankmitchell.org/2015/01/fisher-yates/" class="uri">https://www.frankmitchell.org/2015/01/fisher-yates/</a><a href="#fnref7">↩</a></p></li>
</ol>
</div>
</body>
</html>
